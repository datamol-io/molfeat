
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="An all in one package for molecule featurization">
      
      
      
      
        <link rel="prev" href="../community/contributions.html">
      
      
        <link rel="next" href="molfeat.trans.base.html">
      
      
      <link rel="icon" href="../images/logo-black.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.46">
    
    
      
        <title>molfeat.calc - molfeat</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6f8fc17f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../assets/css/custom.css">
    
      <link rel="stylesheet" href="../assets/css/custom-molfeat.css">
    
      <link rel="stylesheet" href="../assets/css/tweak-width.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#calculators" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="molfeat" class="md-header__button md-logo" aria-label="molfeat" data-md-component="logo">
      
  <img src="../images/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            molfeat
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              molfeat.calc
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/datamol-io/molfeat" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    datamol-io/molfeat
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../index.html" class="md-tabs__link">
          
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../tutorials/types_of_featurizers.html" class="md-tabs__link">
          
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../developers/contribute.html" class="md-tabs__link">
          
  
  Developers

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../community/get_involved.html" class="md-tabs__link">
          
  
  Community

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="molfeat.calc.html" class="md-tabs__link">
          
  
  API

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="molfeat" class="md-nav__button md-logo" aria-label="molfeat" data-md-component="logo">
      
  <img src="../images/logo.svg" alt="logo">

    </a>
    molfeat
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/datamol-io/molfeat" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    datamol-io/molfeat
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What is molfeat?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to use molfeat?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../benchmark.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Why should you care?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../license.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/types_of_featurizers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Types of featurizers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Add your own
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Add your own
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/add_your_own.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create your own featurizers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/custom_model_store.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create a custom modelstore
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/graphs.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Featurizing graphs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Integrations
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Integrations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/integrations.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integration with scikit-learn and PyTorch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/pyg_integration.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Training a GNN with PyG
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/transformer_finetuning.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Finetuning a pretrained transformer
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/save_and_load.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Save and Load
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/datacache.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Data Cache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Model Handling
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            Model Handling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/loading_models_without_disk_storage.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Loading Models Without Disk Storage Using
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Developers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developers/contribute.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developers/create-plugin.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extending molfeat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developers/register-plugin.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Registering your Plugin
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Community
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Community
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../community/get_involved.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get involved
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../community/contributions.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Community contributions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    molfeat.calc
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="molfeat.calc.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    molfeat.calc
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc" class="md-nav__link">
    <span class="md-ellipsis">
      calc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.get_calculator" class="md-nav__link">
    <span class="md-ellipsis">
      get_calculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_calculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#serializable-calculator-are-the-base-abstract-class-for-implementing-your-calculators" class="md-nav__link">
    <span class="md-ellipsis">
      Serializable Calculator are the base abstract class for implementing your calculators.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.base" class="md-nav__link">
    <span class="md-ellipsis">
      base
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.base.SerializableCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      SerializableCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SerializableCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.base.SerializableCalculator.from_state_dict" class="md-nav__link">
    <span class="md-ellipsis">
      from_state_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.base.SerializableCalculator.to_state_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_state_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.base.SerializableCalculator.to_state_json" class="md-nav__link">
    <span class="md-ellipsis">
      to_state_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.base.SerializableCalculator.to_state_json_file" class="md-nav__link">
    <span class="md-ellipsis">
      to_state_json_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.base.SerializableCalculator.to_state_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      to_state_yaml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.base.SerializableCalculator.to_state_yaml_file" class="md-nav__link">
    <span class="md-ellipsis">
      to_state_yaml_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fingerprints" class="md-nav__link">
    <span class="md-ellipsis">
      Fingerprints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.fingerprints" class="md-nav__link">
    <span class="md-ellipsis">
      fingerprints
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.fingerprints.FPCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      FPCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FPCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.fingerprints.FPCalculator.columns" class="md-nav__link">
    <span class="md-ellipsis">
      columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.fingerprints.FPCalculator.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.fingerprints.FPCalculator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.fingerprints.FPCalculator.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.fingerprints.FPCalculator.__setstate__" class="md-nav__link">
    <span class="md-ellipsis">
      __setstate__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.fingerprints.FPCalculator.available_fingerprints" class="md-nav__link">
    <span class="md-ellipsis">
      available_fingerprints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.fingerprints.FPCalculator.default_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      default_parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.fingerprints.FPCalculator.to_state_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_state_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cats" class="md-nav__link">
    <span class="md-ellipsis">
      CATS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.cats" class="md-nav__link">
    <span class="md-ellipsis">
      cats
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.cats.CATS" class="md-nav__link">
    <span class="md-ellipsis">
      CATS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CATS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.cats.CATS.columns" class="md-nav__link">
    <span class="md-ellipsis">
      columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.cats.CATS.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.cats.CATS.__getstate__" class="md-nav__link">
    <span class="md-ellipsis">
      __getstate__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.cats.CATS.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.cats.CATS.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.cats.CATS.__setstate__" class="md-nav__link">
    <span class="md-ellipsis">
      __setstate__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pharmacophore" class="md-nav__link">
    <span class="md-ellipsis">
      Pharmacophore
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore" class="md-nav__link">
    <span class="md-ellipsis">
      pharmacophore
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore2D" class="md-nav__link">
    <span class="md-ellipsis">
      Pharmacophore2D
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pharmacophore2D">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore2D.columns" class="md-nav__link">
    <span class="md-ellipsis">
      columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore2D.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore2D.__getstate__" class="md-nav__link">
    <span class="md-ellipsis">
      __getstate__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore2D.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore2D.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore2D.__setstate__" class="md-nav__link">
    <span class="md-ellipsis">
      __setstate__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D" class="md-nav__link">
    <span class="md-ellipsis">
      Pharmacophore3D
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pharmacophore3D">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.__getstate__" class="md-nav__link">
    <span class="md-ellipsis">
      __getstate__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.__setstate__" class="md-nav__link">
    <span class="md-ellipsis">
      __setstate__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.cluster_features" class="md-nav__link">
    <span class="md-ellipsis">
      cluster_features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.compute_fp_from_coords" class="md-nav__link">
    <span class="md-ellipsis">
      compute_fp_from_coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.consensus_fp" class="md-nav__link">
    <span class="md-ellipsis">
      consensus_fp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.get_features" class="md-nav__link">
    <span class="md-ellipsis">
      get_features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.get_features_from_many" class="md-nav__link">
    <span class="md-ellipsis">
      get_features_from_many
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.show" class="md-nav__link">
    <span class="md-ellipsis">
      show
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.show_many" class="md-nav__link">
    <span class="md-ellipsis">
      show_many
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.get_feature_factory" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_factory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.get_sig_factory" class="md-nav__link">
    <span class="md-ellipsis">
      get_sig_factory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.get_sig_factory_params" class="md-nav__link">
    <span class="md-ellipsis">
      get_sig_factory_params
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_sig_factory_params">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scaffold-keys" class="md-nav__link">
    <span class="md-ellipsis">
      Scaffold Keys
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.skeys" class="md-nav__link">
    <span class="md-ellipsis">
      skeys
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      ScaffoldKeyCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ScaffoldKeyCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.columns" class="md-nav__link">
    <span class="md-ellipsis">
      columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.__getstate__" class="md-nav__link">
    <span class="md-ellipsis">
      __getstate__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.abs_scaffold_format_charge" class="md-nav__link">
    <span class="md-ellipsis">
      abs_scaffold_format_charge
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.compute_normalization" class="md-nav__link">
    <span class="md-ellipsis">
      compute_normalization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_at_least_2_nei_more_than_2_conn" class="md-nav__link">
    <span class="md-ellipsis">
      n_atom_at_least_2_nei_more_than_2_conn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_exocyclic" class="md-nav__link">
    <span class="md-ellipsis">
      n_atom_exocyclic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_in_chain" class="md-nav__link">
    <span class="md-ellipsis">
      n_atom_in_chain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_in_conjugated_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_atom_in_conjugated_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_in_rings" class="md-nav__link">
    <span class="md-ellipsis">
      n_atom_in_rings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_spiro_atoms" class="md-nav__link">
    <span class="md-ellipsis">
      n_atom_spiro_atoms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_atoms_not_in_conjugated_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_atoms_not_in_conjugated_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_bonds" class="md-nav__link">
    <span class="md-ellipsis">
      n_bonds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_bonds_2_heteroatoms" class="md-nav__link">
    <span class="md-ellipsis">
      n_bonds_2_heteroatoms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_bonds_at_least_3_conn" class="md-nav__link">
    <span class="md-ellipsis">
      n_bonds_at_least_3_conn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_bonds_atoms_with_at_least_one_nei_with_2_conn" class="md-nav__link">
    <span class="md-ellipsis">
      n_bonds_atoms_with_at_least_one_nei_with_2_conn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_carbon_atleast_2_heteroatoms" class="md-nav__link">
    <span class="md-ellipsis">
      n_carbon_atleast_2_heteroatoms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_carbon_het_carbon_het_bonds" class="md-nav__link">
    <span class="md-ellipsis">
      n_carbon_het_carbon_het_bonds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_exocyclic_single_bonds_carbon" class="md-nav__link">
    <span class="md-ellipsis">
      n_exocyclic_single_bonds_carbon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_exocyclic_single_bonds_nitrogen" class="md-nav__link">
    <span class="md-ellipsis">
      n_exocyclic_single_bonds_nitrogen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_heteroatom_more_than_2_conn" class="md-nav__link">
    <span class="md-ellipsis">
      n_heteroatom_more_than_2_conn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_heteroatoms" class="md-nav__link">
    <span class="md-ellipsis">
      n_heteroatoms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_heteroatoms_in_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_heteroatoms_in_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_multiple_non_conj_ring_bonds" class="md-nav__link">
    <span class="md-ellipsis">
      n_multiple_non_conj_ring_bonds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_nitrogen" class="md-nav__link">
    <span class="md-ellipsis">
      n_nitrogen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_nitrogen_in_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_nitrogen_in_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_non_ring_bonds_2_conj_rings" class="md-nav__link">
    <span class="md-ellipsis">
      n_non_ring_bonds_2_conj_rings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_non_ring_bonds_conj_nonconj_rings" class="md-nav__link">
    <span class="md-ellipsis">
      n_non_ring_bonds_conj_nonconj_rings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_oxygen" class="md-nav__link">
    <span class="md-ellipsis">
      n_oxygen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_oxygen_in_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_oxygen_in_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system" class="md-nav__link">
    <span class="md-ellipsis">
      n_ring_system
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_2_conj_simple_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_ring_system_with_2_conj_simple_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_2_non_conj_simple_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_ring_system_with_2_non_conj_simple_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_3_conj_simple_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_ring_system_with_3_conj_simple_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_3_non_conj_simple_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_ring_system_with_3_non_conj_simple_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_conj_non_conj_simple_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_ring_system_with_conj_non_conj_simple_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_greater_one_conj_nonconj_simple_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_ring_system_with_greater_one_conj_nonconj_simple_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_non_conj_5_atoms_rings" class="md-nav__link">
    <span class="md-ellipsis">
      n_simple_non_conj_5_atoms_rings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_non_conj_6_atoms_rings" class="md-nav__link">
    <span class="md-ellipsis">
      n_simple_non_conj_6_atoms_rings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_rings" class="md-nav__link">
    <span class="md-ellipsis">
      n_simple_rings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_rings_1_heteroatoms" class="md-nav__link">
    <span class="md-ellipsis">
      n_simple_rings_1_heteroatoms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_rings_2_heteroatoms" class="md-nav__link">
    <span class="md-ellipsis">
      n_simple_rings_2_heteroatoms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_rings_at_least_3_heteroatoms" class="md-nav__link">
    <span class="md-ellipsis">
      n_simple_rings_at_least_3_heteroatoms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_rings_no_heteroatoms" class="md-nav__link">
    <span class="md-ellipsis">
      n_simple_rings_no_heteroatoms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_sulfur" class="md-nav__link">
    <span class="md-ellipsis">
      n_sulfur
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.size_largest_ring" class="md-nav__link">
    <span class="md-ellipsis">
      size_largest_ring
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.skdistance" class="md-nav__link">
    <span class="md-ellipsis">
      skdistance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="skdistance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shape" class="md-nav__link">
    <span class="md-ellipsis">
      Shape
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.shape" class="md-nav__link">
    <span class="md-ellipsis">
      shape
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.shape.ElectroShapeDescriptors" class="md-nav__link">
    <span class="md-ellipsis">
      ElectroShapeDescriptors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ElectroShapeDescriptors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.shape.ElectroShapeDescriptors.columns" class="md-nav__link">
    <span class="md-ellipsis">
      columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.shape.ElectroShapeDescriptors.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.shape.ElectroShapeDescriptors.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.shape.ElectroShapeDescriptors.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.shape.ElectroShapeDescriptors.compute_charge" class="md-nav__link">
    <span class="md-ellipsis">
      compute_charge
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.shape.USRDescriptors" class="md-nav__link">
    <span class="md-ellipsis">
      USRDescriptors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="USRDescriptors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.shape.USRDescriptors.columns" class="md-nav__link">
    <span class="md-ellipsis">
      columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.shape.USRDescriptors.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.shape.USRDescriptors.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.shape.USRDescriptors.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.shape.usrdistance" class="md-nav__link">
    <span class="md-ellipsis">
      usrdistance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="usrdistance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#atoms-featurizer" class="md-nav__link">
    <span class="md-ellipsis">
      Atoms Featurizer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.atom" class="md-nav__link">
    <span class="md-ellipsis">
      atom
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.atom.AtomCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      AtomCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AtomCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.atom.AtomCalculator.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.atom.AtomCalculator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.atom.AtomCalculator.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.atom.AtomCalculator.feat_size" class="md-nav__link">
    <span class="md-ellipsis">
      feat_size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.atom.AtomCalculator.from_state_dict" class="md-nav__link">
    <span class="md-ellipsis">
      from_state_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.atom.AtomCalculator.to_state_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_state_dict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.atom.AtomMaterialCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      AtomMaterialCalculator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.atom.DGLCanonicalAtomCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      DGLCanonicalAtomCalculator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.atom.DGLWeaveAtomCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      DGLWeaveAtomCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DGLWeaveAtomCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.atom.DGLWeaveAtomCalculator.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.atom.DGLWeaveAtomCalculator.atom_weave_props" class="md-nav__link">
    <span class="md-ellipsis">
      atom_weave_props
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bonds-featurizer" class="md-nav__link">
    <span class="md-ellipsis">
      Bonds Featurizer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.bond" class="md-nav__link">
    <span class="md-ellipsis">
      bond
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.bond.BondCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      BondCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BondCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.BondCalculator.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.BondCalculator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.BondCalculator.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.BondCalculator.feat_size" class="md-nav__link">
    <span class="md-ellipsis">
      feat_size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.BondCalculator.from_state_dict" class="md-nav__link">
    <span class="md-ellipsis">
      from_state_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.BondCalculator.to_state_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_state_dict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.bond.DGLCanonicalBondCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      DGLCanonicalBondCalculator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.bond.DGLWeaveEdgeCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      DGLWeaveEdgeCalculator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.bond.EdgeMatCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      EdgeMatCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EdgeMatCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.EdgeMatCalculator.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.EdgeMatCalculator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.EdgeMatCalculator.feat_size" class="md-nav__link">
    <span class="md-ellipsis">
      feat_size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.EdgeMatCalculator.from_state_dict" class="md-nav__link">
    <span class="md-ellipsis">
      from_state_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.EdgeMatCalculator.to_state_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_state_dict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    molfeat.trans
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            molfeat.trans
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="molfeat.trans.base.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    molfeat.trans.base
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="molfeat.trans.fp.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    molfeat.trans.fp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="molfeat.trans.graph.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    molfeat.trans.graph
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="molfeat.trans.struct.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    molfeat.trans.struct
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="molfeat.trans.concat.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    molfeat.trans.concat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_6" >
        
          
          <label class="md-nav__link" for="__nav_5_2_6" id="__nav_5_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    molfeat.trans.pretrained
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_6">
            <span class="md-nav__icon md-icon"></span>
            molfeat.trans.pretrained
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="molfeat.trans.pretrained.base.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Base Pretrained Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="molfeat.trans.pretrained.hf_transformers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HuggingFace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="molfeat.trans.pretrained.graphormer.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Graphormer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="molfeat.trans.pretrained.dgl_pretrained.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DGL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="molfeat.trans.pretrained.fcd.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FCD
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="molfeat.store.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    molfeat.store
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="molfeat.plugins.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    molfeat.plugins
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="molfeat.utils.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    molfeat.utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="molfeat.viz.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    molfeat.viz
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc" class="md-nav__link">
    <span class="md-ellipsis">
      calc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.get_calculator" class="md-nav__link">
    <span class="md-ellipsis">
      get_calculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_calculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#serializable-calculator-are-the-base-abstract-class-for-implementing-your-calculators" class="md-nav__link">
    <span class="md-ellipsis">
      Serializable Calculator are the base abstract class for implementing your calculators.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.base" class="md-nav__link">
    <span class="md-ellipsis">
      base
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.base.SerializableCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      SerializableCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SerializableCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.base.SerializableCalculator.from_state_dict" class="md-nav__link">
    <span class="md-ellipsis">
      from_state_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.base.SerializableCalculator.to_state_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_state_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.base.SerializableCalculator.to_state_json" class="md-nav__link">
    <span class="md-ellipsis">
      to_state_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.base.SerializableCalculator.to_state_json_file" class="md-nav__link">
    <span class="md-ellipsis">
      to_state_json_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.base.SerializableCalculator.to_state_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      to_state_yaml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.base.SerializableCalculator.to_state_yaml_file" class="md-nav__link">
    <span class="md-ellipsis">
      to_state_yaml_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fingerprints" class="md-nav__link">
    <span class="md-ellipsis">
      Fingerprints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.fingerprints" class="md-nav__link">
    <span class="md-ellipsis">
      fingerprints
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.fingerprints.FPCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      FPCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FPCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.fingerprints.FPCalculator.columns" class="md-nav__link">
    <span class="md-ellipsis">
      columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.fingerprints.FPCalculator.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.fingerprints.FPCalculator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.fingerprints.FPCalculator.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.fingerprints.FPCalculator.__setstate__" class="md-nav__link">
    <span class="md-ellipsis">
      __setstate__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.fingerprints.FPCalculator.available_fingerprints" class="md-nav__link">
    <span class="md-ellipsis">
      available_fingerprints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.fingerprints.FPCalculator.default_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      default_parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.fingerprints.FPCalculator.to_state_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_state_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cats" class="md-nav__link">
    <span class="md-ellipsis">
      CATS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.cats" class="md-nav__link">
    <span class="md-ellipsis">
      cats
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.cats.CATS" class="md-nav__link">
    <span class="md-ellipsis">
      CATS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CATS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.cats.CATS.columns" class="md-nav__link">
    <span class="md-ellipsis">
      columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.cats.CATS.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.cats.CATS.__getstate__" class="md-nav__link">
    <span class="md-ellipsis">
      __getstate__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.cats.CATS.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.cats.CATS.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.cats.CATS.__setstate__" class="md-nav__link">
    <span class="md-ellipsis">
      __setstate__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pharmacophore" class="md-nav__link">
    <span class="md-ellipsis">
      Pharmacophore
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore" class="md-nav__link">
    <span class="md-ellipsis">
      pharmacophore
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore2D" class="md-nav__link">
    <span class="md-ellipsis">
      Pharmacophore2D
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pharmacophore2D">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore2D.columns" class="md-nav__link">
    <span class="md-ellipsis">
      columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore2D.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore2D.__getstate__" class="md-nav__link">
    <span class="md-ellipsis">
      __getstate__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore2D.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore2D.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore2D.__setstate__" class="md-nav__link">
    <span class="md-ellipsis">
      __setstate__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D" class="md-nav__link">
    <span class="md-ellipsis">
      Pharmacophore3D
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pharmacophore3D">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.__getstate__" class="md-nav__link">
    <span class="md-ellipsis">
      __getstate__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.__setstate__" class="md-nav__link">
    <span class="md-ellipsis">
      __setstate__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.cluster_features" class="md-nav__link">
    <span class="md-ellipsis">
      cluster_features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.compute_fp_from_coords" class="md-nav__link">
    <span class="md-ellipsis">
      compute_fp_from_coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.consensus_fp" class="md-nav__link">
    <span class="md-ellipsis">
      consensus_fp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.get_features" class="md-nav__link">
    <span class="md-ellipsis">
      get_features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.get_features_from_many" class="md-nav__link">
    <span class="md-ellipsis">
      get_features_from_many
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.show" class="md-nav__link">
    <span class="md-ellipsis">
      show
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.Pharmacophore3D.show_many" class="md-nav__link">
    <span class="md-ellipsis">
      show_many
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.get_feature_factory" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_factory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.get_sig_factory" class="md-nav__link">
    <span class="md-ellipsis">
      get_sig_factory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.pharmacophore.get_sig_factory_params" class="md-nav__link">
    <span class="md-ellipsis">
      get_sig_factory_params
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_sig_factory_params">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scaffold-keys" class="md-nav__link">
    <span class="md-ellipsis">
      Scaffold Keys
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.skeys" class="md-nav__link">
    <span class="md-ellipsis">
      skeys
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      ScaffoldKeyCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ScaffoldKeyCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.columns" class="md-nav__link">
    <span class="md-ellipsis">
      columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.__getstate__" class="md-nav__link">
    <span class="md-ellipsis">
      __getstate__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.abs_scaffold_format_charge" class="md-nav__link">
    <span class="md-ellipsis">
      abs_scaffold_format_charge
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.compute_normalization" class="md-nav__link">
    <span class="md-ellipsis">
      compute_normalization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_at_least_2_nei_more_than_2_conn" class="md-nav__link">
    <span class="md-ellipsis">
      n_atom_at_least_2_nei_more_than_2_conn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_exocyclic" class="md-nav__link">
    <span class="md-ellipsis">
      n_atom_exocyclic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_in_chain" class="md-nav__link">
    <span class="md-ellipsis">
      n_atom_in_chain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_in_conjugated_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_atom_in_conjugated_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_in_rings" class="md-nav__link">
    <span class="md-ellipsis">
      n_atom_in_rings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_spiro_atoms" class="md-nav__link">
    <span class="md-ellipsis">
      n_atom_spiro_atoms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_atoms_not_in_conjugated_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_atoms_not_in_conjugated_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_bonds" class="md-nav__link">
    <span class="md-ellipsis">
      n_bonds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_bonds_2_heteroatoms" class="md-nav__link">
    <span class="md-ellipsis">
      n_bonds_2_heteroatoms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_bonds_at_least_3_conn" class="md-nav__link">
    <span class="md-ellipsis">
      n_bonds_at_least_3_conn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_bonds_atoms_with_at_least_one_nei_with_2_conn" class="md-nav__link">
    <span class="md-ellipsis">
      n_bonds_atoms_with_at_least_one_nei_with_2_conn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_carbon_atleast_2_heteroatoms" class="md-nav__link">
    <span class="md-ellipsis">
      n_carbon_atleast_2_heteroatoms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_carbon_het_carbon_het_bonds" class="md-nav__link">
    <span class="md-ellipsis">
      n_carbon_het_carbon_het_bonds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_exocyclic_single_bonds_carbon" class="md-nav__link">
    <span class="md-ellipsis">
      n_exocyclic_single_bonds_carbon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_exocyclic_single_bonds_nitrogen" class="md-nav__link">
    <span class="md-ellipsis">
      n_exocyclic_single_bonds_nitrogen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_heteroatom_more_than_2_conn" class="md-nav__link">
    <span class="md-ellipsis">
      n_heteroatom_more_than_2_conn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_heteroatoms" class="md-nav__link">
    <span class="md-ellipsis">
      n_heteroatoms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_heteroatoms_in_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_heteroatoms_in_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_multiple_non_conj_ring_bonds" class="md-nav__link">
    <span class="md-ellipsis">
      n_multiple_non_conj_ring_bonds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_nitrogen" class="md-nav__link">
    <span class="md-ellipsis">
      n_nitrogen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_nitrogen_in_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_nitrogen_in_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_non_ring_bonds_2_conj_rings" class="md-nav__link">
    <span class="md-ellipsis">
      n_non_ring_bonds_2_conj_rings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_non_ring_bonds_conj_nonconj_rings" class="md-nav__link">
    <span class="md-ellipsis">
      n_non_ring_bonds_conj_nonconj_rings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_oxygen" class="md-nav__link">
    <span class="md-ellipsis">
      n_oxygen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_oxygen_in_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_oxygen_in_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system" class="md-nav__link">
    <span class="md-ellipsis">
      n_ring_system
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_2_conj_simple_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_ring_system_with_2_conj_simple_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_2_non_conj_simple_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_ring_system_with_2_non_conj_simple_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_3_conj_simple_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_ring_system_with_3_conj_simple_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_3_non_conj_simple_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_ring_system_with_3_non_conj_simple_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_conj_non_conj_simple_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_ring_system_with_conj_non_conj_simple_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_greater_one_conj_nonconj_simple_ring" class="md-nav__link">
    <span class="md-ellipsis">
      n_ring_system_with_greater_one_conj_nonconj_simple_ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_non_conj_5_atoms_rings" class="md-nav__link">
    <span class="md-ellipsis">
      n_simple_non_conj_5_atoms_rings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_non_conj_6_atoms_rings" class="md-nav__link">
    <span class="md-ellipsis">
      n_simple_non_conj_6_atoms_rings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_rings" class="md-nav__link">
    <span class="md-ellipsis">
      n_simple_rings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_rings_1_heteroatoms" class="md-nav__link">
    <span class="md-ellipsis">
      n_simple_rings_1_heteroatoms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_rings_2_heteroatoms" class="md-nav__link">
    <span class="md-ellipsis">
      n_simple_rings_2_heteroatoms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_rings_at_least_3_heteroatoms" class="md-nav__link">
    <span class="md-ellipsis">
      n_simple_rings_at_least_3_heteroatoms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_rings_no_heteroatoms" class="md-nav__link">
    <span class="md-ellipsis">
      n_simple_rings_no_heteroatoms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_sulfur" class="md-nav__link">
    <span class="md-ellipsis">
      n_sulfur
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.size_largest_ring" class="md-nav__link">
    <span class="md-ellipsis">
      size_largest_ring
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.skeys.skdistance" class="md-nav__link">
    <span class="md-ellipsis">
      skdistance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="skdistance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shape" class="md-nav__link">
    <span class="md-ellipsis">
      Shape
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.shape" class="md-nav__link">
    <span class="md-ellipsis">
      shape
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.shape.ElectroShapeDescriptors" class="md-nav__link">
    <span class="md-ellipsis">
      ElectroShapeDescriptors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ElectroShapeDescriptors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.shape.ElectroShapeDescriptors.columns" class="md-nav__link">
    <span class="md-ellipsis">
      columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.shape.ElectroShapeDescriptors.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.shape.ElectroShapeDescriptors.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.shape.ElectroShapeDescriptors.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.shape.ElectroShapeDescriptors.compute_charge" class="md-nav__link">
    <span class="md-ellipsis">
      compute_charge
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.shape.USRDescriptors" class="md-nav__link">
    <span class="md-ellipsis">
      USRDescriptors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="USRDescriptors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.shape.USRDescriptors.columns" class="md-nav__link">
    <span class="md-ellipsis">
      columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.shape.USRDescriptors.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.shape.USRDescriptors.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.shape.USRDescriptors.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.shape.usrdistance" class="md-nav__link">
    <span class="md-ellipsis">
      usrdistance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="usrdistance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#atoms-featurizer" class="md-nav__link">
    <span class="md-ellipsis">
      Atoms Featurizer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.atom" class="md-nav__link">
    <span class="md-ellipsis">
      atom
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.atom.AtomCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      AtomCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AtomCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.atom.AtomCalculator.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.atom.AtomCalculator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.atom.AtomCalculator.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.atom.AtomCalculator.feat_size" class="md-nav__link">
    <span class="md-ellipsis">
      feat_size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.atom.AtomCalculator.from_state_dict" class="md-nav__link">
    <span class="md-ellipsis">
      from_state_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.atom.AtomCalculator.to_state_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_state_dict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.atom.AtomMaterialCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      AtomMaterialCalculator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.atom.DGLCanonicalAtomCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      DGLCanonicalAtomCalculator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.atom.DGLWeaveAtomCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      DGLWeaveAtomCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DGLWeaveAtomCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.atom.DGLWeaveAtomCalculator.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.atom.DGLWeaveAtomCalculator.atom_weave_props" class="md-nav__link">
    <span class="md-ellipsis">
      atom_weave_props
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bonds-featurizer" class="md-nav__link">
    <span class="md-ellipsis">
      Bonds Featurizer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.bond" class="md-nav__link">
    <span class="md-ellipsis">
      bond
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.bond.BondCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      BondCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BondCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.BondCalculator.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.BondCalculator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.BondCalculator.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.BondCalculator.feat_size" class="md-nav__link">
    <span class="md-ellipsis">
      feat_size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.BondCalculator.from_state_dict" class="md-nav__link">
    <span class="md-ellipsis">
      from_state_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.BondCalculator.to_state_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_state_dict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.bond.DGLCanonicalBondCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      DGLCanonicalBondCalculator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.bond.DGLWeaveEdgeCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      DGLWeaveEdgeCalculator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#molfeat.calc.bond.EdgeMatCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      EdgeMatCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EdgeMatCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.EdgeMatCalculator.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.EdgeMatCalculator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.EdgeMatCalculator.feat_size" class="md-nav__link">
    <span class="md-ellipsis">
      feat_size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.EdgeMatCalculator.from_state_dict" class="md-nav__link">
    <span class="md-ellipsis">
      from_state_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molfeat.calc.bond.EdgeMatCalculator.to_state_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_state_dict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="calculators"><code>Calculators</code><a class="headerlink" href="#calculators" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="molfeat.calc"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="molfeat.calc.get_calculator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_calculator</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></code>

<a href="#molfeat.calc.get_calculator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get molecular calculator based on name</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the featurizer</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameters of the featurizer</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When featurizer is not supported</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>featurizer</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Callable</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_calculator</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get molecular calculator based on name</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Name of the featurizer</span>
<span class="sd">        params (dict): Parameters of the featurizer</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: When featurizer is not supported</span>

<span class="sd">    Returns:</span>
<span class="sd">        featurizer: Callable</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">name</span>

    <span class="n">CALC_MAP</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_CALCULATORS</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">FP_FUNCS</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">featurizer</span> <span class="o">=</span> <span class="n">FPCalculator</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;desc3d&quot;</span><span class="p">:</span>
        <span class="n">featurizer</span> <span class="o">=</span> <span class="n">RDKitDescriptors3D</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;desc2d&quot;</span><span class="p">:</span>
        <span class="n">featurizer</span> <span class="o">=</span> <span class="n">RDKitDescriptors2D</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;mordred&quot;</span><span class="p">:</span>
        <span class="n">featurizer</span> <span class="o">=</span> <span class="n">MordredDescriptors</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;cats&quot;</span><span class="p">:</span>
        <span class="n">featurizer</span> <span class="o">=</span> <span class="n">CATS</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;cats2d&quot;</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;use_3d_distances&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">featurizer</span> <span class="o">=</span> <span class="n">CATS</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;cats3d&quot;</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;use_3d_distances&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">featurizer</span> <span class="o">=</span> <span class="n">CATS</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;pharm2d&quot;</span><span class="p">:</span>
        <span class="n">featurizer</span> <span class="o">=</span> <span class="n">Pharmacophore2D</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;pharm3d&quot;</span><span class="p">:</span>
        <span class="n">featurizer</span> <span class="o">=</span> <span class="n">Pharmacophore3D</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;usr&quot;</span><span class="p">):</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">featurizer</span> <span class="o">=</span> <span class="n">USRDescriptors</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;electroshape&quot;</span><span class="p">:</span>
        <span class="n">featurizer</span> <span class="o">=</span> <span class="n">ElectroShapeDescriptors</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;scaffoldkeys&quot;</span><span class="p">,</span> <span class="s2">&quot;skeys&quot;</span><span class="p">,</span> <span class="s2">&quot;scaffkeys&quot;</span><span class="p">]:</span>
        <span class="n">featurizer</span> <span class="o">=</span> <span class="n">ScaffoldKeyCalculator</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
        <span class="n">featurizer</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># for any generic calculator that has been automatically registered</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">CALC_MAP</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">featurizer</span> <span class="o">=</span> <span class="n">CALC_MAP</span><span class="p">[</span><span class="n">name</span><span class="p">](</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not a supported internal featurizer&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">featurizer</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />
<h4 id="serializable-calculator-are-the-base-abstract-class-for-implementing-your-calculators">Serializable Calculator are the base abstract class for implementing your calculators.<a class="headerlink" href="#serializable-calculator-are-the-base-abstract-class-for-implementing-your-calculators" title="Permanent link">&para;</a></h4>


<div class="doc doc-object doc-module">



<a id="molfeat.calc.base"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="molfeat.calc.base.SerializableCalculator" class="doc doc-heading">
            <code>SerializableCalculator</code>


<a href="#molfeat.calc.base.SerializableCalculator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Interface to define a serializable calculator</p>
<details class="tip" open="open">
<summary>Subclassing SerializableCalculator</summary>
<p>When subclassing a calculator, you must implement the <strong>call</strong> method.
If your calculator also implements a <code>batch_compute</code> method, it will be used
by <code>MoleculeTransformer</code> to accelerate featurization.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">molfeat.calc</span> <span class="kn">import</span> <span class="n">SerializableCalculator</span>

<span class="k">class</span> <span class="nc">MyCalculator</span><span class="p">(</span><span class="n">SerializableCalculator</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># you have to implement this</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># you don&#39;t have to implement this but are encouraged to do so</span>
        <span class="c1"># this is used to determine the length of the output</span>
        <span class="o">...</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># you don&#39;t have to implement this</span>
        <span class="c1"># use this to return the name of each entry returned by your featurizer</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">batch_compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mols</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="o">**</span><span class="n">dm_parallelized_kwargs</span><span class="p">):</span>
        <span class="c1"># you don&#39;t need to implement this</span>
        <span class="c1"># but you should if there is an efficient batching process</span>
        <span class="c1"># By default dm.parallelized arguments will also be passed as input</span>
        <span class="o">...</span>
</code></pre></div>
</details>






              <details class="quote">
                <summary>Source code in <code>molfeat/calc/base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SerializableCalculator</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">_CalculatorMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface to define a serializable calculator</span>

<span class="sd">    ???+ tip &quot;Subclassing SerializableCalculator&quot;</span>
<span class="sd">        When subclassing a calculator, you must implement the __call__ method.</span>
<span class="sd">        If your calculator also implements a `batch_compute` method, it will be used</span>
<span class="sd">        by `MoleculeTransformer` to accelerate featurization.</span>

<span class="sd">        ```python</span>
<span class="sd">        from molfeat.calc import SerializableCalculator</span>

<span class="sd">        class MyCalculator(SerializableCalculator):</span>

<span class="sd">            def __call__(self, mol, **kwargs):</span>
<span class="sd">                # you have to implement this</span>
<span class="sd">                ...</span>

<span class="sd">            def __len__(self):</span>
<span class="sd">                # you don&#39;t have to implement this but are encouraged to do so</span>
<span class="sd">                # this is used to determine the length of the output</span>
<span class="sd">                ...</span>

<span class="sd">            @property</span>
<span class="sd">            def columns(self):</span>
<span class="sd">                # you don&#39;t have to implement this</span>
<span class="sd">                # use this to return the name of each entry returned by your featurizer</span>
<span class="sd">                ...</span>

<span class="sd">            def batch_compute(self, mols:list, **dm_parallelized_kwargs):</span>
<span class="sd">                # you don&#39;t need to implement this</span>
<span class="sd">                # but you should if there is an efficient batching process</span>
<span class="sd">                # By default dm.parallelized arguments will also be passed as input</span>
<span class="sd">                ...</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_state_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">override_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load from state dictionary</span>

<span class="sd">        Args:</span>
<span class="sd">            state: dictionary to use to create the the calculator</span>
<span class="sd">            overrride_args: optional dictionary of arguments to override the ones in the state dict</span>
<span class="sd">                at construction of the new object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">module_name</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;module&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
        <span class="n">klass</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="p">(</span><span class="n">override_args</span> <span class="ow">or</span> <span class="p">{}))</span>
        <span class="k">return</span> <span class="n">klass</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_state_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the state dictionary&quot;&quot;&quot;</span>
        <span class="n">state_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;module&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getstate__</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;_molfeat_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MOLFEAT_VERSION</span>
        <span class="c1"># we would like to keep input arguments as is.</span>
        <span class="n">signature</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">default</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">signature</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
            <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state_dict</span>

    <span class="k">def</span> <span class="nf">to_state_json</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Output this instance as a JSON representation&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_state_dict</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">to_state_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Output this instance as a YAML representation&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_state_dict</span><span class="p">(),</span> <span class="n">Dumper</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">SafeDumper</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_state_json_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the state of this instance as a JSON file&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_state_json</span><span class="p">())</span>  <span class="c1"># type: ignore</span>

    <span class="k">def</span> <span class="nf">to_state_yaml_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the state of this instance as a YAML file&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_state_yaml</span><span class="p">())</span>  <span class="c1"># type: ignore</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_state_json</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">state_json</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">override_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">state_dict</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">state_json</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_state_dict</span><span class="p">(</span><span class="n">state_dict</span><span class="p">,</span> <span class="n">override_args</span><span class="o">=</span><span class="n">override_args</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_state_yaml</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">state_yaml</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">override_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">state_dict</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">state_yaml</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">SafeLoader</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_state_dict</span><span class="p">(</span><span class="n">state_dict</span><span class="p">,</span> <span class="n">override_args</span><span class="o">=</span><span class="n">override_args</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_state_json_file</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">override_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">with</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">featurizer</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_state_json</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">override_args</span><span class="o">=</span><span class="n">override_args</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">return</span> <span class="n">featurizer</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_state_yaml_file</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">override_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">with</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">featurizer</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_state_yaml</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">override_args</span><span class="o">=</span><span class="n">override_args</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">return</span> <span class="n">featurizer</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_state_file</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">state_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">override_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">state_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;yaml&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">state_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;yml&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_state_yaml_file</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">state_path</span><span class="p">,</span> <span class="n">override_args</span><span class="o">=</span><span class="n">override_args</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">state_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;json&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_state_json_file</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">state_path</span><span class="p">,</span> <span class="n">override_args</span><span class="o">=</span><span class="n">override_args</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">state_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;pkl&quot;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">state_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">IN</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Only files with &#39;yaml&#39; or &#39;json&#39; format are allowed. &quot;</span>
            <span class="s2">&quot;The filename must be ending with `yaml`, &#39;yml&#39; or &#39;json&#39;.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.base.SerializableCalculator.from_state_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_state_dict</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">override_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#molfeat.calc.base.SerializableCalculator.from_state_dict" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Load from state dictionary</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary to use to create the the calculator</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overrride_args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>optional dictionary of arguments to override the ones in the state dict
at construction of the new object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_state_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">override_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load from state dictionary</span>

<span class="sd">    Args:</span>
<span class="sd">        state: dictionary to use to create the the calculator</span>
<span class="sd">        overrride_args: optional dictionary of arguments to override the ones in the state dict</span>
<span class="sd">            at construction of the new object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cls_name</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">module_name</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;module&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
    <span class="n">klass</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="p">(</span><span class="n">override_args</span> <span class="ow">or</span> <span class="p">{}))</span>
    <span class="k">return</span> <span class="n">klass</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.base.SerializableCalculator.to_state_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_state_dict</span><span class="p">()</span></code>

<a href="#molfeat.calc.base.SerializableCalculator.to_state_dict" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the state dictionary</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_state_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the state dictionary&quot;&quot;&quot;</span>
    <span class="n">state_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;module&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span>
    <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getstate__</span><span class="p">()</span>
    <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;_molfeat_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MOLFEAT_VERSION</span>
    <span class="c1"># we would like to keep input arguments as is.</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
    <span class="n">val</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">default</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">signature</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.base.SerializableCalculator.to_state_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_state_json</span><span class="p">()</span></code>

<a href="#molfeat.calc.base.SerializableCalculator.to_state_json" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Output this instance as a JSON representation</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_state_json</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Output this instance as a JSON representation&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_state_dict</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.base.SerializableCalculator.to_state_json_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_state_json_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

<a href="#molfeat.calc.base.SerializableCalculator.to_state_json_file" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Save the state of this instance as a JSON file</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_state_json_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save the state of this instance as a JSON file&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_state_json</span><span class="p">())</span>  <span class="c1"># type: ignore</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.base.SerializableCalculator.to_state_yaml" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_state_yaml</span><span class="p">()</span></code>

<a href="#molfeat.calc.base.SerializableCalculator.to_state_yaml" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Output this instance as a YAML representation</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_state_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Output this instance as a YAML representation&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_state_dict</span><span class="p">(),</span> <span class="n">Dumper</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">SafeDumper</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.base.SerializableCalculator.to_state_yaml_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_state_yaml_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

<a href="#molfeat.calc.base.SerializableCalculator.to_state_yaml_file" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Save the state of this instance as a YAML file</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_state_yaml_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save the state of this instance as a YAML file&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_state_yaml</span><span class="p">())</span>  <span class="c1"># type: ignore</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><hr />
<h3 id="fingerprints"><code>Fingerprints</code><a class="headerlink" href="#fingerprints" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="molfeat.calc.fingerprints"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="molfeat.calc.fingerprints.FPCalculator" class="doc doc-heading">
            <code>FPCalculator</code>


<a href="#molfeat.calc.fingerprints.FPCalculator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="molfeat.calc.base.SerializableCalculator" href="#molfeat.calc.base.SerializableCalculator">SerializableCalculator</a></code></p>


        <p>Fingerprint bit calculator for a molecule</p>






              <details class="quote">
                <summary>Source code in <code>molfeat/calc/fingerprints.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FPCalculator</span><span class="p">(</span><span class="n">SerializableCalculator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fingerprint bit calculator for a molecule&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">length</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">counting</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">method_params</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the given fingeprint for a molecule</span>

<span class="sd">        !!! note</span>
<span class="sd">            For efficiency reason, count fingerprints are hashed and potentially</span>
<span class="sd">            re-folded and the count corresponds to the number of bits set to true</span>

<span class="sd">        Args:</span>
<span class="sd">            method (str): Name of the fingerprint method to use. See FPCalculator.available_fingerprints() for a list</span>
<span class="sd">            length (int, optional): Length of the fingerprint. Defaults to None.</span>
<span class="sd">                The default corresponds to the fingerpint default.</span>
<span class="sd">            counting (bool, optional): Whether to use the count version of the fingerprint</span>
<span class="sd">            method_params (dict): any parameters to the fingerprint algorithm.</span>
<span class="sd">                See FPCalculator.default_parameters(method) for all the parameters required by a given method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counting</span> <span class="o">=</span> <span class="n">counting</span> <span class="ow">or</span> <span class="s2">&quot;-count&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counting</span> <span class="ow">and</span> <span class="s2">&quot;-count&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">+</span> <span class="s2">&quot;-count&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_length</span> <span class="o">=</span> <span class="n">length</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">FP_FUNCS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Method </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s2"> is not a supported featurizer&quot;</span><span class="p">)</span>
        <span class="n">default_params</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">FP_DEF_PARAMS</span><span class="p">[</span><span class="n">method</span><span class="p">])</span>
        <span class="n">unknown_params</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">method_params</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">default_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">unknown_params</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Params: </span><span class="si">{</span><span class="n">unknown_params</span><span class="si">}</span><span class="s2"> are not valid for </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">default_params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">method_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">method_params</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">default_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_length</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">available_fingerprints</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the list of available fingerprints&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">FP_FUNCS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">default_parameters</span><span class="p">(</span><span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the default parameters for a given fingerprint method</span>

<span class="sd">        Args:</span>
<span class="sd">            method: name of the fingerprint method</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">FP_DEF_PARAMS</span><span class="p">[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the name of all the descriptors of this calculator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;fp_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">)]</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the length of the calculator&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span>

    <span class="k">def</span> <span class="nf">_set_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the length of the featurizer&quot;&quot;&quot;</span>
        <span class="n">fplen</span> <span class="o">=</span> <span class="n">length</span>
        <span class="n">len_key</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;maccs&quot;</span><span class="p">:</span>
            <span class="n">fplen</span> <span class="o">=</span> <span class="mi">167</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;estate&quot;</span><span class="p">:</span>
            <span class="n">fplen</span> <span class="o">=</span> <span class="mi">79</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;erg&quot;</span><span class="p">:</span>
            <span class="n">fplen</span> <span class="o">=</span> <span class="mi">315</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;rdkit-count&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">fplen</span><span class="p">:</span>
            <span class="n">fplen</span> <span class="o">=</span> <span class="mi">2048</span>
        <span class="k">elif</span> <span class="s2">&quot;nBits&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">len_key</span> <span class="o">=</span> <span class="s2">&quot;nBits&quot;</span>
            <span class="n">fplen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">len_key</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s2">&quot;n_permutations&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># special case for mhfp</span>
            <span class="n">len_key</span> <span class="o">=</span> <span class="s2">&quot;n_permutations&quot;</span>
            <span class="n">fplen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">len_key</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s2">&quot;fpSize&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">len_key</span> <span class="o">=</span> <span class="s2">&quot;fpSize&quot;</span>
            <span class="n">fplen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">len_key</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s2">&quot;dimensions&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">len_key</span> <span class="o">=</span> <span class="s2">&quot;dimensions&quot;</span>
            <span class="n">fplen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">len_key</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">len_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">length</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">len_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">length</span>
            <span class="n">fplen</span> <span class="o">=</span> <span class="n">length</span>
        <span class="k">return</span> <span class="n">fplen</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the Fingerprint of a molecule</span>

<span class="sd">        Args:</span>
<span class="sd">            mol: the molecule of interest</span>
<span class="sd">            raw: whether to keep original datatype or convert to numpy. Useful for rdkit&#39;s similarity functions</span>

<span class="sd">        Returns:</span>
<span class="sd">            props (np.ndarray): list of computed rdkit molecular descriptors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>

        <span class="n">fp_func</span> <span class="o">=</span> <span class="n">FP_FUNCS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="n">FP_GENERATORS</span><span class="p">:</span>
            <span class="n">fp_func</span> <span class="o">=</span> <span class="n">fp_func</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counting</span><span class="p">:</span>
                <span class="n">fp_val</span> <span class="o">=</span> <span class="n">fp_func</span><span class="o">.</span><span class="n">GetCountFingerprint</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fp_val</span> <span class="o">=</span> <span class="n">fp_func</span><span class="o">.</span><span class="n">GetFingerprint</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fp_val</span> <span class="o">=</span> <span class="n">fp_func</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counting</span><span class="p">:</span>
            <span class="n">fp_val</span> <span class="o">=</span> <span class="n">fold_count_fp</span><span class="p">(</span><span class="n">fp_val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">raw</span><span class="p">:</span>
            <span class="n">fp_val</span> <span class="o">=</span> <span class="n">to_numpy</span><span class="p">(</span><span class="n">fp_val</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counting</span> <span class="ow">and</span> <span class="n">raw</span><span class="p">:</span>
            <span class="c1"># converint the counted values to SparseInt again</span>
            <span class="n">fp_val</span> <span class="o">=</span> <span class="n">to_fp</span><span class="p">(</span><span class="n">fp_val</span><span class="p">,</span> <span class="n">bitvect</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fp_val</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># EN: note that the state is standardized with all the parameter</span>
        <span class="c1"># because of the possibility of default changing after</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_length</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;input_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_length</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;counting&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counting</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="p">(</span><span class="n">v</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SERIALIZABLE_CLASSES</span> <span class="k">else</span> <span class="n">v</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the state of the featurizer&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="p">(</span><span class="n">v</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SERIALIZABLE_CLASSES</span> <span class="k">else</span> <span class="n">SERIALIZABLE_CLASSES</span><span class="p">[</span><span class="n">v</span><span class="p">]())</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_length</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_length</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_state_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the state dictionary&quot;&quot;&quot;</span>
        <span class="n">state_dict</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">to_state_dict</span><span class="p">()</span>
        <span class="n">cur_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
        <span class="n">default_params</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">FP_DEF_PARAMS</span><span class="p">[</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]])</span>

        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="p">(</span>
                    <span class="n">cur_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">cur_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SERIALIZABLE_CLASSES</span>
                    <span class="k">else</span> <span class="n">cur_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">cur_params</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">cur_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">default_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">and</span> <span class="n">cur_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="c1"># we want to keep all the additional parameters in the state dict</span>
        <span class="k">return</span> <span class="n">state_dict</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="molfeat.calc.fingerprints.FPCalculator.columns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">columns</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#molfeat.calc.fingerprints.FPCalculator.columns" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the name of all the descriptors of this calculator</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.fingerprints.FPCalculator.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#molfeat.calc.fingerprints.FPCalculator.__call__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute the Fingerprint of a molecule</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mol</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="datamol.Mol">Mol</span>, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the molecule of interest</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raw</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to keep original datatype or convert to numpy. Useful for rdkit's similarity functions</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>props</code></td>            <td>
                  <code><span title="np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of computed rdkit molecular descriptors</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/fingerprints.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the Fingerprint of a molecule</span>

<span class="sd">    Args:</span>
<span class="sd">        mol: the molecule of interest</span>
<span class="sd">        raw: whether to keep original datatype or convert to numpy. Useful for rdkit&#39;s similarity functions</span>

<span class="sd">    Returns:</span>
<span class="sd">        props (np.ndarray): list of computed rdkit molecular descriptors</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>

    <span class="n">fp_func</span> <span class="o">=</span> <span class="n">FP_FUNCS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="n">FP_GENERATORS</span><span class="p">:</span>
        <span class="n">fp_func</span> <span class="o">=</span> <span class="n">fp_func</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counting</span><span class="p">:</span>
            <span class="n">fp_val</span> <span class="o">=</span> <span class="n">fp_func</span><span class="o">.</span><span class="n">GetCountFingerprint</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fp_val</span> <span class="o">=</span> <span class="n">fp_func</span><span class="o">.</span><span class="n">GetFingerprint</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fp_val</span> <span class="o">=</span> <span class="n">fp_func</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counting</span><span class="p">:</span>
        <span class="n">fp_val</span> <span class="o">=</span> <span class="n">fold_count_fp</span><span class="p">(</span><span class="n">fp_val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">raw</span><span class="p">:</span>
        <span class="n">fp_val</span> <span class="o">=</span> <span class="n">to_numpy</span><span class="p">(</span><span class="n">fp_val</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counting</span> <span class="ow">and</span> <span class="n">raw</span><span class="p">:</span>
        <span class="c1"># converint the counted values to SparseInt again</span>
        <span class="n">fp_val</span> <span class="o">=</span> <span class="n">to_fp</span><span class="p">(</span><span class="n">fp_val</span><span class="p">,</span> <span class="n">bitvect</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fp_val</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.fingerprints.FPCalculator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">counting</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">method_params</span><span class="p">)</span></code>

<a href="#molfeat.calc.fingerprints.FPCalculator.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute the given fingeprint for a molecule</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For efficiency reason, count fingerprints are hashed and potentially
re-folded and the count corresponds to the number of bits set to true</p>
</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the fingerprint method to use. See FPCalculator.available_fingerprints() for a list</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>length</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Length of the fingerprint. Defaults to None.
The default corresponds to the fingerpint default.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>counting</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use the count version of the fingerprint</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method_params</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>any parameters to the fingerprint algorithm.
See FPCalculator.default_parameters(method) for all the parameters required by a given method.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/fingerprints.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">length</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">counting</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">method_params</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the given fingeprint for a molecule</span>

<span class="sd">    !!! note</span>
<span class="sd">        For efficiency reason, count fingerprints are hashed and potentially</span>
<span class="sd">        re-folded and the count corresponds to the number of bits set to true</span>

<span class="sd">    Args:</span>
<span class="sd">        method (str): Name of the fingerprint method to use. See FPCalculator.available_fingerprints() for a list</span>
<span class="sd">        length (int, optional): Length of the fingerprint. Defaults to None.</span>
<span class="sd">            The default corresponds to the fingerpint default.</span>
<span class="sd">        counting (bool, optional): Whether to use the count version of the fingerprint</span>
<span class="sd">        method_params (dict): any parameters to the fingerprint algorithm.</span>
<span class="sd">            See FPCalculator.default_parameters(method) for all the parameters required by a given method.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">counting</span> <span class="o">=</span> <span class="n">counting</span> <span class="ow">or</span> <span class="s2">&quot;-count&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counting</span> <span class="ow">and</span> <span class="s2">&quot;-count&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">+</span> <span class="s2">&quot;-count&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_length</span> <span class="o">=</span> <span class="n">length</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">FP_FUNCS</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Method </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s2"> is not a supported featurizer&quot;</span><span class="p">)</span>
    <span class="n">default_params</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">FP_DEF_PARAMS</span><span class="p">[</span><span class="n">method</span><span class="p">])</span>
    <span class="n">unknown_params</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">method_params</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">default_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">unknown_params</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Params: </span><span class="si">{</span><span class="n">unknown_params</span><span class="si">}</span><span class="s2"> are not valid for </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">default_params</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">method_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">method_params</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">default_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_length</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.fingerprints.FPCalculator.__len__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__len__</span><span class="p">()</span></code>

<a href="#molfeat.calc.fingerprints.FPCalculator.__len__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return the length of the calculator</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/fingerprints.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the length of the calculator&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.fingerprints.FPCalculator.__setstate__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__setstate__</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></code>

<a href="#molfeat.calc.fingerprints.FPCalculator.__setstate__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Set the state of the featurizer</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/fingerprints.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the state of the featurizer&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="p">(</span><span class="n">v</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SERIALIZABLE_CLASSES</span> <span class="k">else</span> <span class="n">SERIALIZABLE_CLASSES</span><span class="p">[</span><span class="n">v</span><span class="p">]())</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_length</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_length</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.fingerprints.FPCalculator.available_fingerprints" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">available_fingerprints</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#molfeat.calc.fingerprints.FPCalculator.available_fingerprints" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the list of available fingerprints</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/fingerprints.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">available_fingerprints</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the list of available fingerprints&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">FP_FUNCS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.fingerprints.FPCalculator.default_parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">default_parameters</span><span class="p">(</span><span class="n">method</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#molfeat.calc.fingerprints.FPCalculator.default_parameters" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the default parameters for a given fingerprint method</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the fingerprint method</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/fingerprints.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">default_parameters</span><span class="p">(</span><span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the default parameters for a given fingerprint method</span>

<span class="sd">    Args:</span>
<span class="sd">        method: name of the fingerprint method</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">FP_DEF_PARAMS</span><span class="p">[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.fingerprints.FPCalculator.to_state_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_state_dict</span><span class="p">()</span></code>

<a href="#molfeat.calc.fingerprints.FPCalculator.to_state_dict" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the state dictionary</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/fingerprints.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_state_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the state dictionary&quot;&quot;&quot;</span>
    <span class="n">state_dict</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">to_state_dict</span><span class="p">()</span>
    <span class="n">cur_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
    <span class="n">default_params</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">FP_DEF_PARAMS</span><span class="p">[</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]])</span>

    <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="p">(</span>
                <span class="n">cur_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">cur_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SERIALIZABLE_CLASSES</span>
                <span class="k">else</span> <span class="n">cur_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">cur_params</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cur_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">default_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">and</span> <span class="n">cur_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="c1"># we want to keep all the additional parameters in the state dict</span>
    <span class="k">return</span> <span class="n">state_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><hr />
<h3 id="cats"><code>CATS</code><a class="headerlink" href="#cats" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="molfeat.calc.cats"></a>
    <div class="doc doc-contents first">

        <p>CATS 2D and 3D implementation based on original work by
Rajarshi Guha <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#114;&#103;&#117;&#104;&#97;&#64;&#105;&#110;&#100;&#105;&#97;&#110;&#97;&#46;&#101;&#100;&#117;">&#114;&#103;&#117;&#104;&#97;&#64;&#105;&#110;&#100;&#105;&#97;&#110;&#97;&#46;&#101;&#100;&#117;</a> 08/26/07 and Chris Arthur 1/11/2015 Rdkit port
This version modernizes the code, improve performance, add supports for 3D
as well as allowing distance binning.
see: <a href="https://masterchemoinfo.u-strasbg.fr/Documents/Conferences/Lecture1_Pharmacophores_Schneider.pdf">https://masterchemoinfo.u-strasbg.fr/Documents/Conferences/Lecture1_Pharmacophores_Schneider.pdf</a></p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="molfeat.calc.cats.CATS" class="doc doc-heading">
            <code>CATS</code>


<a href="#molfeat.calc.cats.CATS" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="molfeat.calc.base.SerializableCalculator" href="#molfeat.calc.base.SerializableCalculator">SerializableCalculator</a></code></p>


        <p>Cats descriptors calculator based on PPPs (potential pharmacophore points). Can be either 2D or 3D.</p>
<p>!!! note:
    We need to consider all pairwise combination of the 6 PPPs described in <code>CATS2D.SMARTS</code>
    which would be $P(6,2) + 6$. However, as we only consider lexicographic order, the total size
    is then $rac{P(6,2)}{2} + 6 = 21$, explaining the size of <code>CATS2D.DESCRIPTORS</code></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The CATS descriptor are sensitive to the number of atoms in a molecule, meaning, you would get different
results if you add or remove hydrogen atoms</p>
</div>






              <details class="quote">
                <summary>Source code in <code>molfeat/calc/cats.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CATS</span><span class="p">(</span><span class="n">SerializableCalculator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cats descriptors calculator based on PPPs (potential pharmacophore points). Can be either 2D or 3D.</span>

<span class="sd">    !!! note:</span>
<span class="sd">        We need to consider all pairwise combination of the 6 PPPs described in `CATS2D.SMARTS`</span>
<span class="sd">        which would be $P(6,2) + 6$. However, as we only consider lexicographic order, the total size</span>
<span class="sd">        is then $\frac{P(6,2)}{2} + 6 = 21$, explaining the size of `CATS2D.DESCRIPTORS`</span>

<span class="sd">    !!! tip</span>
<span class="sd">        The CATS descriptor are sensitive to the number of atoms in a molecule, meaning, you would get different</span>
<span class="sd">        results if you add or remove hydrogen atoms</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SMARTS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;D&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;[!$([#6,H0,-,-2,-3])]&quot;</span><span class="p">],</span>
        <span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;[!$([#6,F,Cl,Br,I,o,s,nX3,#7v5,#15v5,#16v4,#16v6,*+1,*+2,*+3])]&quot;</span><span class="p">],</span>
        <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;[*+]&quot;</span><span class="p">,</span> <span class="s2">&quot;[#7H2]&quot;</span><span class="p">],</span>
        <span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;[*-]&quot;</span><span class="p">,</span> <span class="s2">&quot;[C&amp;$(C(=O)O),P&amp;$(P(=O)),S&amp;$(S(=O)O)]&quot;</span><span class="p">],</span>
        <span class="s2">&quot;L&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;[Cl,Br,I]&quot;</span><span class="p">,</span>
            <span class="s2">&quot;[S;D2;$(S(C)(C))]&quot;</span><span class="p">,</span>
            <span class="s2">&quot;[C;D2;$(C(=C)(=C))]&quot;</span><span class="p">,</span>
            <span class="s2">&quot;[C;D3;$(C(=C)(C)(C))]&quot;</span><span class="p">,</span>
            <span class="s2">&quot;[C;D4;$(C(C)(C)(C)(C))]&quot;</span><span class="p">,</span>
            <span class="s2">&quot;[C;D3;H1;$(C(C)(C)(C))]&quot;</span><span class="p">,</span>
            <span class="s2">&quot;[C;D2;H2;$(C(C)(C))]&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s2">&quot;R&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;[a]&quot;</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="n">DESCRIPTORS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;DD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;AD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;AA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;AP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;AN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;AL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;AR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;RR&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">MAX_DIST_DEFAULT_2D</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">MAX_DIST_DEFAULT_3D</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">max_dist</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bins</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;raw&quot;</span><span class="p">,</span>
        <span class="n">use_3d_distances</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculator for the CATS descriptors.</span>

<span class="sd">        `max_dist` and `bins` will both determine the length of the fingerprint vector,</span>
<span class="sd">        which you can get by calling `len(calc)`</span>

<span class="sd">        Args:</span>
<span class="sd">            max_dist: Maximum distance between pairs. When set to None, the default for 2D is</span>
<span class="sd">                set to `max_dist=8` and for 3D to `max_dist=5`.</span>
<span class="sd">            bins: Bins to use. Defaults to equal spacing `[0, max_dist[`.</span>
<span class="sd">            scale: How to scale the values. Supported values are:</span>
<span class="sd">                 - &#39;raw&#39; for the raw values.</span>
<span class="sd">                 - &#39;num&#39; for values normalized by the number of atoms.</span>
<span class="sd">                 - &#39;count&#39; for scaling based on occurence of the PPP.</span>
<span class="sd">            use_3d_distances: Whether to use the 3D distances instead of the topological distances.</span>
<span class="sd">                If set to True, the input molecules must contain a conformer.</span>
<span class="sd">            kwargs: silently ignored extra parameters for compatibility with other calculators.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Set the max_dist default is set to None</span>
        <span class="k">if</span> <span class="n">max_dist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_3d_distances</span><span class="p">:</span>
                <span class="n">max_dist</span> <span class="o">=</span> <span class="n">CATS</span><span class="o">.</span><span class="n">MAX_DIST_DEFAULT_3D</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">max_dist</span> <span class="o">=</span> <span class="n">CATS</span><span class="o">.</span><span class="n">MAX_DIST_DEFAULT_2D</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_dist</span> <span class="o">=</span> <span class="n">max_dist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_3d_distances</span> <span class="o">=</span> <span class="n">use_3d_distances</span>

        <span class="k">if</span> <span class="n">bins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bins</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_dist</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># we don&#39;t allow interaction that exceed our distance threshold.</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bins</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_dist</span><span class="p">]</span>

        <span class="c1"># we start distance indexing at 0</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bins</span><span class="p">:</span>
            <span class="n">bins</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">bins</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_columns</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_set_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DESCRIPTORS</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">.bins-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_pattern_to_mols</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">smarts_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert dict of list of smarts to rdkit molecules&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">smarts_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">smarts_dict</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">SMARTS</span>

        <span class="n">smarts_mols</span> <span class="o">=</span> <span class="n">ddict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">patterns</span> <span class="ow">in</span> <span class="n">smarts_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">patterns</span> <span class="o">=</span> <span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="n">patt</span><span class="p">)</span> <span class="k">for</span> <span class="n">patt</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">]</span>
            <span class="n">smarts_mols</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">patterns</span>

        <span class="k">return</span> <span class="n">smarts_mols</span>

    <span class="k">def</span> <span class="nf">_get_pcore_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign a PPP (potential pharmacophore points) to individual atoms of a molecule.</span>

<span class="sd">        !!! note</span>
<span class="sd">            The return value is a list of length `N_atoms` of the</span>
<span class="sd">            input molecule. The i&#39;th element of the list contains</span>
<span class="sd">            a list of PPP labels that were identified for the i&#39;th atom</span>

<span class="sd">        Args:</span>
<span class="sd">            mol: the molecule of interest</span>

<span class="sd">        Returns:</span>
<span class="sd">            ppp_labels (List[list]): list of all PPP labels for each atoms</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">smarts_mols</span> <span class="o">=</span> <span class="n">CATS</span><span class="o">.</span><span class="n">_pattern_to_mols</span><span class="p">()</span>

        <span class="n">ppp_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">())]</span>
        <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">patterns</span> <span class="ow">in</span> <span class="n">smarts_mols</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">:</span>
                <span class="n">matched</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">matchbase</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">matchbase</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ppp_labels</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                            <span class="n">ppp_labels</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">tmp</span> <span class="o">=</span> <span class="n">ppp_labels</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                            <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
                            <span class="n">ppp_labels</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
                    <span class="n">matched</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">matched</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="n">ppp_labels</span>

    <span class="k">def</span> <span class="nf">_get_ppp_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_atoms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ppp_labels</span><span class="p">:</span> <span class="n">List</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute PPP matrix from label list</span>

<span class="sd">        Args:</span>
<span class="sd">            n_atoms (int): number of atoms</span>
<span class="sd">            ppp_labels (list): PPP labels returned by</span>

<span class="sd">        Returns:</span>
<span class="sd">            pppm (dict): PPP matrix where the keys are the coordinate</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pppm</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_atoms</span><span class="p">):</span>
            <span class="n">ppp_i</span> <span class="o">=</span> <span class="n">ppp_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ppp_i</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_atoms</span><span class="p">):</span>
                <span class="n">ppp_j</span> <span class="o">=</span> <span class="n">ppp_labels</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">ppp_j</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">pairs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ppp_i</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ppp_j</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pairs</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
                            <span class="c1">## make sure to add the labels in increasing</span>
                            <span class="c1">## lexicographical order</span>
                            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">:</span>
                                <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                            <span class="n">pairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
                <span class="n">pppm</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">pairs</span>
        <span class="k">return</span> <span class="n">pppm</span>

    <span class="k">def</span> <span class="nf">_calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">,</span> <span class="n">dist_mat</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the CATS2D descriptors for current molecule, given a distance matrix&quot;&quot;&quot;</span>

        <span class="n">n_atoms</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">()</span>
        <span class="n">ppp_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pcore_group</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="n">ppp_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ppp_matrix</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">,</span> <span class="n">ppp_labels</span><span class="p">)</span>

        <span class="c1"># get the counturence of each of the PPP&#39;s</span>
        <span class="n">ppp_count</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ppp_labels</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ppp</span> <span class="ow">in</span> <span class="n">label</span><span class="p">:</span>
                <span class="n">ppp_count</span><span class="p">[</span><span class="n">ppp</span><span class="p">]</span> <span class="o">=</span> <span class="n">ppp_count</span><span class="p">[</span><span class="n">ppp</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># lets calculate the CATS2D raw descriptor</span>
        <span class="c1"># bins: a, b, c ==&gt; [a, b], [b, c], [c, *]</span>
        <span class="c1"># a is always 0</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">))]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DESCRIPTORS</span><span class="p">))]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">labels</span> <span class="ow">in</span> <span class="n">ppp_mat</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">dist_mat</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>
            <span class="c1"># ignore all interactions greater than the max distance we set</span>
            <span class="c1"># we cannot have negative distance</span>
            <span class="k">if</span> <span class="n">dist</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_dist</span> <span class="ow">or</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DESCRIPTORS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}{</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="n">dist_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">)</span>
                <span class="c1"># indexing at 0</span>
                <span class="n">vals</span><span class="p">[</span><span class="n">dist_bin</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">desc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;num&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                    <span class="n">desc</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">])</span> <span class="o">/</span> <span class="n">n_atoms</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span>
            <span class="c1">#  get the scaling factors</span>
            <span class="n">facs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DESCRIPTORS</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">ppp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DESCRIPTORS</span><span class="p">:</span>
                <span class="n">facs</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">ppp_count</span><span class="p">[</span><span class="n">ppp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">ppp_count</span><span class="p">[</span><span class="n">ppp</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># each row in desc corresponds to a PPP pair</span>
            <span class="c1"># so the scale factor is constant over cols of a row</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">facs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                    <span class="n">desc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">facs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the length of the calculator&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">conformer_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get CATS 2D descriptors for a molecule</span>

<span class="sd">        Args:</span>
<span class="sd">            mol: the molecule of interest.</span>
<span class="sd">            conformer_id: Optional conformer id. Only relevant when `use_3d_distances`</span>
<span class="sd">                is set to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            props (np.ndarray): list of computed rdkit molecular descriptors</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_3d_distances</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumConformers</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected a molecule with conformers information.&quot;</span><span class="p">)</span>

            <span class="n">dist_mat</span> <span class="o">=</span> <span class="n">Get3DDistanceMatrix</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">confId</span><span class="o">=</span><span class="n">conformer_id</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">dist_mat</span> <span class="o">=</span> <span class="n">GetDistanceMatrix</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">dist_mat</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">to_numpy</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the descriptors columns&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Serialize the class for pickling.&quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;max_dist&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_dist</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;use_3d_distances&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_3d_distances</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reload the class from pickling.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_columns</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="molfeat.calc.cats.CATS.columns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">columns</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#molfeat.calc.cats.CATS.columns" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the descriptors columns</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.cats.CATS.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">conformer_id</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#molfeat.calc.cats.CATS.__call__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get CATS 2D descriptors for a molecule</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mol</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="datamol.Mol">Mol</span>, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the molecule of interest.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conformer_id</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional conformer id. Only relevant when <code>use_3d_distances</code>
is set to True.</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>props</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of computed rdkit molecular descriptors</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/cats.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">conformer_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get CATS 2D descriptors for a molecule</span>

<span class="sd">    Args:</span>
<span class="sd">        mol: the molecule of interest.</span>
<span class="sd">        conformer_id: Optional conformer id. Only relevant when `use_3d_distances`</span>
<span class="sd">            is set to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        props (np.ndarray): list of computed rdkit molecular descriptors</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_3d_distances</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumConformers</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected a molecule with conformers information.&quot;</span><span class="p">)</span>

        <span class="n">dist_mat</span> <span class="o">=</span> <span class="n">Get3DDistanceMatrix</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">confId</span><span class="o">=</span><span class="n">conformer_id</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">dist_mat</span> <span class="o">=</span> <span class="n">GetDistanceMatrix</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">dist_mat</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">to_numpy</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.cats.CATS.__getstate__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__getstate__</span><span class="p">()</span></code>

<a href="#molfeat.calc.cats.CATS.__getstate__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Serialize the class for pickling.</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/cats.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Serialize the class for pickling.&quot;&quot;&quot;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;max_dist&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_dist</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;use_3d_distances&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_3d_distances</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.cats.CATS.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">max_dist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="n">use_3d_distances</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#molfeat.calc.cats.CATS.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calculator for the CATS descriptors.</p>
<p><code>max_dist</code> and <code>bins</code> will both determine the length of the fingerprint vector,
which you can get by calling <code>len(calc)</code></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>max_dist</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[float, int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum distance between pairs. When set to None, the default for 2D is
set to <code>max_dist=8</code> and for 3D to <code>max_dist=5</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bins</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bins to use. Defaults to equal spacing <code>[0, max_dist[</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scale</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How to scale the values. Supported values are:
 - 'raw' for the raw values.
 - 'num' for values normalized by the number of atoms.
 - 'count' for scaling based on occurence of the PPP.</p>
              </div>
            </td>
            <td>
                  <code>&#39;raw&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_3d_distances</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use the 3D distances instead of the topological distances.
If set to True, the input molecules must contain a conformer.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>silently ignored extra parameters for compatibility with other calculators.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/cats.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">max_dist</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">bins</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">scale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;raw&quot;</span><span class="p">,</span>
    <span class="n">use_3d_distances</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculator for the CATS descriptors.</span>

<span class="sd">    `max_dist` and `bins` will both determine the length of the fingerprint vector,</span>
<span class="sd">    which you can get by calling `len(calc)`</span>

<span class="sd">    Args:</span>
<span class="sd">        max_dist: Maximum distance between pairs. When set to None, the default for 2D is</span>
<span class="sd">            set to `max_dist=8` and for 3D to `max_dist=5`.</span>
<span class="sd">        bins: Bins to use. Defaults to equal spacing `[0, max_dist[`.</span>
<span class="sd">        scale: How to scale the values. Supported values are:</span>
<span class="sd">             - &#39;raw&#39; for the raw values.</span>
<span class="sd">             - &#39;num&#39; for values normalized by the number of atoms.</span>
<span class="sd">             - &#39;count&#39; for scaling based on occurence of the PPP.</span>
<span class="sd">        use_3d_distances: Whether to use the 3D distances instead of the topological distances.</span>
<span class="sd">            If set to True, the input molecules must contain a conformer.</span>
<span class="sd">        kwargs: silently ignored extra parameters for compatibility with other calculators.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set the max_dist default is set to None</span>
    <span class="k">if</span> <span class="n">max_dist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">use_3d_distances</span><span class="p">:</span>
            <span class="n">max_dist</span> <span class="o">=</span> <span class="n">CATS</span><span class="o">.</span><span class="n">MAX_DIST_DEFAULT_3D</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_dist</span> <span class="o">=</span> <span class="n">CATS</span><span class="o">.</span><span class="n">MAX_DIST_DEFAULT_2D</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">max_dist</span> <span class="o">=</span> <span class="n">max_dist</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">use_3d_distances</span> <span class="o">=</span> <span class="n">use_3d_distances</span>

    <span class="k">if</span> <span class="n">bins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_dist</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>

    <span class="c1"># we don&#39;t allow interaction that exceed our distance threshold.</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bins</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_dist</span><span class="p">]</span>

    <span class="c1"># we start distance indexing at 0</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bins</span><span class="p">:</span>
        <span class="n">bins</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">bins</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_set_columns</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.cats.CATS.__len__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__len__</span><span class="p">()</span></code>

<a href="#molfeat.calc.cats.CATS.__len__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return the length of the calculator</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/cats.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the length of the calculator&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.cats.CATS.__setstate__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__setstate__</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></code>

<a href="#molfeat.calc.cats.CATS.__setstate__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Reload the class from pickling.</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/cats.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reload the class from pickling.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_set_columns</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><hr />
<h3 id="pharmacophore"><code>Pharmacophore</code><a class="headerlink" href="#pharmacophore" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="molfeat.calc.pharmacophore"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="molfeat.calc.pharmacophore.Pharmacophore2D" class="doc doc-heading">
            <code>Pharmacophore2D</code>


<a href="#molfeat.calc.pharmacophore.Pharmacophore2D" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="molfeat.calc.base.SerializableCalculator" href="#molfeat.calc.base.SerializableCalculator">SerializableCalculator</a></code></p>


        <p>2D Pharmacophore.</p>
<p>The fingerprint is computed using <code>Generate.Gen2DFingerprint</code> from RDKit.</p>
<p>An explanation of pharmacophore fingerprints and how the bits are set
is available in the RDKit book. In particular the following figure describes the process.
<img alt="Pharmacophore" src="https://www.rdkit.org/docs/_images/picture_10.jpg" />{ align=left }</p>






              <details class="quote">
                <summary>Source code in <code>molfeat/calc/pharmacophore.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Pharmacophore2D</span><span class="p">(</span><span class="n">SerializableCalculator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;2D Pharmacophore.</span>

<span class="sd">    The fingerprint is computed using `Generate.Gen2DFingerprint` from RDKit.</span>

<span class="sd">    An explanation of pharmacophore fingerprints and how the bits are set</span>
<span class="sd">    is available in the RDKit book. In particular the following figure describes the process.</span>
<span class="sd">    ![Pharmacophore](https://www.rdkit.org/docs/_images/picture_10.jpg){ align=left }</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">factory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MolChemicalFeatureFactory</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;pmapper&quot;</span><span class="p">,</span>
        <span class="n">length</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
        <span class="n">useCounts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">minPointCount</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">maxPointCount</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">shortestPathsOnly</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">includeBondOrder</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">skipFeats</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">trianglePruneBins</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bins</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pharmacophore computation.</span>

<span class="sd">        Args:</span>
<span class="sd">            factory: Which features factory to use. One of &quot;default&quot;, &quot;cats&quot;, &quot;gobbi&quot; , &quot;pmapper&quot; or path</span>
<span class="sd">                to a feature definition or a feature factory object</span>
<span class="sd">            length: Optional desired length. If provided, the fp will be refold or padded to that length.</span>
<span class="sd">                If set to None, fallback to the default for the provided sig factory.</span>
<span class="sd">            minPointCount: Minimum number of points.</span>
<span class="sd">            maxPointCount: Maximum number of points.</span>
<span class="sd">            trianglePruneBins: Whether to prune the triangle inequality.</span>
<span class="sd">            includeBondOrder: Whether to consider bond order.</span>
<span class="sd">            shortestPathsOnly: Whether to only use the shortest path between pharmacophores.</span>
<span class="sd">            useCounts: Whether take into account the count information. This will also impact how the folding works.</span>
<span class="sd">            bins: Bins to use.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span> <span class="o">=</span> <span class="n">factory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">useCounts</span> <span class="o">=</span> <span class="n">useCounts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minPointCount</span> <span class="o">=</span> <span class="n">minPointCount</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxPointCount</span> <span class="o">=</span> <span class="n">maxPointCount</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shortestPathsOnly</span> <span class="o">=</span> <span class="n">shortestPathsOnly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">includeBondOrder</span> <span class="o">=</span> <span class="n">includeBondOrder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skipFeats</span> <span class="o">=</span> <span class="n">skipFeats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trianglePruneBins</span> <span class="o">=</span> <span class="n">trianglePruneBins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_sig_factory</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the Pharmacophore fingeprint for the input molecule.</span>

<span class="sd">        Args:</span>
<span class="sd">            mol: the molecule of interest</span>
<span class="sd">            raw: Whether to return the raw fingerprint or a Numpy array.</span>

<span class="sd">        Returns:</span>
<span class="sd">            fp: the computed fingerprint as a Numpy array or as a raw object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get a molecule</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The input molecule is not valid.&quot;</span><span class="p">)</span>

        <span class="c1"># Get distance matrix</span>
        <span class="n">use_bond_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_factory</span><span class="o">.</span><span class="n">includeBondOrder</span>
        <span class="n">d_mat</span> <span class="o">=</span> <span class="n">rdmolops</span><span class="o">.</span><span class="n">GetDistanceMatrix</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">use_bond_order</span><span class="p">)</span>

        <span class="c1"># Generate the fingerprint</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">Generate</span><span class="o">.</span><span class="n">Gen2DFingerprint</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_factory</span><span class="p">,</span> <span class="n">dMat</span><span class="o">=</span><span class="n">d_mat</span><span class="p">)</span>

        <span class="c1"># Posprocessing</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_fold</span><span class="p">:</span>
            <span class="c1"># refold the fingerprint</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="n">fold_count_fp</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">useCounts</span> <span class="ow">or</span> <span class="kc">False</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="n">to_fp</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">bitvect</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">raw</span><span class="p">:</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="n">to_numpy</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fp</span>

    <span class="k">def</span> <span class="nf">_init_sig_factory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Init the feature factory for this pharmacophore.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sig_factory</span> <span class="o">=</span> <span class="n">get_sig_factory</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="p">,</span>
            <span class="n">useCounts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">useCounts</span><span class="p">,</span>
            <span class="n">minPointCount</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minPointCount</span><span class="p">,</span>
            <span class="n">maxPointCount</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maxPointCount</span><span class="p">,</span>
            <span class="n">shortestPathsOnly</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shortestPathsOnly</span><span class="p">,</span>
            <span class="n">includeBondOrder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">includeBondOrder</span><span class="p">,</span>
            <span class="n">skipFeats</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">skipFeats</span><span class="p">,</span>
            <span class="n">trianglePruneBins</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trianglePruneBins</span><span class="p">,</span>
            <span class="n">bins</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Reinject used params to the class attributes</span>
        <span class="c1"># It might be useful in case the default values are changed</span>
        <span class="c1"># and when serializing the object.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">useCounts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_factory</span><span class="o">.</span><span class="n">useCounts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minPointCount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_factory</span><span class="o">.</span><span class="n">minPointCount</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxPointCount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_factory</span><span class="o">.</span><span class="n">maxPointCount</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shortestPathsOnly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_factory</span><span class="o">.</span><span class="n">shortestPathsOnly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">includeBondOrder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_factory</span><span class="o">.</span><span class="n">includeBondOrder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skipFeats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_factory</span><span class="o">.</span><span class="n">skipFeats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trianglePruneBins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_factory</span><span class="o">.</span><span class="n">trianglePruneBins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_factory</span><span class="o">.</span><span class="n">GetBins</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_should_fold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_factory</span><span class="o">.</span><span class="n">GetSigSize</span><span class="p">()</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">feature_factory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_factory</span><span class="o">.</span><span class="n">featFactory</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the length of the pharmacophore&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_factory</span><span class="o">.</span><span class="n">GetSigSize</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the name of all the descriptors of this calculator.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sig_factory</span><span class="o">.</span><span class="n">GetBitDescription</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Desc:</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Serialize the class for pickling.&quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;factory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;useCounts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">useCounts</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;minPointCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minPointCount</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;maxPointCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxPointCount</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;shortestPathsOnly&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortestPathsOnly</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;includeBondOrder&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">includeBondOrder</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;skipFeats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skipFeats</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;trianglePruneBins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trianglePruneBins</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reload the class from pickling.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_sig_factory</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="molfeat.calc.pharmacophore.Pharmacophore2D.columns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">columns</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#molfeat.calc.pharmacophore.Pharmacophore2D.columns" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the name of all the descriptors of this calculator.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.pharmacophore.Pharmacophore2D.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#molfeat.calc.pharmacophore.Pharmacophore2D.__call__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute the Pharmacophore fingeprint for the input molecule.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mol</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="datamol.Mol">Mol</span>, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the molecule of interest</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raw</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to return the raw fingerprint or a Numpy array.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>fp</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the computed fingerprint as a Numpy array or as a raw object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/pharmacophore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the Pharmacophore fingeprint for the input molecule.</span>

<span class="sd">    Args:</span>
<span class="sd">        mol: the molecule of interest</span>
<span class="sd">        raw: Whether to return the raw fingerprint or a Numpy array.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fp: the computed fingerprint as a Numpy array or as a raw object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get a molecule</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The input molecule is not valid.&quot;</span><span class="p">)</span>

    <span class="c1"># Get distance matrix</span>
    <span class="n">use_bond_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_factory</span><span class="o">.</span><span class="n">includeBondOrder</span>
    <span class="n">d_mat</span> <span class="o">=</span> <span class="n">rdmolops</span><span class="o">.</span><span class="n">GetDistanceMatrix</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">use_bond_order</span><span class="p">)</span>

    <span class="c1"># Generate the fingerprint</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">Generate</span><span class="o">.</span><span class="n">Gen2DFingerprint</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_factory</span><span class="p">,</span> <span class="n">dMat</span><span class="o">=</span><span class="n">d_mat</span><span class="p">)</span>

    <span class="c1"># Posprocessing</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_fold</span><span class="p">:</span>
        <span class="c1"># refold the fingerprint</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">fold_count_fp</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">useCounts</span> <span class="ow">or</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="n">to_fp</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">bitvect</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">raw</span><span class="p">:</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">to_numpy</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fp</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.pharmacophore.Pharmacophore2D.__getstate__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__getstate__</span><span class="p">()</span></code>

<a href="#molfeat.calc.pharmacophore.Pharmacophore2D.__getstate__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Serialize the class for pickling.</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/pharmacophore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Serialize the class for pickling.&quot;&quot;&quot;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;factory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;useCounts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">useCounts</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;minPointCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minPointCount</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;maxPointCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxPointCount</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;shortestPathsOnly&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortestPathsOnly</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;includeBondOrder&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">includeBondOrder</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;skipFeats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skipFeats</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;trianglePruneBins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trianglePruneBins</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.pharmacophore.Pharmacophore2D.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">factory</span><span class="o">=</span><span class="s1">&#39;pmapper&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span> <span class="n">useCounts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minPointCount</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxPointCount</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shortestPathsOnly</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">includeBondOrder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skipFeats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trianglePruneBins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#molfeat.calc.pharmacophore.Pharmacophore2D.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Pharmacophore computation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>factory</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[str, <span title="rdkit.Chem.rdMolChemicalFeatures.MolChemicalFeatureFactory">MolChemicalFeatureFactory</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which features factory to use. One of "default", "cats", "gobbi" , "pmapper" or path
to a feature definition or a feature factory object</p>
              </div>
            </td>
            <td>
                  <code>&#39;pmapper&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>length</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional desired length. If provided, the fp will be refold or padded to that length.
If set to None, fallback to the default for the provided sig factory.</p>
              </div>
            </td>
            <td>
                  <code>2048</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>minPointCount</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum number of points.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>maxPointCount</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of points.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>trianglePruneBins</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to prune the triangle inequality.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>includeBondOrder</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to consider bond order.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shortestPathsOnly</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to only use the shortest path between pharmacophores.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>useCounts</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether take into account the count information. This will also impact how the folding works.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bins</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bins to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/pharmacophore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">factory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MolChemicalFeatureFactory</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;pmapper&quot;</span><span class="p">,</span>
    <span class="n">length</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
    <span class="n">useCounts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">minPointCount</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">maxPointCount</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">shortestPathsOnly</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">includeBondOrder</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">skipFeats</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">trianglePruneBins</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">bins</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pharmacophore computation.</span>

<span class="sd">    Args:</span>
<span class="sd">        factory: Which features factory to use. One of &quot;default&quot;, &quot;cats&quot;, &quot;gobbi&quot; , &quot;pmapper&quot; or path</span>
<span class="sd">            to a feature definition or a feature factory object</span>
<span class="sd">        length: Optional desired length. If provided, the fp will be refold or padded to that length.</span>
<span class="sd">            If set to None, fallback to the default for the provided sig factory.</span>
<span class="sd">        minPointCount: Minimum number of points.</span>
<span class="sd">        maxPointCount: Maximum number of points.</span>
<span class="sd">        trianglePruneBins: Whether to prune the triangle inequality.</span>
<span class="sd">        includeBondOrder: Whether to consider bond order.</span>
<span class="sd">        shortestPathsOnly: Whether to only use the shortest path between pharmacophores.</span>
<span class="sd">        useCounts: Whether take into account the count information. This will also impact how the folding works.</span>
<span class="sd">        bins: Bins to use.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">factory</span> <span class="o">=</span> <span class="n">factory</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">useCounts</span> <span class="o">=</span> <span class="n">useCounts</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">minPointCount</span> <span class="o">=</span> <span class="n">minPointCount</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">maxPointCount</span> <span class="o">=</span> <span class="n">maxPointCount</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">shortestPathsOnly</span> <span class="o">=</span> <span class="n">shortestPathsOnly</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">includeBondOrder</span> <span class="o">=</span> <span class="n">includeBondOrder</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">skipFeats</span> <span class="o">=</span> <span class="n">skipFeats</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trianglePruneBins</span> <span class="o">=</span> <span class="n">trianglePruneBins</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_init_sig_factory</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.pharmacophore.Pharmacophore2D.__len__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__len__</span><span class="p">()</span></code>

<a href="#molfeat.calc.pharmacophore.Pharmacophore2D.__len__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns the length of the pharmacophore</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/pharmacophore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the length of the pharmacophore&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_factory</span><span class="o">.</span><span class="n">GetSigSize</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.pharmacophore.Pharmacophore2D.__setstate__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__setstate__</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></code>

<a href="#molfeat.calc.pharmacophore.Pharmacophore2D.__setstate__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Reload the class from pickling.</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/pharmacophore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reload the class from pickling.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_init_sig_factory</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="molfeat.calc.pharmacophore.Pharmacophore3D" class="doc doc-heading">
            <code>Pharmacophore3D</code>


<a href="#molfeat.calc.pharmacophore.Pharmacophore3D" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="molfeat.calc.base.SerializableCalculator" href="#molfeat.calc.base.SerializableCalculator">SerializableCalculator</a></code></p>


        <p>3D Pharmacophore.</p>
<p>The fingerprint is computed using <a href="https://github.com/DrrDom/pmapper"><code>pmapper</code></a>.</p>
<p>This featurizer supports building a consensus pharmacophore from a set of molecules.</p>






              <details class="quote">
                <summary>Source code in <code>molfeat/calc/pharmacophore.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Pharmacophore3D</span><span class="p">(</span><span class="n">SerializableCalculator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;3D Pharmacophore.</span>

<span class="sd">    The fingerprint is computed using [`pmapper`](https://github.com/DrrDom/pmapper).</span>

<span class="sd">    This featurizer supports building a consensus pharmacophore from a set of molecules.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">factory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MolChemicalFeatureFactory</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;pmapper&quot;</span><span class="p">,</span>
        <span class="n">length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
        <span class="n">bin_step</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">min_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">max_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">use_modulo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pharmacophore computation.</span>

<span class="sd">        Args:</span>
<span class="sd">            factory: Which features factory to use. One of &quot;default&quot;, &quot;cats&quot;, &quot;gobbi&quot; , &quot;pmapper&quot; or path</span>
<span class="sd">                to a feature definition or a feature factory object</span>
<span class="sd">            length: Optional desired length. If provided, the fp will be refold or padded to that length.</span>
<span class="sd">                If set to None, fallback to the default for the provided sig factory.</span>
<span class="sd">            bin_step: Bin step to use.</span>
<span class="sd">            min_features: Minimum number of features to use.</span>
<span class="sd">            max_features: Maximum number of features to use.</span>
<span class="sd">            use_modulo: whether to use modulo to compute the pharmacophore fingerprint</span>
<span class="sd">            tolerance: tolerance value to use when computing the pharmacophore fingerprint</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span> <span class="o">=</span> <span class="n">factory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bin_step</span> <span class="o">=</span> <span class="n">bin_step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_features</span> <span class="o">=</span> <span class="n">min_features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_features</span> <span class="o">=</span> <span class="n">max_features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_modulo</span> <span class="o">=</span> <span class="n">use_modulo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span> <span class="o">=</span> <span class="n">tolerance</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_feature_factory</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">conformer_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the Pharmacophore fingeprint for the input molecule.</span>

<span class="sd">        Args:</span>
<span class="sd">            mol: the molecule of interest</span>
<span class="sd">            conformer_id: the conformer id to use.</span>
<span class="sd">            raw: Whether to return the raw fingerprint or a Numpy array.</span>

<span class="sd">        Returns:</span>
<span class="sd">            fp: the computed fingerprint as a Numpy array.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get a molecule</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The input molecule is not valid.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumConformers</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected a molecule with conformers information.&quot;</span><span class="p">)</span>

        <span class="c1"># Get the features for the mol</span>
        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_features</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">conformer_id</span><span class="o">=</span><span class="n">conformer_id</span><span class="p">)</span>

        <span class="c1"># Convert features dataframe to coordinates</span>
        <span class="k">if</span> <span class="n">features</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">features_coords</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">features_coords</span> <span class="o">=</span> <span class="n">features</span><span class="p">[[</span><span class="s2">&quot;feature_name&quot;</span><span class="p">,</span> <span class="s2">&quot;coords&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1"># Compute the fingerprint</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_fp_from_coords</span><span class="p">(</span><span class="n">features_coords</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="n">raw</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fp</span>

    <span class="k">def</span> <span class="nf">consensus_fp</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">],</span>
        <span class="n">align</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">conformer_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">min_samples_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">cluster_kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute a consensus fingerprint from a list of molecules.</span>

<span class="sd">        Args:</span>
<span class="sd">            mols: a list of molecules.</span>
<span class="sd">            align: Whether to align the conformers of the molecules.</span>
<span class="sd">            conformer_id: Optional conformer id.</span>
<span class="sd">            copy: Whether to copy the molecules before clustering.</span>
<span class="sd">            min_samples_ratio: Percentages of mols that must contain a pharmacophoric point</span>
<span class="sd">                to be considered as a core point.</span>
<span class="sd">            eps: The maximum distance between two samples for one to be considered as</span>
<span class="sd">                in the neighborhood of the other.</span>
<span class="sd">            raw: Whether to return the raw fingerprint or a Numpy array.</span>
<span class="sd">            cluster_kwargs: additional keyword arguments for the clustering algorithm.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get all the features</span>
        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_features_from_many</span><span class="p">(</span>
            <span class="n">mols</span><span class="p">,</span>
            <span class="n">keep_mols</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">align</span><span class="o">=</span><span class="n">align</span><span class="p">,</span>
            <span class="n">conformer_id</span><span class="o">=</span><span class="n">conformer_id</span><span class="p">,</span>
            <span class="n">copy</span><span class="o">=</span><span class="n">copy</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Retrieve the aligned molecules</span>
        <span class="n">mols</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;mol_index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()[</span><span class="s2">&quot;mol&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="c1"># Cluster the features</span>
        <span class="n">clustered_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cluster_features</span><span class="p">(</span>
            <span class="n">features</span><span class="p">,</span> <span class="n">min_samples_ratio</span><span class="o">=</span><span class="n">min_samples_ratio</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="o">**</span><span class="n">cluster_kwargs</span>
        <span class="p">)</span>
        <span class="c1"># Convert features dataframe to coordinates</span>
        <span class="k">if</span> <span class="n">clustered_features</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">features_coords</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">features_coords</span> <span class="o">=</span> <span class="n">clustered_features</span><span class="p">[[</span><span class="s2">&quot;feature_name&quot;</span><span class="p">,</span> <span class="s2">&quot;coords&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="c1"># Compute the fingerprint</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_fp_from_coords</span><span class="p">(</span><span class="n">features_coords</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="n">raw</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fp</span>

    <span class="k">def</span> <span class="nf">_init_feature_factory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Init the feature factory.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_factory</span> <span class="o">=</span> <span class="n">get_feature_factory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="n">conformer_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the features for a given molecule.</span>

<span class="sd">        Args:</span>
<span class="sd">            mol: the molecule of interest</span>

<span class="sd">        Returns:</span>
<span class="sd">            features: the features as a Numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">features_data</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Extract the features for this molecule</span>
        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_factory</span><span class="o">.</span><span class="n">GetFeaturesForMol</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">confId</span><span class="o">=</span><span class="n">conformer_id</span><span class="p">)</span>

        <span class="c1"># Extract all the feature atom indices for this molecule</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
            <span class="n">datum</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">datum</span><span class="p">[</span><span class="s2">&quot;feature_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetId</span><span class="p">()</span>
            <span class="n">datum</span><span class="p">[</span><span class="s2">&quot;feature_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetFamily</span><span class="p">()</span>
            <span class="n">datum</span><span class="p">[</span><span class="s2">&quot;feature_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetType</span><span class="p">()</span>
            <span class="n">datum</span><span class="p">[</span><span class="s2">&quot;atom_indices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetAtomIds</span><span class="p">()</span>
            <span class="n">datum</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">GetPos</span><span class="p">())</span>

            <span class="n">features_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>

        <span class="n">features_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">features_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">features_data</span>

    <span class="k">def</span> <span class="nf">get_features_from_many</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">],</span>
        <span class="n">align</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">conformer_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">keep_mols</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract all the features from a list of molecules after an optional</span>
<span class="sd">        alignement step.</span>

<span class="sd">        Args:</span>
<span class="sd">            mols: List of molecules with conformers.</span>
<span class="sd">            align: Whether to align the conformers of the molecules.</span>
<span class="sd">            conformer_id: Optional conformer id.</span>
<span class="sd">            copy: Whether to copy the molecules before clustering.</span>
<span class="sd">            keep_mols: Whether to keep the molecules in the returned dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">mol</span><span class="o">.</span><span class="n">GetNumConformers</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">mols</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;One or more input molecules is missing a conformer.&quot;</span><span class="p">)</span>

        <span class="c1"># Make a copy of the molecules since they are going to be modified</span>
        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
            <span class="n">mols</span> <span class="o">=</span> <span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">copy_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span> <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">mols</span><span class="p">]</span>

        <span class="c1"># Align the conformers</span>
        <span class="k">if</span> <span class="n">align</span><span class="p">:</span>
            <span class="n">mols</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">commons</span><span class="o">.</span><span class="n">align_conformers</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">conformer_id</span><span class="o">=</span><span class="n">conformer_id</span><span class="p">)</span>

        <span class="n">all_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mols</span><span class="p">):</span>
            <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_features</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;mol_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

            <span class="k">if</span> <span class="n">keep_mols</span><span class="p">:</span>
                <span class="n">features</span><span class="p">[</span><span class="s2">&quot;mol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mol</span>

            <span class="n">all_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">all_features</span><span class="p">,</span> <span class="n">features</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">all_features</span>

    <span class="k">def</span> <span class="nf">compute_fp_from_coords</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">features_coords</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]]],</span>
        <span class="n">raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute a fingerprint from a list of features.</span>

<span class="sd">        Args:</span>
<span class="sd">            features_coords: Features coords: `[(&#39;A&#39;, (1.23, 2.34, 3.45)), (&#39;A&#39;, (4.56, 5.67, 6.78)), ...]`.</span>
<span class="sd">            raw: Whether to return the raw fingerprint or a Numpy array.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Init the pmapper engine</span>
        <span class="n">ph_engine</span> <span class="o">=</span> <span class="n">Pharm</span><span class="p">(</span><span class="n">bin_step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bin_step</span><span class="p">)</span>
        <span class="c1"># Convert coords to list in case those are arrays</span>
        <span class="n">features_coords</span> <span class="o">=</span> <span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">coords</span><span class="p">))</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">coords</span> <span class="ow">in</span> <span class="n">features_coords</span><span class="p">]</span>
        <span class="c1"># Load pharmacophore points</span>
        <span class="n">ph_engine</span><span class="o">.</span><span class="n">load_from_feature_coords</span><span class="p">(</span><span class="n">features_coords</span><span class="p">)</span>
        <span class="c1"># Init the iterator over the pharmacophore points</span>
        <span class="n">points_iterator</span> <span class="o">=</span> <span class="n">ph_engine</span><span class="o">.</span><span class="n">iterate_pharm</span><span class="p">(</span>
            <span class="n">min_features</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_features</span><span class="p">,</span>
            <span class="n">max_features</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_features</span><span class="p">,</span>
            <span class="n">tol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span><span class="p">,</span>
            <span class="n">return_feature_ids</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Compute the fingerprint</span>
        <span class="n">on_bits</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">points_iterator</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_modulo</span><span class="p">:</span>
                <span class="n">on_bits</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
                <span class="n">on_bits</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">on_bits</span><span class="p">)</span>

        <span class="n">fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">fp</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">on_bits</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">fp</span>

    <span class="k">def</span> <span class="nf">cluster_features</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">min_samples_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">n_mols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cluster a set of pharmacophoric features using OPTICS.</span>
<span class="sd">        The only reason why we are not using SpectralClustering is because of the need to provide</span>
<span class="sd">        the number of clusters.</span>

<span class="sd">        Args:</span>
<span class="sd">            features: A dataframe of features.</span>
<span class="sd">            min_samples_ratio: Percentages of mols that must contain a pharmacophoric point</span>
<span class="sd">                to be considered as a core point.</span>
<span class="sd">            n_mols: Optional number of compounds to compute `min_samples` from the</span>
<span class="sd">                `min_samples_ratio` value. If not set it will use `mol_index` from</span>
<span class="sd">                the `features` dataframe.</span>
<span class="sd">            eps: The maximum distance between two samples for one to be considered as</span>
<span class="sd">                in the neighborhood of the other. This is max_eps in OPTICS</span>
<span class="sd">            kwargs: Any additional parameters to pass to `sklearn.cluster.OPTICS`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">n_mols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_mols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;mol_index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

        <span class="c1"># Compute min_samples</span>
        <span class="n">min_samples</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">min_samples_ratio</span> <span class="o">*</span> <span class="n">n_mols</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">clusters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">feature_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">rows</span> <span class="ow">in</span> <span class="n">features</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;feature_name&quot;</span><span class="p">):</span>
            <span class="n">feature_name</span> <span class="o">=</span> <span class="n">rows</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;feature_name&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">min_samples</span> <span class="o">&gt;</span> <span class="n">rows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Feature </span><span class="si">{</span><span class="n">feature_name</span><span class="si">}</span><span class="s2"> does not have enough molecule (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span><span class="si">}</span><span class="s2">), skipping&quot;</span>
                <span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

            <span class="c1"># Init clustering</span>
            <span class="n">optics</span> <span class="o">=</span> <span class="n">OPTICS</span><span class="p">(</span><span class="n">min_samples</span><span class="o">=</span><span class="n">min_samples</span><span class="p">,</span> <span class="n">max_eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">optics</span> <span class="o">=</span> <span class="n">optics</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">optics</span><span class="o">.</span><span class="n">labels_</span>
            <span class="c1"># a node that is not a core would basically be a node that cannot be labeled</span>
            <span class="c1"># thus border nodes are considered core</span>
            <span class="n">core_samples_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
            <span class="n">core_samples_mask</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Find the centroids (consensus points)</span>
            <span class="n">unique_labels</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">unique_labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">class_member_mask</span> <span class="o">=</span> <span class="n">labels</span> <span class="o">==</span> <span class="n">k</span>
                <span class="n">cluster_coords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">class_member_mask</span> <span class="o">&amp;</span> <span class="n">core_samples_mask</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster_coords</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">cluster_centroid</span> <span class="o">=</span> <span class="n">cluster_coords</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                <span class="n">cluster</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">cluster</span><span class="p">[</span><span class="s2">&quot;feature_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature_id</span>
                <span class="n">cluster</span><span class="p">[</span><span class="s2">&quot;feature_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature_name</span>
                <span class="n">cluster</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cluster_centroid</span>
                <span class="n">cluster</span><span class="p">[</span><span class="s2">&quot;cluster_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster_coords</span><span class="p">)</span>

                <span class="n">clusters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
                <span class="n">feature_id</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">clusters</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">clusters</span>

    <span class="c1">## Viz methods</span>

    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">sphere_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>
        <span class="n">show_legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Show a 3D view of a given molecule with the pharmacophoric features.</span>

<span class="sd">        Args:</span>
<span class="sd">            mol: the molecule of interest</span>
<span class="sd">            alpha: Alpha value for the colors (currently not working).</span>
<span class="sd">            sphere_radius: Radius of the spheres for the features.</span>
<span class="sd">            show_legend: Display the legend (the layout is bad but at least it</span>
<span class="sd">                shows the legend).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_features</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">viz</span><span class="o">.</span><span class="n">show_pharm_features</span><span class="p">(</span>
            <span class="n">mol</span><span class="p">,</span>
            <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span>
            <span class="n">feature_factory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_factory</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">sphere_radius</span><span class="o">=</span><span class="n">sphere_radius</span><span class="p">,</span>
            <span class="n">show_legend</span><span class="o">=</span><span class="n">show_legend</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">show_many</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">],</span>
        <span class="n">align</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">conformer_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">min_samples_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">sphere_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>
        <span class="n">show_legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Show a 3D view of a given molecule with the pharmacophoric features.</span>

<span class="sd">        Args:</span>
<span class="sd">            mols: a list of molecules.</span>
<span class="sd">            align: Whether to align the conformers of the molecules.</span>
<span class="sd">            conformer_id: Optional conformer id.</span>
<span class="sd">            copy: Whether to copy the molecules before clustering.</span>
<span class="sd">            min_samples_ratio: Percentages of mols that must contain a pharmacophoric point</span>
<span class="sd">                to be considered as a core point.</span>
<span class="sd">            eps: The maximum distance between two samples for one to be considered as</span>
<span class="sd">                in the neighborhood of the other.</span>
<span class="sd">            alpha: Alpha value for the colors (currently not working).</span>
<span class="sd">            sphere_radius: Radius of the spheres for the features.</span>
<span class="sd">            show_legend: Display the legend (the layout is bad but at least it</span>
<span class="sd">                shows the legend).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get all the features</span>
        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_features_from_many</span><span class="p">(</span>
            <span class="n">mols</span><span class="p">,</span>
            <span class="n">keep_mols</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">align</span><span class="o">=</span><span class="n">align</span><span class="p">,</span>
            <span class="n">conformer_id</span><span class="o">=</span><span class="n">conformer_id</span><span class="p">,</span>
            <span class="n">copy</span><span class="o">=</span><span class="n">copy</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Retrieve the aligned molecules</span>
        <span class="n">mols</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;mol_index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()[</span><span class="s2">&quot;mol&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1"># Cluster the features</span>
        <span class="n">clustered_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cluster_features</span><span class="p">(</span>
            <span class="n">features</span><span class="p">,</span>
            <span class="n">min_samples_ratio</span><span class="o">=</span><span class="n">min_samples_ratio</span><span class="p">,</span>
            <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">viz</span><span class="o">.</span><span class="n">show_pharm_features</span><span class="p">(</span>
            <span class="n">mols</span><span class="p">,</span>
            <span class="n">features</span><span class="o">=</span><span class="n">clustered_features</span><span class="p">,</span>
            <span class="n">feature_factory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_factory</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">sphere_radius</span><span class="o">=</span><span class="n">sphere_radius</span><span class="p">,</span>
            <span class="n">show_legend</span><span class="o">=</span><span class="n">show_legend</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Serialize the class for pickling.&quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;factory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;bin_step&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_step</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;min_features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_features</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;max_features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_features</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;use_modulo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_modulo</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;tolerance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reload the class from pickling.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_feature_factory</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.pharmacophore.Pharmacophore3D.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">conformer_id</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#molfeat.calc.pharmacophore.Pharmacophore3D.__call__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute the Pharmacophore fingeprint for the input molecule.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mol</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="datamol.Mol">Mol</span>, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the molecule of interest</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conformer_id</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the conformer id to use.</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raw</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to return the raw fingerprint or a Numpy array.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>fp</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the computed fingerprint as a Numpy array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/pharmacophore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">conformer_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the Pharmacophore fingeprint for the input molecule.</span>

<span class="sd">    Args:</span>
<span class="sd">        mol: the molecule of interest</span>
<span class="sd">        conformer_id: the conformer id to use.</span>
<span class="sd">        raw: Whether to return the raw fingerprint or a Numpy array.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fp: the computed fingerprint as a Numpy array.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get a molecule</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The input molecule is not valid.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumConformers</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected a molecule with conformers information.&quot;</span><span class="p">)</span>

    <span class="c1"># Get the features for the mol</span>
    <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_features</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">conformer_id</span><span class="o">=</span><span class="n">conformer_id</span><span class="p">)</span>

    <span class="c1"># Convert features dataframe to coordinates</span>
    <span class="k">if</span> <span class="n">features</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">features_coords</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">features_coords</span> <span class="o">=</span> <span class="n">features</span><span class="p">[[</span><span class="s2">&quot;feature_name&quot;</span><span class="p">,</span> <span class="s2">&quot;coords&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="c1"># Compute the fingerprint</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_fp_from_coords</span><span class="p">(</span><span class="n">features_coords</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="n">raw</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fp</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.pharmacophore.Pharmacophore3D.__getstate__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__getstate__</span><span class="p">()</span></code>

<a href="#molfeat.calc.pharmacophore.Pharmacophore3D.__getstate__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Serialize the class for pickling.</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/pharmacophore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Serialize the class for pickling.&quot;&quot;&quot;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;factory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;bin_step&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_step</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;min_features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_features</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;max_features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_features</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;use_modulo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_modulo</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;tolerance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.pharmacophore.Pharmacophore3D.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">factory</span><span class="o">=</span><span class="s1">&#39;pmapper&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span> <span class="n">bin_step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_features</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">use_modulo</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

<a href="#molfeat.calc.pharmacophore.Pharmacophore3D.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Pharmacophore computation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>factory</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[str, <span title="rdkit.Chem.rdMolChemicalFeatures.MolChemicalFeatureFactory">MolChemicalFeatureFactory</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which features factory to use. One of "default", "cats", "gobbi" , "pmapper" or path
to a feature definition or a feature factory object</p>
              </div>
            </td>
            <td>
                  <code>&#39;pmapper&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>length</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional desired length. If provided, the fp will be refold or padded to that length.
If set to None, fallback to the default for the provided sig factory.</p>
              </div>
            </td>
            <td>
                  <code>2048</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bin_step</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bin step to use.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_features</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum number of features to use.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_features</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of features to use.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_modulo</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to use modulo to compute the pharmacophore fingerprint</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tolerance</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tolerance value to use when computing the pharmacophore fingerprint</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/pharmacophore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">factory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MolChemicalFeatureFactory</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;pmapper&quot;</span><span class="p">,</span>
    <span class="n">length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
    <span class="n">bin_step</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">min_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">max_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">use_modulo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pharmacophore computation.</span>

<span class="sd">    Args:</span>
<span class="sd">        factory: Which features factory to use. One of &quot;default&quot;, &quot;cats&quot;, &quot;gobbi&quot; , &quot;pmapper&quot; or path</span>
<span class="sd">            to a feature definition or a feature factory object</span>
<span class="sd">        length: Optional desired length. If provided, the fp will be refold or padded to that length.</span>
<span class="sd">            If set to None, fallback to the default for the provided sig factory.</span>
<span class="sd">        bin_step: Bin step to use.</span>
<span class="sd">        min_features: Minimum number of features to use.</span>
<span class="sd">        max_features: Maximum number of features to use.</span>
<span class="sd">        use_modulo: whether to use modulo to compute the pharmacophore fingerprint</span>
<span class="sd">        tolerance: tolerance value to use when computing the pharmacophore fingerprint</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">factory</span> <span class="o">=</span> <span class="n">factory</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bin_step</span> <span class="o">=</span> <span class="n">bin_step</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">min_features</span> <span class="o">=</span> <span class="n">min_features</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_features</span> <span class="o">=</span> <span class="n">max_features</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">use_modulo</span> <span class="o">=</span> <span class="n">use_modulo</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span> <span class="o">=</span> <span class="n">tolerance</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_init_feature_factory</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.pharmacophore.Pharmacophore3D.__setstate__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__setstate__</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></code>

<a href="#molfeat.calc.pharmacophore.Pharmacophore3D.__setstate__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Reload the class from pickling.</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/pharmacophore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reload the class from pickling.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_init_feature_factory</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.pharmacophore.Pharmacophore3D.cluster_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cluster_features</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">min_samples_ratio</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">n_mols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#molfeat.calc.pharmacophore.Pharmacophore3D.cluster_features" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Cluster a set of pharmacophoric features using OPTICS.
The only reason why we are not using SpectralClustering is because of the need to provide
the number of clusters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>features</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dataframe of features.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_samples_ratio</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Percentages of mols that must contain a pharmacophoric point
to be considered as a core point.</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_mols</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional number of compounds to compute <code>min_samples</code> from the
<code>min_samples_ratio</code> value. If not set it will use <code>mol_index</code> from
the <code>features</code> dataframe.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum distance between two samples for one to be considered as
in the neighborhood of the other. This is max_eps in OPTICS</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.inf">inf</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Any additional parameters to pass to <code>sklearn.cluster.OPTICS</code>.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/pharmacophore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cluster_features</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">min_samples_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">n_mols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cluster a set of pharmacophoric features using OPTICS.</span>
<span class="sd">    The only reason why we are not using SpectralClustering is because of the need to provide</span>
<span class="sd">    the number of clusters.</span>

<span class="sd">    Args:</span>
<span class="sd">        features: A dataframe of features.</span>
<span class="sd">        min_samples_ratio: Percentages of mols that must contain a pharmacophoric point</span>
<span class="sd">            to be considered as a core point.</span>
<span class="sd">        n_mols: Optional number of compounds to compute `min_samples` from the</span>
<span class="sd">            `min_samples_ratio` value. If not set it will use `mol_index` from</span>
<span class="sd">            the `features` dataframe.</span>
<span class="sd">        eps: The maximum distance between two samples for one to be considered as</span>
<span class="sd">            in the neighborhood of the other. This is max_eps in OPTICS</span>
<span class="sd">        kwargs: Any additional parameters to pass to `sklearn.cluster.OPTICS`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">n_mols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_mols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;mol_index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

    <span class="c1"># Compute min_samples</span>
    <span class="n">min_samples</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">min_samples_ratio</span> <span class="o">*</span> <span class="n">n_mols</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">clusters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">feature_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">rows</span> <span class="ow">in</span> <span class="n">features</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;feature_name&quot;</span><span class="p">):</span>
        <span class="n">feature_name</span> <span class="o">=</span> <span class="n">rows</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;feature_name&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">min_samples</span> <span class="o">&gt;</span> <span class="n">rows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Feature </span><span class="si">{</span><span class="n">feature_name</span><span class="si">}</span><span class="s2"> does not have enough molecule (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span><span class="si">}</span><span class="s2">), skipping&quot;</span>
            <span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="c1"># Init clustering</span>
        <span class="n">optics</span> <span class="o">=</span> <span class="n">OPTICS</span><span class="p">(</span><span class="n">min_samples</span><span class="o">=</span><span class="n">min_samples</span><span class="p">,</span> <span class="n">max_eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">optics</span> <span class="o">=</span> <span class="n">optics</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">optics</span><span class="o">.</span><span class="n">labels_</span>
        <span class="c1"># a node that is not a core would basically be a node that cannot be labeled</span>
        <span class="c1"># thus border nodes are considered core</span>
        <span class="n">core_samples_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">core_samples_mask</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Find the centroids (consensus points)</span>
        <span class="n">unique_labels</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">unique_labels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">class_member_mask</span> <span class="o">=</span> <span class="n">labels</span> <span class="o">==</span> <span class="n">k</span>
            <span class="n">cluster_coords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">class_member_mask</span> <span class="o">&amp;</span> <span class="n">core_samples_mask</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster_coords</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">cluster_centroid</span> <span class="o">=</span> <span class="n">cluster_coords</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">cluster</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">cluster</span><span class="p">[</span><span class="s2">&quot;feature_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature_id</span>
            <span class="n">cluster</span><span class="p">[</span><span class="s2">&quot;feature_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature_name</span>
            <span class="n">cluster</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cluster_centroid</span>
            <span class="n">cluster</span><span class="p">[</span><span class="s2">&quot;cluster_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster_coords</span><span class="p">)</span>

            <span class="n">clusters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
            <span class="n">feature_id</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">clusters</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">clusters</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.pharmacophore.Pharmacophore3D.compute_fp_from_coords" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_fp_from_coords</span><span class="p">(</span><span class="n">features_coords</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#molfeat.calc.pharmacophore.Pharmacophore3D.compute_fp_from_coords" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute a fingerprint from a list of features.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>features_coords</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[str, <span title="typing.Tuple">Tuple</span>[float]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Features coords: <code>[('A', (1.23, 2.34, 3.45)), ('A', (4.56, 5.67, 6.78)), ...]</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raw</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to return the raw fingerprint or a Numpy array.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/pharmacophore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_fp_from_coords</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">features_coords</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]]],</span>
    <span class="n">raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute a fingerprint from a list of features.</span>

<span class="sd">    Args:</span>
<span class="sd">        features_coords: Features coords: `[(&#39;A&#39;, (1.23, 2.34, 3.45)), (&#39;A&#39;, (4.56, 5.67, 6.78)), ...]`.</span>
<span class="sd">        raw: Whether to return the raw fingerprint or a Numpy array.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Init the pmapper engine</span>
    <span class="n">ph_engine</span> <span class="o">=</span> <span class="n">Pharm</span><span class="p">(</span><span class="n">bin_step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bin_step</span><span class="p">)</span>
    <span class="c1"># Convert coords to list in case those are arrays</span>
    <span class="n">features_coords</span> <span class="o">=</span> <span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">coords</span><span class="p">))</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">coords</span> <span class="ow">in</span> <span class="n">features_coords</span><span class="p">]</span>
    <span class="c1"># Load pharmacophore points</span>
    <span class="n">ph_engine</span><span class="o">.</span><span class="n">load_from_feature_coords</span><span class="p">(</span><span class="n">features_coords</span><span class="p">)</span>
    <span class="c1"># Init the iterator over the pharmacophore points</span>
    <span class="n">points_iterator</span> <span class="o">=</span> <span class="n">ph_engine</span><span class="o">.</span><span class="n">iterate_pharm</span><span class="p">(</span>
        <span class="n">min_features</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_features</span><span class="p">,</span>
        <span class="n">max_features</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_features</span><span class="p">,</span>
        <span class="n">tol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span><span class="p">,</span>
        <span class="n">return_feature_ids</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Compute the fingerprint</span>
    <span class="n">on_bits</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">points_iterator</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_modulo</span><span class="p">:</span>
            <span class="n">on_bits</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
            <span class="n">on_bits</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">on_bits</span><span class="p">)</span>

    <span class="n">fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">fp</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">on_bits</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">fp</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.pharmacophore.Pharmacophore3D.consensus_fp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">consensus_fp</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">conformer_id</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_samples_ratio</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">cluster_kwargs</span><span class="p">)</span></code>

<a href="#molfeat.calc.pharmacophore.Pharmacophore3D.consensus_fp" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute a consensus fingerprint from a list of molecules.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mols</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="datamol.Mol">Mol</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of molecules.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>align</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to align the conformers of the molecules.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conformer_id</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional conformer id.</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>copy</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to copy the molecules before clustering.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_samples_ratio</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Percentages of mols that must contain a pharmacophoric point
to be considered as a core point.</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum distance between two samples for one to be considered as
in the neighborhood of the other.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raw</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to return the raw fingerprint or a Numpy array.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cluster_kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>additional keyword arguments for the clustering algorithm.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/pharmacophore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">consensus_fp</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">mols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">],</span>
    <span class="n">align</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">conformer_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">min_samples_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">cluster_kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute a consensus fingerprint from a list of molecules.</span>

<span class="sd">    Args:</span>
<span class="sd">        mols: a list of molecules.</span>
<span class="sd">        align: Whether to align the conformers of the molecules.</span>
<span class="sd">        conformer_id: Optional conformer id.</span>
<span class="sd">        copy: Whether to copy the molecules before clustering.</span>
<span class="sd">        min_samples_ratio: Percentages of mols that must contain a pharmacophoric point</span>
<span class="sd">            to be considered as a core point.</span>
<span class="sd">        eps: The maximum distance between two samples for one to be considered as</span>
<span class="sd">            in the neighborhood of the other.</span>
<span class="sd">        raw: Whether to return the raw fingerprint or a Numpy array.</span>
<span class="sd">        cluster_kwargs: additional keyword arguments for the clustering algorithm.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get all the features</span>
    <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_features_from_many</span><span class="p">(</span>
        <span class="n">mols</span><span class="p">,</span>
        <span class="n">keep_mols</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">align</span><span class="o">=</span><span class="n">align</span><span class="p">,</span>
        <span class="n">conformer_id</span><span class="o">=</span><span class="n">conformer_id</span><span class="p">,</span>
        <span class="n">copy</span><span class="o">=</span><span class="n">copy</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Retrieve the aligned molecules</span>
    <span class="n">mols</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;mol_index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()[</span><span class="s2">&quot;mol&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="c1"># Cluster the features</span>
    <span class="n">clustered_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cluster_features</span><span class="p">(</span>
        <span class="n">features</span><span class="p">,</span> <span class="n">min_samples_ratio</span><span class="o">=</span><span class="n">min_samples_ratio</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="o">**</span><span class="n">cluster_kwargs</span>
    <span class="p">)</span>
    <span class="c1"># Convert features dataframe to coordinates</span>
    <span class="k">if</span> <span class="n">clustered_features</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">features_coords</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">features_coords</span> <span class="o">=</span> <span class="n">clustered_features</span><span class="p">[[</span><span class="s2">&quot;feature_name&quot;</span><span class="p">,</span> <span class="s2">&quot;coords&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="c1"># Compute the fingerprint</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_fp_from_coords</span><span class="p">(</span><span class="n">features_coords</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="n">raw</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fp</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.pharmacophore.Pharmacophore3D.get_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_features</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">conformer_id</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#molfeat.calc.pharmacophore.Pharmacophore3D.get_features" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Retrieve the features for a given molecule.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mol</code>
            </td>
            <td>
                  <code><span title="datamol.Mol">Mol</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the molecule of interest</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>features</code></td>            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the features as a Numpy array</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/pharmacophore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="n">conformer_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve the features for a given molecule.</span>

<span class="sd">    Args:</span>
<span class="sd">        mol: the molecule of interest</span>

<span class="sd">    Returns:</span>
<span class="sd">        features: the features as a Numpy array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">features_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Extract the features for this molecule</span>
    <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_factory</span><span class="o">.</span><span class="n">GetFeaturesForMol</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">confId</span><span class="o">=</span><span class="n">conformer_id</span><span class="p">)</span>

    <span class="c1"># Extract all the feature atom indices for this molecule</span>
    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
        <span class="n">datum</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">datum</span><span class="p">[</span><span class="s2">&quot;feature_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetId</span><span class="p">()</span>
        <span class="n">datum</span><span class="p">[</span><span class="s2">&quot;feature_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetFamily</span><span class="p">()</span>
        <span class="n">datum</span><span class="p">[</span><span class="s2">&quot;feature_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetType</span><span class="p">()</span>
        <span class="n">datum</span><span class="p">[</span><span class="s2">&quot;atom_indices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetAtomIds</span><span class="p">()</span>
        <span class="n">datum</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">GetPos</span><span class="p">())</span>

        <span class="n">features_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>

    <span class="n">features_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">features_data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">features_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.pharmacophore.Pharmacophore3D.get_features_from_many" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_features_from_many</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">conformer_id</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_mols</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#molfeat.calc.pharmacophore.Pharmacophore3D.get_features_from_many" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Extract all the features from a list of molecules after an optional
alignement step.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mols</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="datamol.Mol">Mol</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of molecules with conformers.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>align</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to align the conformers of the molecules.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conformer_id</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional conformer id.</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>copy</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to copy the molecules before clustering.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>keep_mols</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to keep the molecules in the returned dataframe.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/pharmacophore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_features_from_many</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">mols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">],</span>
    <span class="n">align</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">conformer_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">keep_mols</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract all the features from a list of molecules after an optional</span>
<span class="sd">    alignement step.</span>

<span class="sd">    Args:</span>
<span class="sd">        mols: List of molecules with conformers.</span>
<span class="sd">        align: Whether to align the conformers of the molecules.</span>
<span class="sd">        conformer_id: Optional conformer id.</span>
<span class="sd">        copy: Whether to copy the molecules before clustering.</span>
<span class="sd">        keep_mols: Whether to keep the molecules in the returned dataframe.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">mol</span><span class="o">.</span><span class="n">GetNumConformers</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">mols</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;One or more input molecules is missing a conformer.&quot;</span><span class="p">)</span>

    <span class="c1"># Make a copy of the molecules since they are going to be modified</span>
    <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
        <span class="n">mols</span> <span class="o">=</span> <span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">copy_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span> <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">mols</span><span class="p">]</span>

    <span class="c1"># Align the conformers</span>
    <span class="k">if</span> <span class="n">align</span><span class="p">:</span>
        <span class="n">mols</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">commons</span><span class="o">.</span><span class="n">align_conformers</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">conformer_id</span><span class="o">=</span><span class="n">conformer_id</span><span class="p">)</span>

    <span class="n">all_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mols</span><span class="p">):</span>
        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_features</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="n">features</span><span class="p">[</span><span class="s2">&quot;mol_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

        <span class="k">if</span> <span class="n">keep_mols</span><span class="p">:</span>
            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;mol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mol</span>

        <span class="n">all_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">all_features</span><span class="p">,</span> <span class="n">features</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">all_features</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.pharmacophore.Pharmacophore3D.show" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">show</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">sphere_radius</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">show_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#molfeat.calc.pharmacophore.Pharmacophore3D.show" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Show a 3D view of a given molecule with the pharmacophoric features.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mol</code>
            </td>
            <td>
                  <code><span title="datamol.Mol">Mol</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the molecule of interest</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>alpha</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alpha value for the colors (currently not working).</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sphere_radius</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Radius of the spheres for the features.</p>
              </div>
            </td>
            <td>
                  <code>0.4</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_legend</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Display the legend (the layout is bad but at least it
shows the legend).</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/pharmacophore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">show</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span>
    <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">sphere_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>
    <span class="n">show_legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show a 3D view of a given molecule with the pharmacophoric features.</span>

<span class="sd">    Args:</span>
<span class="sd">        mol: the molecule of interest</span>
<span class="sd">        alpha: Alpha value for the colors (currently not working).</span>
<span class="sd">        sphere_radius: Radius of the spheres for the features.</span>
<span class="sd">        show_legend: Display the legend (the layout is bad but at least it</span>
<span class="sd">            shows the legend).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_features</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">viz</span><span class="o">.</span><span class="n">show_pharm_features</span><span class="p">(</span>
        <span class="n">mol</span><span class="p">,</span>
        <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span>
        <span class="n">feature_factory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_factory</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
        <span class="n">sphere_radius</span><span class="o">=</span><span class="n">sphere_radius</span><span class="p">,</span>
        <span class="n">show_legend</span><span class="o">=</span><span class="n">show_legend</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.pharmacophore.Pharmacophore3D.show_many" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">show_many</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">conformer_id</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_samples_ratio</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">sphere_radius</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">show_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#molfeat.calc.pharmacophore.Pharmacophore3D.show_many" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Show a 3D view of a given molecule with the pharmacophoric features.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mols</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="datamol.Mol">Mol</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of molecules.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>align</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to align the conformers of the molecules.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conformer_id</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional conformer id.</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>copy</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to copy the molecules before clustering.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_samples_ratio</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Percentages of mols that must contain a pharmacophoric point
to be considered as a core point.</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum distance between two samples for one to be considered as
in the neighborhood of the other.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>alpha</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alpha value for the colors (currently not working).</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sphere_radius</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Radius of the spheres for the features.</p>
              </div>
            </td>
            <td>
                  <code>0.4</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_legend</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Display the legend (the layout is bad but at least it
shows the legend).</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/pharmacophore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">show_many</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">mols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">],</span>
    <span class="n">align</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">conformer_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">min_samples_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">sphere_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>
    <span class="n">show_legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show a 3D view of a given molecule with the pharmacophoric features.</span>

<span class="sd">    Args:</span>
<span class="sd">        mols: a list of molecules.</span>
<span class="sd">        align: Whether to align the conformers of the molecules.</span>
<span class="sd">        conformer_id: Optional conformer id.</span>
<span class="sd">        copy: Whether to copy the molecules before clustering.</span>
<span class="sd">        min_samples_ratio: Percentages of mols that must contain a pharmacophoric point</span>
<span class="sd">            to be considered as a core point.</span>
<span class="sd">        eps: The maximum distance between two samples for one to be considered as</span>
<span class="sd">            in the neighborhood of the other.</span>
<span class="sd">        alpha: Alpha value for the colors (currently not working).</span>
<span class="sd">        sphere_radius: Radius of the spheres for the features.</span>
<span class="sd">        show_legend: Display the legend (the layout is bad but at least it</span>
<span class="sd">            shows the legend).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get all the features</span>
    <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_features_from_many</span><span class="p">(</span>
        <span class="n">mols</span><span class="p">,</span>
        <span class="n">keep_mols</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">align</span><span class="o">=</span><span class="n">align</span><span class="p">,</span>
        <span class="n">conformer_id</span><span class="o">=</span><span class="n">conformer_id</span><span class="p">,</span>
        <span class="n">copy</span><span class="o">=</span><span class="n">copy</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Retrieve the aligned molecules</span>
    <span class="n">mols</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;mol_index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()[</span><span class="s2">&quot;mol&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="c1"># Cluster the features</span>
    <span class="n">clustered_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cluster_features</span><span class="p">(</span>
        <span class="n">features</span><span class="p">,</span>
        <span class="n">min_samples_ratio</span><span class="o">=</span><span class="n">min_samples_ratio</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">viz</span><span class="o">.</span><span class="n">show_pharm_features</span><span class="p">(</span>
        <span class="n">mols</span><span class="p">,</span>
        <span class="n">features</span><span class="o">=</span><span class="n">clustered_features</span><span class="p">,</span>
        <span class="n">feature_factory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_factory</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
        <span class="n">sphere_radius</span><span class="o">=</span><span class="n">sphere_radius</span><span class="p">,</span>
        <span class="n">show_legend</span><span class="o">=</span><span class="n">show_legend</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="molfeat.calc.pharmacophore.get_feature_factory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_feature_factory</span><span class="p">(</span><span class="n">factory</span><span class="p">)</span></code>

<a href="#molfeat.calc.pharmacophore.get_feature_factory" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Build a feature factory.</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/pharmacophore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_factory</span><span class="p">(</span>
    <span class="n">factory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MolChemicalFeatureFactory</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MolChemicalFeatureFactory</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build a feature factory.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">factory</span><span class="p">,</span> <span class="n">MolChemicalFeatureFactory</span><span class="p">):</span>
        <span class="n">feature_factory</span> <span class="o">=</span> <span class="n">factory</span>

    <span class="k">elif</span> <span class="n">factory</span> <span class="o">==</span> <span class="s2">&quot;pmapper&quot;</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s2">&quot;pmapper&quot;</span><span class="p">,</span> <span class="s2">&quot;smarts_features.fdef&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fdef_name</span><span class="p">:</span>
            <span class="n">feature_factory</span> <span class="o">=</span> <span class="n">ChemicalFeatures</span><span class="o">.</span><span class="n">BuildFeatureFactory</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fdef_name</span><span class="p">))</span>  <span class="c1"># type: ignore</span>

    <span class="k">elif</span> <span class="n">factory</span> <span class="o">==</span> <span class="s2">&quot;gobbi&quot;</span><span class="p">:</span>
        <span class="n">feature_factory</span> <span class="o">=</span> <span class="n">Gobbi_Pharm2D</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">featFactory</span>

    <span class="k">elif</span> <span class="n">factory</span> <span class="o">==</span> <span class="s2">&quot;cats&quot;</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">open_text</span><span class="p">(</span><span class="s2">&quot;molfeat.data&quot;</span><span class="p">,</span> <span class="s2">&quot;cats_features.fdef&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">instream</span><span class="p">:</span>
            <span class="n">feature_factory</span> <span class="o">=</span> <span class="n">ChemicalFeatures</span><span class="o">.</span><span class="n">BuildFeatureFactoryFromString</span><span class="p">(</span><span class="n">instream</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>  <span class="c1"># type: ignore</span>

    <span class="k">elif</span> <span class="n">factory</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="c1"># Load default feature definition file</span>
        <span class="n">fdefFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">RDConfig</span><span class="o">.</span><span class="n">RDDataDir</span><span class="p">,</span> <span class="s2">&quot;BaseFeatures.fdef&quot;</span><span class="p">)</span>
        <span class="n">feature_factory</span> <span class="o">=</span> <span class="n">ChemicalFeatures</span><span class="o">.</span><span class="n">BuildFeatureFactory</span><span class="p">(</span><span class="n">fdefFile</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">elif</span> <span class="n">dm</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">factory</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">factory</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">instream</span><span class="p">:</span>
            <span class="n">fdef</span> <span class="o">=</span> <span class="n">instream</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">feature_factory</span> <span class="o">=</span> <span class="n">ChemicalFeatures</span><span class="o">.</span><span class="n">BuildFeatureFactoryFromString</span><span class="p">(</span><span class="n">fdef</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The factory &#39;</span><span class="si">{</span><span class="n">factory</span><span class="si">}</span><span class="s2">&#39; is not supported.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">feature_factory</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="molfeat.calc.pharmacophore.get_sig_factory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_sig_factory</span><span class="p">(</span><span class="n">factory</span><span class="p">,</span> <span class="n">useCounts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minPointCount</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxPointCount</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shortestPathsOnly</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">includeBondOrder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skipFeats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trianglePruneBins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">init_factory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#molfeat.calc.pharmacophore.get_sig_factory" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Build a signature factory.</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/pharmacophore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_sig_factory</span><span class="p">(</span>
    <span class="n">factory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MolChemicalFeatureFactory</span><span class="p">],</span>
    <span class="n">useCounts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">minPointCount</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">maxPointCount</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">shortestPathsOnly</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">includeBondOrder</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">skipFeats</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">trianglePruneBins</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">bins</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">init_factory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build a signature factory.&quot;&quot;&quot;</span>

    <span class="c1"># Get feature factory</span>
    <span class="n">feature_factory</span> <span class="o">=</span> <span class="n">get_feature_factory</span><span class="p">(</span><span class="n">factory</span><span class="p">)</span>

    <span class="c1"># Get default params and override them as needed</span>
    <span class="n">params</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">get_sig_factory_params</span><span class="p">(</span>
        <span class="n">factory</span><span class="p">,</span>
        <span class="n">useCounts</span><span class="o">=</span><span class="n">useCounts</span><span class="p">,</span>
        <span class="n">minPointCount</span><span class="o">=</span><span class="n">minPointCount</span><span class="p">,</span>
        <span class="n">maxPointCount</span><span class="o">=</span><span class="n">maxPointCount</span><span class="p">,</span>
        <span class="n">shortestPathsOnly</span><span class="o">=</span><span class="n">shortestPathsOnly</span><span class="p">,</span>
        <span class="n">includeBondOrder</span><span class="o">=</span><span class="n">includeBondOrder</span><span class="p">,</span>
        <span class="n">skipFeats</span><span class="o">=</span><span class="n">skipFeats</span><span class="p">,</span>
        <span class="n">trianglePruneBins</span><span class="o">=</span><span class="n">trianglePruneBins</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Build signature factory</span>
    <span class="n">sig_factory</span> <span class="o">=</span> <span class="n">SigFactory</span><span class="p">(</span><span class="n">feature_factory</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># Set bins</span>
    <span class="n">sig_factory</span><span class="o">.</span><span class="n">SetBins</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span>

    <span class="c1"># Init the factory</span>
    <span class="k">if</span> <span class="n">init_factory</span><span class="p">:</span>
        <span class="n">sig_factory</span><span class="o">.</span><span class="n">Init</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">sig_factory</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="molfeat.calc.pharmacophore.get_sig_factory_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_sig_factory_params</span><span class="p">(</span><span class="n">factory_name</span><span class="p">,</span> <span class="n">useCounts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minPointCount</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxPointCount</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shortestPathsOnly</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">includeBondOrder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skipFeats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trianglePruneBins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#molfeat.calc.pharmacophore.get_sig_factory_params" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get the default parameter for a given sig factory allowing some of them to be overriden.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>factory_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the factory.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/pharmacophore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_sig_factory_params</span><span class="p">(</span>
    <span class="n">factory_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">useCounts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">minPointCount</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">maxPointCount</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">shortestPathsOnly</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">includeBondOrder</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">skipFeats</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">trianglePruneBins</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">bins</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">list</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the default parameter for a given sig factory allowing some of them to be overriden.</span>

<span class="sd">    Args:</span>
<span class="sd">        factory_name: The name of the factory.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get default params.</span>

    <span class="k">if</span> <span class="n">factory_name</span> <span class="o">==</span> <span class="s2">&quot;cats&quot;</span><span class="p">:</span>
        <span class="n">default_bins</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">useCounts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">minPointCount</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">maxPointCount</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">trianglePruneBins</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">shortestPathsOnly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">includeBondOrder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">factory_name</span> <span class="o">==</span> <span class="s2">&quot;gobbi&quot;</span><span class="p">:</span>
        <span class="n">default_bins</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">100</span><span class="p">)]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">useCounts</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">minPointCount</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">maxPointCount</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">trianglePruneBins</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">shortestPathsOnly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">includeBondOrder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">factory_name</span> <span class="o">==</span> <span class="s2">&quot;pmapper&quot;</span><span class="p">:</span>
        <span class="n">default_bins</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">100</span><span class="p">)]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">useCounts</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">minPointCount</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">maxPointCount</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">trianglePruneBins</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">shortestPathsOnly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">includeBondOrder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">factory_name</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">useCounts</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">minPointCount</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">maxPointCount</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">trianglePruneBins</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">shortestPathsOnly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">skipFeats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ZnBinder&quot;</span><span class="p">,</span> <span class="s2">&quot;LumpedHydrophobe&quot;</span><span class="p">],</span>
            <span class="n">includeBondOrder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">default_bins</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">100</span><span class="p">)]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Default values for </span><span class="si">{</span><span class="n">factory_name</span><span class="si">}</span><span class="s2"> are not known.&quot;</span><span class="p">)</span>

    <span class="c1"># Override default params when set.</span>

    <span class="k">if</span> <span class="n">minPointCount</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;minPointCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minPointCount</span>

    <span class="k">if</span> <span class="n">maxPointCount</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;maxPointCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxPointCount</span>

    <span class="k">if</span> <span class="n">trianglePruneBins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;trianglePruneBins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trianglePruneBins</span>

    <span class="k">if</span> <span class="n">includeBondOrder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;includeBondOrder&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">includeBondOrder</span>

    <span class="k">if</span> <span class="n">useCounts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;useCounts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">useCounts</span>

    <span class="k">if</span> <span class="n">skipFeats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;skipFeats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">skipFeats</span>  <span class="c1"># type: ignore</span>

    <span class="k">if</span> <span class="n">shortestPathsOnly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;shortestPathsOnly&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shortestPathsOnly</span>

    <span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span> <span class="ow">or</span> <span class="n">default_bins</span>

    <span class="k">return</span> <span class="n">params</span><span class="p">,</span> <span class="n">bins</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />
<h3 id="scaffold-keys"><code>Scaffold Keys</code><a class="headerlink" href="#scaffold-keys" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="molfeat.calc.skeys"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="molfeat.calc.skeys.ScaffoldKeyCalculator" class="doc doc-heading">
            <code>ScaffoldKeyCalculator</code>


<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="molfeat.calc.base.SerializableCalculator" href="#molfeat.calc.base.SerializableCalculator">SerializableCalculator</a></code></p>


        <p>Implementation of the Scaffold Keys described in
<code>Identification of Bioisosteric Scaffolds using Scaffold Keys</code> by Peter Ertl</p>






              <details class="quote">
                <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ScaffoldKeyCalculator</span><span class="p">(</span><span class="n">SerializableCalculator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implementation of the Scaffold Keys described in</span>
<span class="sd">    `Identification of Bioisosteric Scaffolds using Scaffold Keys` by Peter Ertl</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DESCRIPTORS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;n_atom_in_rings&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_atom_in_conjugated_ring&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_atoms_not_in_conjugated_ring&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_atom_in_chain&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_atom_exocyclic&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_nitrogen&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_nitrogen_in_ring&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_oxygen&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_oxygen_in_ring&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_sulfur&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_heteroatoms&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_heteroatoms_in_ring&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_atom_spiro_atoms&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_heteroatom_more_than_2_conn&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_carbon_atleast_2_heteroatoms&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_atom_at_least_2_nei_more_than_2_conn&quot;</span><span class="p">,</span>
        <span class="s2">&quot;abs_scaffold_format_charge&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_bonds&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_multiple_non_conj_ring_bonds&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_bonds_2_heteroatoms&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_carbon_het_carbon_het_bonds&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_bonds_at_least_3_conn&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_exocyclic_single_bonds_carbon&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_exocyclic_single_bonds_nitrogen&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_non_ring_bonds_2_conj_rings&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_non_ring_bonds_conj_nonconj_rings&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_bonds_atoms_with_at_least_one_nei_with_2_conn&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_simple_rings&quot;</span><span class="p">,</span>
        <span class="s2">&quot;size_largest_ring&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_simple_rings_no_heteroatoms&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_simple_rings_1_heteroatoms&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_simple_rings_2_heteroatoms&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_simple_rings_at_least_3_heteroatoms&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_simple_non_conj_5_atoms_rings&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_simple_non_conj_6_atoms_rings&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_ring_system&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_ring_system_with_2_non_conj_simple_ring&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_ring_system_with_2_conj_simple_ring&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_ring_system_with_conj_non_conj_simple_ring&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_ring_system_with_3_conj_simple_ring&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_ring_system_with_3_non_conj_simple_ring&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_ring_system_with_greater_one_conj_nonconj_simple_ring&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">NORM_PARAMS</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">molfeat</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;data/skey_parameters.csv&quot;</span><span class="p">),</span>
        <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">DESCRIPTORS</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">use_scaffold</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Init of the scaffold key function</span>

<span class="sd">        Args:</span>
<span class="sd">            normalize: whether to normalize the value of the feature</span>
<span class="sd">            verbose: whether to log errors</span>
<span class="sd">            use_scaffold: whether to convert the molecule into scaffold first</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span> <span class="o">=</span> <span class="n">normalize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_scaffold</span> <span class="o">=</span> <span class="n">use_scaffold</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get state of the scaffold key function&quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;normalize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;use_scaffold&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_scaffold</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DESCRIPTORS</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">compute_normalization</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Normalize input features. The normalization parameters are</span>
<span class="sd">        computed by the scaffolds of 2.1M molecules from CHEMBL 29.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">features</span> <span class="o">-</span> <span class="bp">cls</span><span class="o">.</span><span class="n">NORM_PARAMS</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="bp">cls</span><span class="o">.</span><span class="n">NORM_PARAMS</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">n_atom_in_rings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;1. number of ring atoms&quot;&quot;&quot;</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[r]&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">n_atom_in_conjugated_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;2. number of atoms in conjugated rings&quot;&quot;&quot;</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetRingInfo</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">ri</span><span class="o">.</span><span class="n">AtomRings</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ring</span><span class="p">):</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">n</span>

    <span class="k">def</span> <span class="nf">n_atoms_not_in_conjugated_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        3. number of atoms not in conjugated rings</span>
<span class="sd">        (i.e. atoms in aliphatic rings and non-ring atoms)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># EN: replace conjugation by aromatic</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetRingInfo</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">ri</span><span class="o">.</span><span class="n">AtomRings</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ring</span><span class="p">):</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">n</span>

    <span class="k">def</span> <span class="nf">n_atom_in_chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;4. number atoms in chains (not counting double-connected exo-chain atoms)&quot;&quot;&quot;</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[!r;!$(*=[r])]&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">n_atom_exocyclic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;5. number of exocyclic atoms (connected by multiple bonds to a ring)&quot;&quot;&quot;</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[!r;!$(*-[r])&amp;$(*~[r])]&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">n_nitrogen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;6. number of nitrogen&quot;&quot;&quot;</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[#7]&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">n_nitrogen_in_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;7. number of nitrogen in rings&quot;&quot;&quot;</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[#7;r]&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">n_oxygen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;8. number of oxygen&quot;&quot;&quot;</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[#8]&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">n_oxygen_in_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;9. number of oxygen in rings&quot;&quot;&quot;</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[#8]&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">n_sulfur</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;10. number of sulfur atoms&quot;&quot;&quot;</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[#16]&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">n_heteroatoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;11. number of heteroatoms&quot;&quot;&quot;</span>

        <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[!#1&amp;!#6]&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">n_heteroatoms_in_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;12. number of heteroatoms in rings&quot;&quot;&quot;</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[!#1&amp;!#6&amp;r]&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">n_atom_spiro_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;13. number of spiro atoms&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Desc</span><span class="o">.</span><span class="n">CalcNumSpiroAtoms</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">n_heteroatom_more_than_2_conn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;14. number of heteroatoms with more than 2 connections&quot;&quot;&quot;</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[!#1;!#6;!D1!D0;!D2]&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">n_carbon_atleast_2_heteroatoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;15. number of carbon atoms connected to at least 2 heteroatoms&quot;&quot;&quot;</span>
        <span class="n">n_atoms</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">():</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">GetNeighbors</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">GetAtomicNum</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span>
            <span class="n">n_atoms</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">n_atoms</span>

    <span class="k">def</span> <span class="nf">n_atom_at_least_2_nei_more_than_2_conn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;16. Number of atoms where at least 2 connected atoms have more than 2 connections&quot;&quot;&quot;</span>
        <span class="n">n_atoms</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">():</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">GetNeighbors</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">GetNeighbors</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">n_atoms</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">n_atoms</span>

    <span class="k">def</span> <span class="nf">abs_scaffold_format_charge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;17. absolute value of the scaffold formal charge&quot;&quot;&quot;</span>
        <span class="n">charge</span> <span class="o">=</span> <span class="n">GetFormalCharge</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">charge</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">n_bonds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;18. number of bonds&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumBonds</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">n_multiple_non_conj_ring_bonds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;19. number of multiple, nonconjugated ring bonds&quot;&quot;&quot;</span>
        <span class="n">extracted_rings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nr_multiple_bonds_infcr</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># infcr: in not fully conjugated ring</span>
        <span class="n">rings</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">GetSymmSSSR</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rings</span><span class="p">)):</span>
            <span class="n">extracted_rings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rings</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">extracted_rings</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ring</span><span class="p">):</span>
                <span class="n">nr_multiple_bonds_infcr</span> <span class="o">+=</span> <span class="n">_n_multiple_bond_in_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ring</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nr_multiple_bonds_infcr</span>

    <span class="k">def</span> <span class="nf">n_bonds_2_heteroatoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;20. number of bonds connecting 2 heteroatoms&quot;&quot;&quot;</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[!#1&amp;!#6]~[!#1&amp;!#6]&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">n_carbon_het_carbon_het_bonds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;21. number of bonds connecting 2 heteroatoms through 2 carbons&quot;&quot;&quot;</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[!#1&amp;!#6]~[#6]~[#6]~[!#1&amp;!#6]&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">n_bonds_at_least_3_conn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;22. number of bonds with at least 3 connections on both its atoms&quot;&quot;&quot;</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[$([!#1](~[!#1])(~[!#1])~[!#1])][$([!#1](~[!#1])(~[!#1])~[!#1])]&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">n_exocyclic_single_bonds_carbon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;23. number of exocyclic single bonds where a ring atom is carbon&quot;&quot;&quot;</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[!R;!#1]-[#6;R]&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">n_exocyclic_single_bonds_nitrogen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;24. number of exocyclic single bonds where a ring atom is nitrogen&quot;&quot;&quot;</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[!R;!#1]-[#7;R]&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">n_non_ring_bonds_2_conj_rings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;25. number of non-ring bonds connecting 2 nonconjugated rings&quot;&quot;&quot;</span>
        <span class="c1"># EN: this is interpretated literally as bonds and not path</span>
        <span class="n">ring_atom_conj_state</span> <span class="o">=</span> <span class="n">_ring_atom_state</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[R:1]!@[R:2]&quot;</span><span class="p">)</span>
        <span class="n">bond_list</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">a_start</span><span class="p">,</span> <span class="n">a_end</span> <span class="ow">in</span> <span class="n">bond_list</span><span class="p">:</span>
            <span class="n">s_state</span> <span class="o">=</span> <span class="n">ring_atom_conj_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a_start</span><span class="p">)</span>
            <span class="n">e_state</span> <span class="o">=</span> <span class="n">ring_atom_conj_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a_end</span><span class="p">)</span>
            <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">s_state</span> <span class="ow">and</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">e_state</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">n_non_ring_bonds_conj_nonconj_rings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        26. number of non-ring bonds connecting 2 rings,</span>
<span class="sd">        one of them conjugated and one non-conjugated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># EN: this is interpretated literally as bonds and not path</span>

        <span class="n">ring_atom_conj_state</span> <span class="o">=</span> <span class="n">_ring_atom_state</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[R:1]!@[R:2]&quot;</span><span class="p">)</span>
        <span class="n">bond_list</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">a_start</span><span class="p">,</span> <span class="n">a_end</span> <span class="ow">in</span> <span class="n">bond_list</span><span class="p">:</span>
            <span class="n">s_state</span> <span class="o">=</span> <span class="n">ring_atom_conj_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a_start</span><span class="p">)</span>
            <span class="n">e_state</span> <span class="o">=</span> <span class="n">ring_atom_conj_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a_end</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="kc">True</span> <span class="ow">in</span> <span class="n">s_state</span> <span class="ow">and</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">e_state</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="kc">False</span> <span class="ow">in</span> <span class="n">s_state</span> <span class="ow">and</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">e_state</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">n_bonds_atoms_with_at_least_one_nei_with_2_conn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        27. number of bonds where both atoms have at least one neighbor</span>
<span class="sd">        (not considering the bond atoms) with more than 2 connections</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">huge_conn</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[*;!D0;!D1;!D2]&quot;</span><span class="p">),</span> <span class="n">uniquify</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetBonds</span><span class="p">():</span>
            <span class="n">a_start</span><span class="p">,</span> <span class="n">a_end</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">GetBeginAtom</span><span class="p">(),</span> <span class="n">bond</span><span class="o">.</span><span class="n">GetEndAtom</span><span class="p">()</span>
            <span class="c1"># we need to exclud the bond atom themselves</span>
            <span class="n">allowed_conn_table</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">huge_conn</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">a_start</span><span class="o">.</span><span class="n">GetIdx</span><span class="p">(),</span> <span class="n">a_end</span><span class="o">.</span><span class="n">GetIdx</span><span class="p">()]</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">GetIdx</span><span class="p">()</span> <span class="ow">in</span> <span class="n">allowed_conn_table</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">a_start</span><span class="o">.</span><span class="n">GetNeighbors</span><span class="p">()])</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
                <span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">GetIdx</span><span class="p">()</span> <span class="ow">in</span> <span class="n">allowed_conn_table</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">a_end</span><span class="o">.</span><span class="n">GetNeighbors</span><span class="p">()]</span>
            <span class="p">):</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">n_simple_rings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;28. number of simple rings&quot;&quot;&quot;</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetRingInfo</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ri</span><span class="o">.</span><span class="n">NumRings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">size_largest_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;29. Size of the largest ring&quot;&quot;&quot;</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetRingInfo</span><span class="p">()</span>
        <span class="n">max_ring_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ri</span><span class="o">.</span><span class="n">AtomRings</span><span class="p">()),</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">max_ring_size</span>

    <span class="k">def</span> <span class="nf">n_simple_rings_no_heteroatoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;30. number of simple rings with no heteroatoms&quot;&quot;&quot;</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetRingInfo</span><span class="p">()</span>
        <span class="n">n_heteros</span> <span class="o">=</span> <span class="n">_count_heteroatom_per_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ri</span><span class="o">.</span><span class="n">AtomRings</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">n_heteros</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">n_simple_rings_1_heteroatoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;31. number of simple rings with 1 heteroatom&quot;&quot;&quot;</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetRingInfo</span><span class="p">()</span>
        <span class="n">n_heteros</span> <span class="o">=</span> <span class="n">_count_heteroatom_per_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ri</span><span class="o">.</span><span class="n">AtomRings</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">n_heteros</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">n_simple_rings_2_heteroatoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;32. number of simple rings with 2 heteroatom&quot;&quot;&quot;</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetRingInfo</span><span class="p">()</span>
        <span class="n">n_heteros</span> <span class="o">=</span> <span class="n">_count_heteroatom_per_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ri</span><span class="o">.</span><span class="n">AtomRings</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">n_heteros</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">n_simple_rings_at_least_3_heteroatoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;33. number of simple rings with 3 or more heteroatoms&quot;&quot;&quot;</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetRingInfo</span><span class="p">()</span>
        <span class="n">n_heteros</span> <span class="o">=</span> <span class="n">_count_heteroatom_per_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ri</span><span class="o">.</span><span class="n">AtomRings</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">n_heteros</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">n_simple_non_conj_5_atoms_rings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;34. number of simple non-conjugated rings with 5 atoms&quot;&quot;&quot;</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetRingInfo</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">ri</span><span class="o">.</span><span class="n">AtomRings</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ring</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">n</span>

    <span class="k">def</span> <span class="nf">n_simple_non_conj_6_atoms_rings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;35. number of simple non-conjugated rings with 6 atoms&quot;&quot;&quot;</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetRingInfo</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">ri</span><span class="o">.</span><span class="n">AtomRings</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ring</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">n</span>

    <span class="k">def</span> <span class="nf">n_ring_system</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;36. number of ring systems&quot;&quot;&quot;</span>
        <span class="n">simple_rings</span><span class="p">,</span> <span class="n">ring_system</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_get_ring_system</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">ring_system</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">n_ring_system_with_2_non_conj_simple_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;37. number of rings systems with 2 non-conjugated simple rings&quot;&quot;&quot;</span>
        <span class="n">simple_rings</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ring_map</span> <span class="o">=</span> <span class="n">_get_ring_system</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="n">conj_rings_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">simple_rings</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ring_set</span> <span class="ow">in</span> <span class="n">ring_map</span><span class="p">:</span>
            <span class="n">n_not_conj</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="ow">not</span> <span class="n">conj_rings_map</span><span class="p">[</span><span class="n">rnum</span><span class="p">]</span> <span class="k">for</span> <span class="n">rnum</span> <span class="ow">in</span> <span class="n">ring_set</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">n_not_conj</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">n_ring_system_with_2_conj_simple_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;38. number of rings systems with 2 conjugated simple rings&quot;&quot;&quot;</span>
        <span class="n">simple_rings</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ring_map</span> <span class="o">=</span> <span class="n">_get_ring_system</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="n">conj_rings_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">simple_rings</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ring_set</span> <span class="ow">in</span> <span class="n">ring_map</span><span class="p">:</span>
            <span class="n">n_conj</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">conj_rings_map</span><span class="p">[</span><span class="n">rnum</span><span class="p">]</span> <span class="k">for</span> <span class="n">rnum</span> <span class="ow">in</span> <span class="n">ring_set</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">n_conj</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">n_ring_system_with_conj_non_conj_simple_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;39 number of ring system containing 2 simple rings, one conjugated and one nonconjugated&quot;&quot;&quot;</span>
        <span class="n">simple_rings</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ring_map</span> <span class="o">=</span> <span class="n">_get_ring_system</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="n">conj_rings_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">simple_rings</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ring_set</span> <span class="ow">in</span> <span class="n">ring_map</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ring_set</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">n_conj</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">conj_rings_map</span><span class="p">[</span><span class="n">rnum</span><span class="p">]</span> <span class="k">for</span> <span class="n">rnum</span> <span class="ow">in</span> <span class="n">ring_set</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="n">n_conj</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">n_ring_system_with_3_conj_simple_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;40. number of rings systems with 3 conjugated simple rings&quot;&quot;&quot;</span>
        <span class="n">simple_rings</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ring_map</span> <span class="o">=</span> <span class="n">_get_ring_system</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="n">conj_rings_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">simple_rings</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ring_set</span> <span class="ow">in</span> <span class="n">ring_map</span><span class="p">:</span>
            <span class="n">n_conj</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">conj_rings_map</span><span class="p">[</span><span class="n">rnum</span><span class="p">]</span> <span class="k">for</span> <span class="n">rnum</span> <span class="ow">in</span> <span class="n">ring_set</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">n_conj</span> <span class="o">==</span> <span class="mi">3</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">n_ring_system_with_3_non_conj_simple_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;41. number of rings systems with 3 non-conjugated simple rings&quot;&quot;&quot;</span>
        <span class="n">simple_rings</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ring_map</span> <span class="o">=</span> <span class="n">_get_ring_system</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="n">conj_rings_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">simple_rings</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ring_set</span> <span class="ow">in</span> <span class="n">ring_map</span><span class="p">:</span>
            <span class="n">n_not_conj</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="ow">not</span> <span class="n">conj_rings_map</span><span class="p">[</span><span class="n">rnum</span><span class="p">]</span> <span class="k">for</span> <span class="n">rnum</span> <span class="ow">in</span> <span class="n">ring_set</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">n_not_conj</span> <span class="o">==</span> <span class="mi">3</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">n_ring_system_with_greater_one_conj_nonconj_simple_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;42. number of ring system containing 3 simple rings, at least one conjugated and one nonconjugated&quot;&quot;&quot;</span>
        <span class="n">simple_rings</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ring_map</span> <span class="o">=</span> <span class="n">_get_ring_system</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="n">conj_rings_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">simple_rings</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ring_set</span> <span class="ow">in</span> <span class="n">ring_map</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ring_set</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">n_conj</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">conj_rings_map</span><span class="p">[</span><span class="n">rnum</span><span class="p">]</span> <span class="k">for</span> <span class="n">rnum</span> <span class="ow">in</span> <span class="n">ring_set</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="n">n_conj</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the name of all the descriptors of this calculator&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DESCRIPTORS</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the Fingerprint of a molecule</span>

<span class="sd">        Args:</span>
<span class="sd">            mol: the molecule of interest</span>

<span class="sd">        Returns:</span>
<span class="sd">            props (np.ndarray): list of computed rdkit molecular descriptors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_scaffold</span> <span class="ow">and</span> <span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="n">MurckoScaffold</span><span class="o">.</span><span class="n">GetScaffoldForMol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>

        <span class="n">props</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DESCRIPTORS</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                <span class="n">props</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="n">mol</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="n">props</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">))</span>
        <span class="n">props</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_normalization</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">props</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.columns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">columns</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.columns" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the name of all the descriptors of this calculator</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.__call__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute the Fingerprint of a molecule</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mol</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="datamol.Mol">Mol</span>, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the molecule of interest</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>props</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of computed rdkit molecular descriptors</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the Fingerprint of a molecule</span>

<span class="sd">    Args:</span>
<span class="sd">        mol: the molecule of interest</span>

<span class="sd">    Returns:</span>
<span class="sd">        props (np.ndarray): list of computed rdkit molecular descriptors</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_scaffold</span> <span class="ow">and</span> <span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">MurckoScaffold</span><span class="o">.</span><span class="n">GetScaffoldForMol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>

    <span class="n">props</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DESCRIPTORS</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="n">props</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="n">mol</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">props</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">))</span>
    <span class="n">props</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_normalization</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">props</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.__getstate__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__getstate__</span><span class="p">()</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.__getstate__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get state of the scaffold key function</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get state of the scaffold key function&quot;&quot;&quot;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;normalize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;use_scaffold&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_scaffold</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_scaffold</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Init of the scaffold key function</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>normalize</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to normalize the value of the feature</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to log errors</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_scaffold</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to convert the molecule into scaffold first</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">use_scaffold</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Init of the scaffold key function</span>

<span class="sd">    Args:</span>
<span class="sd">        normalize: whether to normalize the value of the feature</span>
<span class="sd">        verbose: whether to log errors</span>
<span class="sd">        use_scaffold: whether to convert the molecule into scaffold first</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span> <span class="o">=</span> <span class="n">normalize</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">use_scaffold</span> <span class="o">=</span> <span class="n">use_scaffold</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.abs_scaffold_format_charge" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">abs_scaffold_format_charge</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.abs_scaffold_format_charge" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>absolute value of the scaffold formal charge</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">abs_scaffold_format_charge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;17. absolute value of the scaffold formal charge&quot;&quot;&quot;</span>
    <span class="n">charge</span> <span class="o">=</span> <span class="n">GetFormalCharge</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">charge</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.compute_normalization" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_normalization</span><span class="p">(</span><span class="n">features</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.compute_normalization" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Normalize input features. The normalization parameters are
computed by the scaffolds of 2.1M molecules from CHEMBL 29.</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">compute_normalization</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize input features. The normalization parameters are</span>
<span class="sd">    computed by the scaffolds of 2.1M molecules from CHEMBL 29.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">features</span> <span class="o">-</span> <span class="bp">cls</span><span class="o">.</span><span class="n">NORM_PARAMS</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="bp">cls</span><span class="o">.</span><span class="n">NORM_PARAMS</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_at_least_2_nei_more_than_2_conn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_atom_at_least_2_nei_more_than_2_conn</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_at_least_2_nei_more_than_2_conn" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>Number of atoms where at least 2 connected atoms have more than 2 connections</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_atom_at_least_2_nei_more_than_2_conn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;16. Number of atoms where at least 2 connected atoms have more than 2 connections&quot;&quot;&quot;</span>
    <span class="n">n_atoms</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">():</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">GetNeighbors</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">GetNeighbors</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">n_atoms</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">n_atoms</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_exocyclic" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_atom_exocyclic</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_exocyclic" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of exocyclic atoms (connected by multiple bonds to a ring)</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_atom_exocyclic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;5. number of exocyclic atoms (connected by multiple bonds to a ring)&quot;&quot;&quot;</span>
    <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[!r;!$(*-[r])&amp;$(*~[r])]&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_in_chain" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_atom_in_chain</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_in_chain" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number atoms in chains (not counting double-connected exo-chain atoms)</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_atom_in_chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;4. number atoms in chains (not counting double-connected exo-chain atoms)&quot;&quot;&quot;</span>
    <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[!r;!$(*=[r])]&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_in_conjugated_ring" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_atom_in_conjugated_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_in_conjugated_ring" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of atoms in conjugated rings</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_atom_in_conjugated_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;2. number of atoms in conjugated rings&quot;&quot;&quot;</span>
    <span class="n">ri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetRingInfo</span><span class="p">()</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">ri</span><span class="o">.</span><span class="n">AtomRings</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ring</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">n</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_in_rings" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_atom_in_rings</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_in_rings" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of ring atoms</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_atom_in_rings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;1. number of ring atoms&quot;&quot;&quot;</span>
    <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[r]&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_spiro_atoms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_atom_spiro_atoms</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_atom_spiro_atoms" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of spiro atoms</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_atom_spiro_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;13. number of spiro atoms&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Desc</span><span class="o">.</span><span class="n">CalcNumSpiroAtoms</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_atoms_not_in_conjugated_ring" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_atoms_not_in_conjugated_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_atoms_not_in_conjugated_ring" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of atoms not in conjugated rings
(i.e. atoms in aliphatic rings and non-ring atoms)</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_atoms_not_in_conjugated_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    3. number of atoms not in conjugated rings</span>
<span class="sd">    (i.e. atoms in aliphatic rings and non-ring atoms)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># EN: replace conjugation by aromatic</span>
    <span class="n">ri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetRingInfo</span><span class="p">()</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">ri</span><span class="o">.</span><span class="n">AtomRings</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ring</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">n</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_bonds" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_bonds</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_bonds" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of bonds</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_bonds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;18. number of bonds&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumBonds</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_bonds_2_heteroatoms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_bonds_2_heteroatoms</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_bonds_2_heteroatoms" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of bonds connecting 2 heteroatoms</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_bonds_2_heteroatoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;20. number of bonds connecting 2 heteroatoms&quot;&quot;&quot;</span>
    <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[!#1&amp;!#6]~[!#1&amp;!#6]&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_bonds_at_least_3_conn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_bonds_at_least_3_conn</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_bonds_at_least_3_conn" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of bonds with at least 3 connections on both its atoms</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_bonds_at_least_3_conn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;22. number of bonds with at least 3 connections on both its atoms&quot;&quot;&quot;</span>
    <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[$([!#1](~[!#1])(~[!#1])~[!#1])][$([!#1](~[!#1])(~[!#1])~[!#1])]&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_bonds_atoms_with_at_least_one_nei_with_2_conn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_bonds_atoms_with_at_least_one_nei_with_2_conn</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_bonds_atoms_with_at_least_one_nei_with_2_conn" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of bonds where both atoms have at least one neighbor
(not considering the bond atoms) with more than 2 connections</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_bonds_atoms_with_at_least_one_nei_with_2_conn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    27. number of bonds where both atoms have at least one neighbor</span>
<span class="sd">    (not considering the bond atoms) with more than 2 connections</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">huge_conn</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[*;!D0;!D1;!D2]&quot;</span><span class="p">),</span> <span class="n">uniquify</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetBonds</span><span class="p">():</span>
        <span class="n">a_start</span><span class="p">,</span> <span class="n">a_end</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">GetBeginAtom</span><span class="p">(),</span> <span class="n">bond</span><span class="o">.</span><span class="n">GetEndAtom</span><span class="p">()</span>
        <span class="c1"># we need to exclud the bond atom themselves</span>
        <span class="n">allowed_conn_table</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">huge_conn</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">a_start</span><span class="o">.</span><span class="n">GetIdx</span><span class="p">(),</span> <span class="n">a_end</span><span class="o">.</span><span class="n">GetIdx</span><span class="p">()]</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">GetIdx</span><span class="p">()</span> <span class="ow">in</span> <span class="n">allowed_conn_table</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">a_start</span><span class="o">.</span><span class="n">GetNeighbors</span><span class="p">()])</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">GetIdx</span><span class="p">()</span> <span class="ow">in</span> <span class="n">allowed_conn_table</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">a_end</span><span class="o">.</span><span class="n">GetNeighbors</span><span class="p">()]</span>
        <span class="p">):</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_carbon_atleast_2_heteroatoms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_carbon_atleast_2_heteroatoms</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_carbon_atleast_2_heteroatoms" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of carbon atoms connected to at least 2 heteroatoms</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_carbon_atleast_2_heteroatoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;15. number of carbon atoms connected to at least 2 heteroatoms&quot;&quot;&quot;</span>
    <span class="n">n_atoms</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">():</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">GetNeighbors</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">GetAtomicNum</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span>
        <span class="n">n_atoms</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">n_atoms</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_carbon_het_carbon_het_bonds" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_carbon_het_carbon_het_bonds</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_carbon_het_carbon_het_bonds" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of bonds connecting 2 heteroatoms through 2 carbons</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_carbon_het_carbon_het_bonds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;21. number of bonds connecting 2 heteroatoms through 2 carbons&quot;&quot;&quot;</span>
    <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[!#1&amp;!#6]~[#6]~[#6]~[!#1&amp;!#6]&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_exocyclic_single_bonds_carbon" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_exocyclic_single_bonds_carbon</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_exocyclic_single_bonds_carbon" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of exocyclic single bonds where a ring atom is carbon</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_exocyclic_single_bonds_carbon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;23. number of exocyclic single bonds where a ring atom is carbon&quot;&quot;&quot;</span>
    <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[!R;!#1]-[#6;R]&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_exocyclic_single_bonds_nitrogen" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_exocyclic_single_bonds_nitrogen</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_exocyclic_single_bonds_nitrogen" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of exocyclic single bonds where a ring atom is nitrogen</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_exocyclic_single_bonds_nitrogen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;24. number of exocyclic single bonds where a ring atom is nitrogen&quot;&quot;&quot;</span>
    <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[!R;!#1]-[#7;R]&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_heteroatom_more_than_2_conn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_heteroatom_more_than_2_conn</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_heteroatom_more_than_2_conn" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of heteroatoms with more than 2 connections</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_heteroatom_more_than_2_conn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;14. number of heteroatoms with more than 2 connections&quot;&quot;&quot;</span>
    <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[!#1;!#6;!D1!D0;!D2]&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_heteroatoms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_heteroatoms</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_heteroatoms" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of heteroatoms</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_heteroatoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;11. number of heteroatoms&quot;&quot;&quot;</span>

    <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[!#1&amp;!#6]&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_heteroatoms_in_ring" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_heteroatoms_in_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_heteroatoms_in_ring" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of heteroatoms in rings</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_heteroatoms_in_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;12. number of heteroatoms in rings&quot;&quot;&quot;</span>
    <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[!#1&amp;!#6&amp;r]&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_multiple_non_conj_ring_bonds" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_multiple_non_conj_ring_bonds</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_multiple_non_conj_ring_bonds" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of multiple, nonconjugated ring bonds</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_multiple_non_conj_ring_bonds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;19. number of multiple, nonconjugated ring bonds&quot;&quot;&quot;</span>
    <span class="n">extracted_rings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">nr_multiple_bonds_infcr</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># infcr: in not fully conjugated ring</span>
    <span class="n">rings</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">GetSymmSSSR</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rings</span><span class="p">)):</span>
        <span class="n">extracted_rings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rings</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">extracted_rings</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ring</span><span class="p">):</span>
            <span class="n">nr_multiple_bonds_infcr</span> <span class="o">+=</span> <span class="n">_n_multiple_bond_in_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ring</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nr_multiple_bonds_infcr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_nitrogen" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_nitrogen</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_nitrogen" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of nitrogen</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_nitrogen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;6. number of nitrogen&quot;&quot;&quot;</span>
    <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[#7]&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_nitrogen_in_ring" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_nitrogen_in_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_nitrogen_in_ring" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of nitrogen in rings</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_nitrogen_in_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;7. number of nitrogen in rings&quot;&quot;&quot;</span>
    <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[#7;r]&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_non_ring_bonds_2_conj_rings" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_non_ring_bonds_2_conj_rings</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_non_ring_bonds_2_conj_rings" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of non-ring bonds connecting 2 nonconjugated rings</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_non_ring_bonds_2_conj_rings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;25. number of non-ring bonds connecting 2 nonconjugated rings&quot;&quot;&quot;</span>
    <span class="c1"># EN: this is interpretated literally as bonds and not path</span>
    <span class="n">ring_atom_conj_state</span> <span class="o">=</span> <span class="n">_ring_atom_state</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[R:1]!@[R:2]&quot;</span><span class="p">)</span>
    <span class="n">bond_list</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">a_start</span><span class="p">,</span> <span class="n">a_end</span> <span class="ow">in</span> <span class="n">bond_list</span><span class="p">:</span>
        <span class="n">s_state</span> <span class="o">=</span> <span class="n">ring_atom_conj_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a_start</span><span class="p">)</span>
        <span class="n">e_state</span> <span class="o">=</span> <span class="n">ring_atom_conj_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a_end</span><span class="p">)</span>
        <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">s_state</span> <span class="ow">and</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">e_state</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_non_ring_bonds_conj_nonconj_rings" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_non_ring_bonds_conj_nonconj_rings</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_non_ring_bonds_conj_nonconj_rings" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of non-ring bonds connecting 2 rings,
one of them conjugated and one non-conjugated</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_non_ring_bonds_conj_nonconj_rings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    26. number of non-ring bonds connecting 2 rings,</span>
<span class="sd">    one of them conjugated and one non-conjugated</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># EN: this is interpretated literally as bonds and not path</span>

    <span class="n">ring_atom_conj_state</span> <span class="o">=</span> <span class="n">_ring_atom_state</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[R:1]!@[R:2]&quot;</span><span class="p">)</span>
    <span class="n">bond_list</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">a_start</span><span class="p">,</span> <span class="n">a_end</span> <span class="ow">in</span> <span class="n">bond_list</span><span class="p">:</span>
        <span class="n">s_state</span> <span class="o">=</span> <span class="n">ring_atom_conj_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a_start</span><span class="p">)</span>
        <span class="n">e_state</span> <span class="o">=</span> <span class="n">ring_atom_conj_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a_end</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="kc">True</span> <span class="ow">in</span> <span class="n">s_state</span> <span class="ow">and</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">e_state</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="kc">False</span> <span class="ow">in</span> <span class="n">s_state</span> <span class="ow">and</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">e_state</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_oxygen" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_oxygen</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_oxygen" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of oxygen</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_oxygen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;8. number of oxygen&quot;&quot;&quot;</span>
    <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[#8]&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_oxygen_in_ring" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_oxygen_in_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_oxygen_in_ring" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of oxygen in rings</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_oxygen_in_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;9. number of oxygen in rings&quot;&quot;&quot;</span>
    <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[#8]&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_ring_system</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of ring systems</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_ring_system</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;36. number of ring systems&quot;&quot;&quot;</span>
    <span class="n">simple_rings</span><span class="p">,</span> <span class="n">ring_system</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_get_ring_system</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">ring_system</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_2_conj_simple_ring" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_ring_system_with_2_conj_simple_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_2_conj_simple_ring" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of rings systems with 2 conjugated simple rings</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_ring_system_with_2_conj_simple_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;38. number of rings systems with 2 conjugated simple rings&quot;&quot;&quot;</span>
    <span class="n">simple_rings</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ring_map</span> <span class="o">=</span> <span class="n">_get_ring_system</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">conj_rings_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">simple_rings</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ring_set</span> <span class="ow">in</span> <span class="n">ring_map</span><span class="p">:</span>
        <span class="n">n_conj</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">conj_rings_map</span><span class="p">[</span><span class="n">rnum</span><span class="p">]</span> <span class="k">for</span> <span class="n">rnum</span> <span class="ow">in</span> <span class="n">ring_set</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">n_conj</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_2_non_conj_simple_ring" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_ring_system_with_2_non_conj_simple_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_2_non_conj_simple_ring" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of rings systems with 2 non-conjugated simple rings</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_ring_system_with_2_non_conj_simple_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;37. number of rings systems with 2 non-conjugated simple rings&quot;&quot;&quot;</span>
    <span class="n">simple_rings</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ring_map</span> <span class="o">=</span> <span class="n">_get_ring_system</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">conj_rings_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">simple_rings</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ring_set</span> <span class="ow">in</span> <span class="n">ring_map</span><span class="p">:</span>
        <span class="n">n_not_conj</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="ow">not</span> <span class="n">conj_rings_map</span><span class="p">[</span><span class="n">rnum</span><span class="p">]</span> <span class="k">for</span> <span class="n">rnum</span> <span class="ow">in</span> <span class="n">ring_set</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">n_not_conj</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_3_conj_simple_ring" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_ring_system_with_3_conj_simple_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_3_conj_simple_ring" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of rings systems with 3 conjugated simple rings</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_ring_system_with_3_conj_simple_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;40. number of rings systems with 3 conjugated simple rings&quot;&quot;&quot;</span>
    <span class="n">simple_rings</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ring_map</span> <span class="o">=</span> <span class="n">_get_ring_system</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">conj_rings_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">simple_rings</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ring_set</span> <span class="ow">in</span> <span class="n">ring_map</span><span class="p">:</span>
        <span class="n">n_conj</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">conj_rings_map</span><span class="p">[</span><span class="n">rnum</span><span class="p">]</span> <span class="k">for</span> <span class="n">rnum</span> <span class="ow">in</span> <span class="n">ring_set</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">n_conj</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_3_non_conj_simple_ring" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_ring_system_with_3_non_conj_simple_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_3_non_conj_simple_ring" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of rings systems with 3 non-conjugated simple rings</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_ring_system_with_3_non_conj_simple_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;41. number of rings systems with 3 non-conjugated simple rings&quot;&quot;&quot;</span>
    <span class="n">simple_rings</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ring_map</span> <span class="o">=</span> <span class="n">_get_ring_system</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">conj_rings_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">simple_rings</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ring_set</span> <span class="ow">in</span> <span class="n">ring_map</span><span class="p">:</span>
        <span class="n">n_not_conj</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="ow">not</span> <span class="n">conj_rings_map</span><span class="p">[</span><span class="n">rnum</span><span class="p">]</span> <span class="k">for</span> <span class="n">rnum</span> <span class="ow">in</span> <span class="n">ring_set</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">n_not_conj</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_conj_non_conj_simple_ring" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_ring_system_with_conj_non_conj_simple_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_conj_non_conj_simple_ring" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>39 number of ring system containing 2 simple rings, one conjugated and one nonconjugated</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_ring_system_with_conj_non_conj_simple_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;39 number of ring system containing 2 simple rings, one conjugated and one nonconjugated&quot;&quot;&quot;</span>
    <span class="n">simple_rings</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ring_map</span> <span class="o">=</span> <span class="n">_get_ring_system</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">conj_rings_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">simple_rings</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ring_set</span> <span class="ow">in</span> <span class="n">ring_map</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ring_set</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">n_conj</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">conj_rings_map</span><span class="p">[</span><span class="n">rnum</span><span class="p">]</span> <span class="k">for</span> <span class="n">rnum</span> <span class="ow">in</span> <span class="n">ring_set</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">n_conj</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_greater_one_conj_nonconj_simple_ring" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_ring_system_with_greater_one_conj_nonconj_simple_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_ring_system_with_greater_one_conj_nonconj_simple_ring" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of ring system containing 3 simple rings, at least one conjugated and one nonconjugated</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_ring_system_with_greater_one_conj_nonconj_simple_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;42. number of ring system containing 3 simple rings, at least one conjugated and one nonconjugated&quot;&quot;&quot;</span>
    <span class="n">simple_rings</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ring_map</span> <span class="o">=</span> <span class="n">_get_ring_system</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">conj_rings_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">simple_rings</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ring_set</span> <span class="ow">in</span> <span class="n">ring_map</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ring_set</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">n_conj</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">conj_rings_map</span><span class="p">[</span><span class="n">rnum</span><span class="p">]</span> <span class="k">for</span> <span class="n">rnum</span> <span class="ow">in</span> <span class="n">ring_set</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">n_conj</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_non_conj_5_atoms_rings" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_simple_non_conj_5_atoms_rings</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_non_conj_5_atoms_rings" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of simple non-conjugated rings with 5 atoms</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_simple_non_conj_5_atoms_rings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;34. number of simple non-conjugated rings with 5 atoms&quot;&quot;&quot;</span>
    <span class="n">ri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetRingInfo</span><span class="p">()</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">ri</span><span class="o">.</span><span class="n">AtomRings</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ring</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">n</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_non_conj_6_atoms_rings" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_simple_non_conj_6_atoms_rings</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_non_conj_6_atoms_rings" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of simple non-conjugated rings with 6 atoms</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_simple_non_conj_6_atoms_rings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;35. number of simple non-conjugated rings with 6 atoms&quot;&quot;&quot;</span>
    <span class="n">ri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetRingInfo</span><span class="p">()</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">ri</span><span class="o">.</span><span class="n">AtomRings</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_ring_fully_conjugated</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ring</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">n</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_rings" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_simple_rings</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_rings" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of simple rings</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_simple_rings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;28. number of simple rings&quot;&quot;&quot;</span>
    <span class="n">ri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetRingInfo</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ri</span><span class="o">.</span><span class="n">NumRings</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_rings_1_heteroatoms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_simple_rings_1_heteroatoms</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_rings_1_heteroatoms" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of simple rings with 1 heteroatom</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_simple_rings_1_heteroatoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;31. number of simple rings with 1 heteroatom&quot;&quot;&quot;</span>
    <span class="n">ri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetRingInfo</span><span class="p">()</span>
    <span class="n">n_heteros</span> <span class="o">=</span> <span class="n">_count_heteroatom_per_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ri</span><span class="o">.</span><span class="n">AtomRings</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">n_heteros</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_rings_2_heteroatoms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_simple_rings_2_heteroatoms</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_rings_2_heteroatoms" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of simple rings with 2 heteroatom</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_simple_rings_2_heteroatoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;32. number of simple rings with 2 heteroatom&quot;&quot;&quot;</span>
    <span class="n">ri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetRingInfo</span><span class="p">()</span>
    <span class="n">n_heteros</span> <span class="o">=</span> <span class="n">_count_heteroatom_per_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ri</span><span class="o">.</span><span class="n">AtomRings</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">n_heteros</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_rings_at_least_3_heteroatoms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_simple_rings_at_least_3_heteroatoms</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_rings_at_least_3_heteroatoms" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of simple rings with 3 or more heteroatoms</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_simple_rings_at_least_3_heteroatoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;33. number of simple rings with 3 or more heteroatoms&quot;&quot;&quot;</span>
    <span class="n">ri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetRingInfo</span><span class="p">()</span>
    <span class="n">n_heteros</span> <span class="o">=</span> <span class="n">_count_heteroatom_per_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ri</span><span class="o">.</span><span class="n">AtomRings</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">n_heteros</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_rings_no_heteroatoms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_simple_rings_no_heteroatoms</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_simple_rings_no_heteroatoms" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of simple rings with no heteroatoms</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_simple_rings_no_heteroatoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;30. number of simple rings with no heteroatoms&quot;&quot;&quot;</span>
    <span class="n">ri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetRingInfo</span><span class="p">()</span>
    <span class="n">n_heteros</span> <span class="o">=</span> <span class="n">_count_heteroatom_per_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ri</span><span class="o">.</span><span class="n">AtomRings</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">n_heteros</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.n_sulfur" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_sulfur</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.n_sulfur" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>number of sulfur atoms</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">n_sulfur</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;10. number of sulfur atoms&quot;&quot;&quot;</span>
    <span class="n">sm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">from_smarts</span><span class="p">(</span><span class="s2">&quot;[#16]&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">uniquify</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.skeys.ScaffoldKeyCalculator.size_largest_ring" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">size_largest_ring</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.ScaffoldKeyCalculator.size_largest_ring" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <ol>
<li>Size of the largest ring</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">size_largest_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;29. Size of the largest ring&quot;&quot;&quot;</span>
    <span class="n">ri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetRingInfo</span><span class="p">()</span>
    <span class="n">max_ring_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ri</span><span class="o">.</span><span class="n">AtomRings</span><span class="p">()),</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">max_ring_size</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="molfeat.calc.skeys.skdistance" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">skdistance</span><span class="p">(</span><span class="n">sk1</span><span class="p">,</span> <span class="n">sk2</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cdist</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#molfeat.calc.skeys.skdistance" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Compute the scaffold distance between two scaffold keys
as described in <a href="https://pubs.acs.org/doi/abs/10.1021/ci5001983">https://pubs.acs.org/doi/abs/10.1021/ci5001983</a>.
The input features are expected to be normalized beforehand (see paper)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>sk1</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>scaffold key 1</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sk2</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>scaffold key 2</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weights</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>how to weight each of the features. By default rank ordering is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cdist</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to compute the features on a batched of inputs (expected 2D)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dist</code></td>            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>distance between two scaffold keys</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/skeys.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">skdistance</span><span class="p">(</span>
    <span class="n">sk1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">sk2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cdist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the scaffold distance between two scaffold keys</span>
<span class="sd">    as described in https://pubs.acs.org/doi/abs/10.1021/ci5001983.</span>
<span class="sd">    The input features are expected to be normalized beforehand (see paper)</span>

<span class="sd">    Args:</span>
<span class="sd">        sk1: scaffold key 1</span>
<span class="sd">        sk2: scaffold key 2</span>
<span class="sd">        weights: how to weight each of the features. By default rank ordering is used.</span>
<span class="sd">        cdist: whether to compute the features on a batched of inputs (expected 2D)</span>

<span class="sd">    Returns:</span>
<span class="sd">        dist (float): distance between two scaffold keys</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sk1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cdist</span><span class="p">:</span>
        <span class="n">sk1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">sk1</span><span class="p">)</span>
        <span class="n">sk2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">sk2</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sk1</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">sk2</span><span class="p">[:])</span> <span class="o">**</span> <span class="mf">1.5</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">val</span> <span class="o">*</span> <span class="n">weights</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="n">sk</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">sk</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">sk</span> <span class="ow">in</span> <span class="p">[</span><span class="n">sk1</span><span class="p">,</span> <span class="n">sk2</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`cdist` mode was not detected, you need to provide single vectors&quot;</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sk1</span> <span class="o">-</span> <span class="n">sk2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.5</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">val</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dist</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />
<h3 id="shape"><code>Shape</code><a class="headerlink" href="#shape" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="molfeat.calc.shape"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="molfeat.calc.shape.ElectroShapeDescriptors" class="doc doc-heading">
            <code>ElectroShapeDescriptors</code>


<a href="#molfeat.calc.shape.ElectroShapeDescriptors" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="molfeat.calc.base.SerializableCalculator" href="#molfeat.calc.base.SerializableCalculator">SerializableCalculator</a></code></p>


        <p>Compute Electroshape descriptors as described by</p>
<p>Armstrong et al. ElectroShape: fast molecular similarity calculations incorporating shape, chirality and electrostatics.
J Comput Aided Mol Des 24, 789-801 (2010). <a href="http://dx.doi.org/doi:10.1007/s10822-010-9374-0">http://dx.doi.org/doi:10.1007/s10822-010-9374-0</a></p>






              <details class="quote">
                <summary>Source code in <code>molfeat/calc/shape.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ElectroShapeDescriptors</span><span class="p">(</span><span class="n">SerializableCalculator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute Electroshape descriptors as described by</span>

<span class="sd">    Armstrong et al. ElectroShape: fast molecular similarity calculations incorporating shape, chirality and electrostatics.</span>
<span class="sd">    J Comput Aided Mol Des 24, 789-801 (2010). http://dx.doi.org/doi:10.1007/s10822-010-9374-0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUPPORTED_CHARGE_MODELS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;gasteiger&quot;</span><span class="p">,</span> <span class="s2">&quot;tripos&quot;</span><span class="p">,</span> <span class="s2">&quot;mmff94&quot;</span><span class="p">,</span> <span class="s2">&quot;formal&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">charge_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gasteiger&quot;</span><span class="p">,</span>
        <span class="n">replace_nan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">electron_scaling</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">25.0</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for ElectroShape descriptor</span>

<span class="sd">        Args:</span>
<span class="sd">            charge_model: charge model to use. One of (&#39;gasteiger&#39;, &#39;tripos&#39;, &#39;mmff94&#39;, &#39;formal&#39;). Defaults to &quot;gasteiger&quot;.</span>
<span class="sd">                Note that formal charges will be computed on the fly if not provided in the input molecules.</span>
<span class="sd">                The `tripos` charge models comes from TRIPOS force field and are often parsed from mol2 files.</span>
<span class="sd">            replace_nan: whether to replace NaN values. Defaults False</span>
<span class="sd">            electron_scaling: scaling factor to convert electron charges to Angstroms. Defaults to 25.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">charge_model</span> <span class="o">=</span> <span class="n">charge_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replace_nan</span> <span class="o">=</span> <span class="n">replace_nan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">electron_scaling</span> <span class="o">=</span> <span class="n">electron_scaling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the name of all the descriptors of this calculator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;dist-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">-mean&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;dist-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">-std&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;dist-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">-crb&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;charge_model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_model</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;replace_nan&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_nan</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;electron_scaling&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electron_scaling</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;_columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the length of the calculator&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">compute_charge</span><span class="p">(</span><span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">charge_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the molecular charge of the molecule.</span>

<span class="sd">        Args:</span>
<span class="sd">            charge_model: charge model to use. One of (&#39;gasteiger&#39;, &#39;tripos&#39;, &#39;mmff94&#39;, &#39;formal&#39;). Defaults to &quot;gasteiger&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">charge_model</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ElectroShapeDescriptors</span><span class="o">.</span><span class="n">SUPPORTED_CHARGE_MODELS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unknown charge model </span><span class="si">{</span><span class="n">charge_model</span><span class="si">}</span><span class="s2">. You should provide one of </span><span class="si">{</span><span class="n">ElectroShapeDescriptors</span><span class="o">.</span><span class="n">SUPPORTED_CHARGE_MODELS</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="n">atom_charge</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">atom_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">())</span>

        <span class="c1"># force compute the partial charges if not provided</span>
        <span class="k">if</span> <span class="n">charge_model</span> <span class="o">==</span> <span class="s2">&quot;gasteiger&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">atom_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">HasProp</span><span class="p">(</span><span class="s2">&quot;_GasteigerCharge&quot;</span><span class="p">):</span>
            <span class="n">rdPartialCharges</span><span class="o">.</span><span class="n">ComputeGasteigerCharges</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">charge_model</span> <span class="o">==</span> <span class="s2">&quot;mmff94&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">atom_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">HasProp</span><span class="p">(</span><span class="s2">&quot;_MMFF94Charge&quot;</span><span class="p">):</span>
            <span class="n">ff_infos</span> <span class="o">=</span> <span class="n">rdForceFieldHelpers</span><span class="o">.</span><span class="n">MMFFGetMoleculeProperties</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">atom_list</span><span class="p">):</span>
                <span class="n">atom</span><span class="o">.</span><span class="n">SetDoubleProp</span><span class="p">(</span><span class="s2">&quot;_MMFF94Charge&quot;</span><span class="p">,</span> <span class="n">ff_infos</span><span class="o">.</span><span class="n">GetMMFFPartialCharge</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">charge_model</span> <span class="o">==</span> <span class="s2">&quot;formal&quot;</span><span class="p">:</span>
                <span class="n">atom_charge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">GetFormalCharge</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">charge_model</span> <span class="o">==</span> <span class="s2">&quot;gasteiger&quot;</span><span class="p">:</span>
                <span class="n">atom_charge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">GetDoubleProp</span><span class="p">(</span><span class="s2">&quot;_GasteigerCharge&quot;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">charge_model</span> <span class="o">==</span> <span class="s2">&quot;mmff94&quot;</span><span class="p">:</span>
                <span class="n">atom_charge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">GetDoubleProp</span><span class="p">(</span><span class="s2">&quot;_MMFF94Charge&quot;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">charge_model</span> <span class="o">==</span> <span class="s2">&quot;tripos&quot;</span><span class="p">:</span>
                <span class="n">atom_charge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">GetDoubleProp</span><span class="p">(</span><span class="s2">&quot;_TriposPartialCharge&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">atom_charge</span><span class="p">)</span>

    <span class="nd">@requires_conformer</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">conformer_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get rdkit 3D descriptors for a molecule</span>

<span class="sd">        Args:</span>
<span class="sd">            mol: the molecule of interest</span>
<span class="sd">            conformer_id (int, optional): Optional conformer id. Defaults to -1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            shape_descriptor (np.ndarray): computed shape descriptor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetConformer</span><span class="p">(</span><span class="n">conformer_id</span><span class="p">)</span><span class="o">.</span><span class="n">GetPositions</span><span class="p">()</span>
        <span class="n">charge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_charge</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_model</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_nan</span><span class="p">:</span>
            <span class="n">charge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">charge</span><span class="p">)</span>

        <span class="n">desc_4d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">coords</span><span class="p">,</span> <span class="n">charge</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">electron_scaling</span><span class="p">))</span>

        <span class="n">c1</span> <span class="o">=</span> <span class="n">desc_4d</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">distances_c1</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">desc_4d</span> <span class="o">-</span> <span class="n">c1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">c2</span> <span class="o">=</span> <span class="n">desc_4d</span><span class="p">[</span><span class="n">distances_c1</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]</span>  <span class="c1"># atom position furthest from c1</span>
        <span class="n">distances_c2</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">desc_4d</span> <span class="o">-</span> <span class="n">c2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">c3</span> <span class="o">=</span> <span class="n">desc_4d</span><span class="p">[</span><span class="n">distances_c2</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]</span>  <span class="c1"># atom position furthest from c2</span>
        <span class="n">distances_c3</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">desc_4d</span> <span class="o">-</span> <span class="n">c3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">vector_a</span> <span class="o">=</span> <span class="n">c2</span> <span class="o">-</span> <span class="n">c1</span>
        <span class="n">vector_b</span> <span class="o">=</span> <span class="n">c3</span> <span class="o">-</span> <span class="n">c1</span>
        <span class="n">vector_as</span> <span class="o">=</span> <span class="n">vector_a</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># spatial parts of these vectors</span>
        <span class="n">vector_bs</span> <span class="o">=</span> <span class="n">vector_b</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># spatial parts of these vectors</span>
        <span class="n">cross_ab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vector_as</span><span class="p">,</span> <span class="n">vector_bs</span><span class="p">)</span>
        <span class="n">vector_c</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">vector_a</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">norm</span><span class="p">(</span><span class="n">cross_ab</span><span class="p">)))</span> <span class="o">*</span> <span class="n">cross_ab</span>
        <span class="n">vector_c1s</span> <span class="o">=</span> <span class="n">c1</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>

        <span class="n">max_charge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">charge</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">electron_scaling</span><span class="p">)</span>
        <span class="n">min_charge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">charge</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">electron_scaling</span><span class="p">)</span>

        <span class="n">c4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vector_c1s</span> <span class="o">+</span> <span class="n">vector_c</span><span class="p">,</span> <span class="n">max_charge</span><span class="p">)</span>
        <span class="n">c5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vector_c1s</span> <span class="o">+</span> <span class="n">vector_c</span><span class="p">,</span> <span class="n">min_charge</span><span class="p">)</span>

        <span class="n">distances_c4</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">desc_4d</span> <span class="o">-</span> <span class="n">c4</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">distances_c5</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">desc_4d</span> <span class="o">-</span> <span class="n">c5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">distances_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">distances_c1</span><span class="p">,</span>
            <span class="n">distances_c2</span><span class="p">,</span>
            <span class="n">distances_c3</span><span class="p">,</span>
            <span class="n">distances_c4</span><span class="p">,</span>
            <span class="n">distances_c5</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">shape_descriptor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">distances</span> <span class="ow">in</span> <span class="n">distances_list</span><span class="p">:</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
            <span class="n">shape_descriptor</span><span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span>
            <span class="n">shape_descriptor</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
            <span class="n">shape_descriptor</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cbrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">distances</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">distances</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_nan</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">shape_descriptor</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">shape_descriptor</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="molfeat.calc.shape.ElectroShapeDescriptors.columns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">columns</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#molfeat.calc.shape.ElectroShapeDescriptors.columns" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the name of all the descriptors of this calculator</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.shape.ElectroShapeDescriptors.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">conformer_id</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#molfeat.calc.shape.ElectroShapeDescriptors.__call__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get rdkit 3D descriptors for a molecule</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mol</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="datamol.Mol">Mol</span>, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the molecule of interest</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conformer_id</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional conformer id. Defaults to -1.</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>shape_descriptor</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>computed shape descriptor</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@requires_conformer</span>
<span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">conformer_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get rdkit 3D descriptors for a molecule</span>

<span class="sd">    Args:</span>
<span class="sd">        mol: the molecule of interest</span>
<span class="sd">        conformer_id (int, optional): Optional conformer id. Defaults to -1.</span>

<span class="sd">    Returns:</span>
<span class="sd">        shape_descriptor (np.ndarray): computed shape descriptor</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetConformer</span><span class="p">(</span><span class="n">conformer_id</span><span class="p">)</span><span class="o">.</span><span class="n">GetPositions</span><span class="p">()</span>
    <span class="n">charge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_charge</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_model</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_nan</span><span class="p">:</span>
        <span class="n">charge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">charge</span><span class="p">)</span>

    <span class="n">desc_4d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">coords</span><span class="p">,</span> <span class="n">charge</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">electron_scaling</span><span class="p">))</span>

    <span class="n">c1</span> <span class="o">=</span> <span class="n">desc_4d</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">distances_c1</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">desc_4d</span> <span class="o">-</span> <span class="n">c1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">c2</span> <span class="o">=</span> <span class="n">desc_4d</span><span class="p">[</span><span class="n">distances_c1</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]</span>  <span class="c1"># atom position furthest from c1</span>
    <span class="n">distances_c2</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">desc_4d</span> <span class="o">-</span> <span class="n">c2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">c3</span> <span class="o">=</span> <span class="n">desc_4d</span><span class="p">[</span><span class="n">distances_c2</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]</span>  <span class="c1"># atom position furthest from c2</span>
    <span class="n">distances_c3</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">desc_4d</span> <span class="o">-</span> <span class="n">c3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">vector_a</span> <span class="o">=</span> <span class="n">c2</span> <span class="o">-</span> <span class="n">c1</span>
    <span class="n">vector_b</span> <span class="o">=</span> <span class="n">c3</span> <span class="o">-</span> <span class="n">c1</span>
    <span class="n">vector_as</span> <span class="o">=</span> <span class="n">vector_a</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># spatial parts of these vectors</span>
    <span class="n">vector_bs</span> <span class="o">=</span> <span class="n">vector_b</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># spatial parts of these vectors</span>
    <span class="n">cross_ab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vector_as</span><span class="p">,</span> <span class="n">vector_bs</span><span class="p">)</span>
    <span class="n">vector_c</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">vector_a</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">norm</span><span class="p">(</span><span class="n">cross_ab</span><span class="p">)))</span> <span class="o">*</span> <span class="n">cross_ab</span>
    <span class="n">vector_c1s</span> <span class="o">=</span> <span class="n">c1</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>

    <span class="n">max_charge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">charge</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">electron_scaling</span><span class="p">)</span>
    <span class="n">min_charge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">charge</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">electron_scaling</span><span class="p">)</span>

    <span class="n">c4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vector_c1s</span> <span class="o">+</span> <span class="n">vector_c</span><span class="p">,</span> <span class="n">max_charge</span><span class="p">)</span>
    <span class="n">c5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vector_c1s</span> <span class="o">+</span> <span class="n">vector_c</span><span class="p">,</span> <span class="n">min_charge</span><span class="p">)</span>

    <span class="n">distances_c4</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">desc_4d</span> <span class="o">-</span> <span class="n">c4</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">distances_c5</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">desc_4d</span> <span class="o">-</span> <span class="n">c5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">distances_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">distances_c1</span><span class="p">,</span>
        <span class="n">distances_c2</span><span class="p">,</span>
        <span class="n">distances_c3</span><span class="p">,</span>
        <span class="n">distances_c4</span><span class="p">,</span>
        <span class="n">distances_c5</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">shape_descriptor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>

    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">distances</span> <span class="ow">in</span> <span class="n">distances_list</span><span class="p">:</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
        <span class="n">shape_descriptor</span><span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span>
        <span class="n">shape_descriptor</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
        <span class="n">shape_descriptor</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cbrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">distances</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">distances</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">3</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_nan</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">shape_descriptor</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">shape_descriptor</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.shape.ElectroShapeDescriptors.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">charge_model</span><span class="o">=</span><span class="s1">&#39;gasteiger&#39;</span><span class="p">,</span> <span class="n">replace_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">electron_scaling</span><span class="o">=</span><span class="mf">25.0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#molfeat.calc.shape.ElectroShapeDescriptors.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Constructor for ElectroShape descriptor</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>charge_model</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>charge model to use. One of ('gasteiger', 'tripos', 'mmff94', 'formal'). Defaults to "gasteiger".
Note that formal charges will be computed on the fly if not provided in the input molecules.
The <code>tripos</code> charge models comes from TRIPOS force field and are often parsed from mol2 files.</p>
              </div>
            </td>
            <td>
                  <code>&#39;gasteiger&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>replace_nan</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to replace NaN values. Defaults False</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>electron_scaling</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>scaling factor to convert electron charges to Angstroms. Defaults to 25.0.</p>
              </div>
            </td>
            <td>
                  <code>25.0</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">charge_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gasteiger&quot;</span><span class="p">,</span>
    <span class="n">replace_nan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">electron_scaling</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">25.0</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for ElectroShape descriptor</span>

<span class="sd">    Args:</span>
<span class="sd">        charge_model: charge model to use. One of (&#39;gasteiger&#39;, &#39;tripos&#39;, &#39;mmff94&#39;, &#39;formal&#39;). Defaults to &quot;gasteiger&quot;.</span>
<span class="sd">            Note that formal charges will be computed on the fly if not provided in the input molecules.</span>
<span class="sd">            The `tripos` charge models comes from TRIPOS force field and are often parsed from mol2 files.</span>
<span class="sd">        replace_nan: whether to replace NaN values. Defaults False</span>
<span class="sd">        electron_scaling: scaling factor to convert electron charges to Angstroms. Defaults to 25.0.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">charge_model</span> <span class="o">=</span> <span class="n">charge_model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">replace_nan</span> <span class="o">=</span> <span class="n">replace_nan</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">electron_scaling</span> <span class="o">=</span> <span class="n">electron_scaling</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.shape.ElectroShapeDescriptors.__len__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__len__</span><span class="p">()</span></code>

<a href="#molfeat.calc.shape.ElectroShapeDescriptors.__len__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return the length of the calculator</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the length of the calculator&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.shape.ElectroShapeDescriptors.compute_charge" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_charge</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">charge_model</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#molfeat.calc.shape.ElectroShapeDescriptors.compute_charge" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the molecular charge of the molecule.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>charge_model</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>charge model to use. One of ('gasteiger', 'tripos', 'mmff94', 'formal'). Defaults to "gasteiger".</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">compute_charge</span><span class="p">(</span><span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">charge_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the molecular charge of the molecule.</span>

<span class="sd">    Args:</span>
<span class="sd">        charge_model: charge model to use. One of (&#39;gasteiger&#39;, &#39;tripos&#39;, &#39;mmff94&#39;, &#39;formal&#39;). Defaults to &quot;gasteiger&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">charge_model</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ElectroShapeDescriptors</span><span class="o">.</span><span class="n">SUPPORTED_CHARGE_MODELS</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unknown charge model </span><span class="si">{</span><span class="n">charge_model</span><span class="si">}</span><span class="s2">. You should provide one of </span><span class="si">{</span><span class="n">ElectroShapeDescriptors</span><span class="o">.</span><span class="n">SUPPORTED_CHARGE_MODELS</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">atom_charge</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">atom_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">())</span>

    <span class="c1"># force compute the partial charges if not provided</span>
    <span class="k">if</span> <span class="n">charge_model</span> <span class="o">==</span> <span class="s2">&quot;gasteiger&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">atom_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">HasProp</span><span class="p">(</span><span class="s2">&quot;_GasteigerCharge&quot;</span><span class="p">):</span>
        <span class="n">rdPartialCharges</span><span class="o">.</span><span class="n">ComputeGasteigerCharges</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">charge_model</span> <span class="o">==</span> <span class="s2">&quot;mmff94&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">atom_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">HasProp</span><span class="p">(</span><span class="s2">&quot;_MMFF94Charge&quot;</span><span class="p">):</span>
        <span class="n">ff_infos</span> <span class="o">=</span> <span class="n">rdForceFieldHelpers</span><span class="o">.</span><span class="n">MMFFGetMoleculeProperties</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">atom_list</span><span class="p">):</span>
            <span class="n">atom</span><span class="o">.</span><span class="n">SetDoubleProp</span><span class="p">(</span><span class="s2">&quot;_MMFF94Charge&quot;</span><span class="p">,</span> <span class="n">ff_infos</span><span class="o">.</span><span class="n">GetMMFFPartialCharge</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">charge_model</span> <span class="o">==</span> <span class="s2">&quot;formal&quot;</span><span class="p">:</span>
            <span class="n">atom_charge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">GetFormalCharge</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">charge_model</span> <span class="o">==</span> <span class="s2">&quot;gasteiger&quot;</span><span class="p">:</span>
            <span class="n">atom_charge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">GetDoubleProp</span><span class="p">(</span><span class="s2">&quot;_GasteigerCharge&quot;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">charge_model</span> <span class="o">==</span> <span class="s2">&quot;mmff94&quot;</span><span class="p">:</span>
            <span class="n">atom_charge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">GetDoubleProp</span><span class="p">(</span><span class="s2">&quot;_MMFF94Charge&quot;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">charge_model</span> <span class="o">==</span> <span class="s2">&quot;tripos&quot;</span><span class="p">:</span>
            <span class="n">atom_charge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">GetDoubleProp</span><span class="p">(</span><span class="s2">&quot;_TriposPartialCharge&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">atom_charge</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="molfeat.calc.shape.USRDescriptors" class="doc doc-heading">
            <code>USRDescriptors</code>


<a href="#molfeat.calc.shape.USRDescriptors" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="molfeat.calc.base.SerializableCalculator" href="#molfeat.calc.base.SerializableCalculator">SerializableCalculator</a></code></p>


        <p>Descriptors for the shape of a molecule.</p>
<p>!!! note:
    The following shape descriptors are offered:
        * USR: UltraFast Shape Recognition
        * USRCAT: Ultrafast Shape Recognition with CREDO Atom Types</p>






              <details class="quote">
                <summary>Source code in <code>molfeat/calc/shape.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">USRDescriptors</span><span class="p">(</span><span class="n">SerializableCalculator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Descriptors for the shape of a molecule.</span>

<span class="sd">    !!! note:</span>
<span class="sd">        The following shape descriptors are offered:</span>
<span class="sd">            * USR: UltraFast Shape Recognition</span>
<span class="sd">            * USRCAT: Ultrafast Shape Recognition with CREDO Atom Types</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;USR&quot;</span><span class="p">,</span> <span class="n">replace_nan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for ShapeDescriptors</span>

<span class="sd">        Args:</span>
<span class="sd">            method: Shape descriptor method to use. One of &#39;USR&#39;, &#39;USRCAT&#39;. Default to &#39;USR&#39;</span>
<span class="sd">            replace_nan: Whether to replace nan or infinite values. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;USR&quot;</span><span class="p">,</span> <span class="s2">&quot;USRCAT&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shape descriptor </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s2"> is not supported&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replace_nan</span> <span class="o">=</span> <span class="n">replace_nan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;replace_nan&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_nan</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;_columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the name of all the descriptors of this calculator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;USR&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;usr-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;USRCAT&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;usr-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">61</span><span class="p">)]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute descriptors length&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

    <span class="nd">@requires_conformer</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">conformer_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get rdkit 3D descriptors for a molecule</span>

<span class="sd">        Args:</span>
<span class="sd">            mol: the molecule of interest</span>
<span class="sd">            conformer_id: Optional conformer id. Defaults to -1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            shape_descriptors: list of computed molecular descriptors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;USR&quot;</span><span class="p">:</span>
            <span class="n">shape_descr</span> <span class="o">=</span> <span class="n">rdMolDescriptors</span><span class="o">.</span><span class="n">GetUSR</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">confId</span><span class="o">=</span><span class="n">conformer_id</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;USRCAT&quot;</span><span class="p">:</span>
            <span class="n">shape_descr</span> <span class="o">=</span> <span class="n">rdMolDescriptors</span><span class="o">.</span><span class="n">GetUSRCAT</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">confId</span><span class="o">=</span><span class="n">conformer_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_nan</span><span class="p">:</span>
            <span class="n">shape_descr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">shape_descr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_nan</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">shape_descr</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="molfeat.calc.shape.USRDescriptors.columns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">columns</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#molfeat.calc.shape.USRDescriptors.columns" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the name of all the descriptors of this calculator</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.shape.USRDescriptors.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">conformer_id</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#molfeat.calc.shape.USRDescriptors.__call__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get rdkit 3D descriptors for a molecule</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mol</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="datamol.Mol">Mol</span>, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the molecule of interest</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conformer_id</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional conformer id. Defaults to -1.</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>shape_descriptors</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of computed molecular descriptors</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@requires_conformer</span>
<span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">conformer_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get rdkit 3D descriptors for a molecule</span>

<span class="sd">    Args:</span>
<span class="sd">        mol: the molecule of interest</span>
<span class="sd">        conformer_id: Optional conformer id. Defaults to -1.</span>

<span class="sd">    Returns:</span>
<span class="sd">        shape_descriptors: list of computed molecular descriptors</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;USR&quot;</span><span class="p">:</span>
        <span class="n">shape_descr</span> <span class="o">=</span> <span class="n">rdMolDescriptors</span><span class="o">.</span><span class="n">GetUSR</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">confId</span><span class="o">=</span><span class="n">conformer_id</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;USRCAT&quot;</span><span class="p">:</span>
        <span class="n">shape_descr</span> <span class="o">=</span> <span class="n">rdMolDescriptors</span><span class="o">.</span><span class="n">GetUSRCAT</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">confId</span><span class="o">=</span><span class="n">conformer_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_nan</span><span class="p">:</span>
        <span class="n">shape_descr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">shape_descr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_nan</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">shape_descr</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.shape.USRDescriptors.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;USR&#39;</span><span class="p">,</span> <span class="n">replace_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#molfeat.calc.shape.USRDescriptors.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Constructor for ShapeDescriptors</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape descriptor method to use. One of 'USR', 'USRCAT'. Default to 'USR'</p>
              </div>
            </td>
            <td>
                  <code>&#39;USR&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>replace_nan</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to replace nan or infinite values. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;USR&quot;</span><span class="p">,</span> <span class="n">replace_nan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for ShapeDescriptors</span>

<span class="sd">    Args:</span>
<span class="sd">        method: Shape descriptor method to use. One of &#39;USR&#39;, &#39;USRCAT&#39;. Default to &#39;USR&#39;</span>
<span class="sd">        replace_nan: Whether to replace nan or infinite values. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;USR&quot;</span><span class="p">,</span> <span class="s2">&quot;USRCAT&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shape descriptor </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s2"> is not supported&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">replace_nan</span> <span class="o">=</span> <span class="n">replace_nan</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.shape.USRDescriptors.__len__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__len__</span><span class="p">()</span></code>

<a href="#molfeat.calc.shape.USRDescriptors.__len__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute descriptors length</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute descriptors length&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="molfeat.calc.shape.usrdistance" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">usrdistance</span><span class="p">(</span><span class="n">shape_1</span><span class="p">,</span> <span class="n">shape_2</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#molfeat.calc.shape.usrdistance" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Computes similarity between molecules</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>shape_1</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>USR shape descriptor of first molecule</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shape_2</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>USR shape descriptor</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weights</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[float]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of scaling factor to use for</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dist</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Distance [0-1] between shapes of molecules, 0 indicates identical molecules</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">usrdistance</span><span class="p">(</span>
    <span class="n">shape_1</span><span class="p">,</span>
    <span class="n">shape_2</span><span class="p">,</span>
    <span class="n">weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes similarity between molecules</span>

<span class="sd">    Args:</span>
<span class="sd">        shape_1: USR shape descriptor of first molecule</span>
<span class="sd">        shape_2: USR shape descriptor</span>
<span class="sd">        weights: List of scaling factor to use for</span>

<span class="sd">    Returns:</span>
<span class="sd">        dist: Distance [0-1] between shapes of molecules, 0 indicates identical molecules</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># case for usr shape descriptors</span>
    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">shape_1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">shape_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">12</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span><span class="n">shape_1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">shape_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">60</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span><span class="n">shape_1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">shape_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">rdMolDescriptors</span><span class="o">.</span><span class="n">GetUSRScore</span><span class="p">(</span><span class="n">shape_1</span><span class="p">,</span> <span class="n">shape_2</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dist</span>

    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
        <span class="s2">&quot;Given vectors are not valid USR shape descriptors &quot;</span>
        <span class="s2">&quot;or come from different methods. Correct vector lengths&quot;</span>
        <span class="s2">&quot;are: 12 for USR, 60 for USRCAT, 15 for Electroshape&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />
<h3 id="atoms-featurizer"><code>Atoms Featurizer</code><a class="headerlink" href="#atoms-featurizer" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="molfeat.calc.atom"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="molfeat.calc.atom.AtomCalculator" class="doc doc-heading">
            <code>AtomCalculator</code>


<a href="#molfeat.calc.atom.AtomCalculator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="molfeat.calc.base.SerializableCalculator" href="#molfeat.calc.base.SerializableCalculator">SerializableCalculator</a></code></p>


        <p>Base class for computing atom properties compatible with DGLLife</p>






              <details class="quote">
                <summary>Source code in <code>molfeat/calc/atom.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AtomCalculator</span><span class="p">(</span><span class="n">SerializableCalculator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for computing atom properties compatible with DGLLife</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DEFAULT_FEATURIZER</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;atom_one_hot&quot;</span><span class="p">:</span> <span class="n">atom_one_hot</span><span class="p">,</span>
        <span class="s2">&quot;atom_degree_one_hot&quot;</span><span class="p">:</span> <span class="n">atom_degree_one_hot</span><span class="p">,</span>
        <span class="s2">&quot;atom_implicit_valence_one_hot&quot;</span><span class="p">:</span> <span class="n">atom_implicit_valence_one_hot</span><span class="p">,</span>
        <span class="s2">&quot;atom_hybridization_one_hot&quot;</span><span class="p">:</span> <span class="n">atom_hybridization_one_hot</span><span class="p">,</span>
        <span class="s2">&quot;atom_is_aromatic&quot;</span><span class="p">:</span> <span class="n">atom_is_aromatic</span><span class="p">,</span>
        <span class="s2">&quot;atom_formal_charge&quot;</span><span class="p">:</span> <span class="n">atom_formal_charge</span><span class="p">,</span>
        <span class="s2">&quot;atom_num_radical_electrons&quot;</span><span class="p">:</span> <span class="n">atom_num_radical_electrons</span><span class="p">,</span>
        <span class="s2">&quot;atom_is_in_ring&quot;</span><span class="p">:</span> <span class="n">atom_is_in_ring</span><span class="p">,</span>
        <span class="s2">&quot;atom_total_num_H_one_hot&quot;</span><span class="p">:</span> <span class="n">atom_total_num_H_one_hot</span><span class="p">,</span>
        <span class="s2">&quot;atom_chiral_tag_one_hot&quot;</span><span class="p">:</span> <span class="n">atom_chiral_tag_one_hot</span><span class="p">,</span>
        <span class="s2">&quot;atom_is_chiral_center&quot;</span><span class="p">:</span> <span class="n">atom_is_chiral_center</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">featurizer_funcs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">concat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hv&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Init function of the atom property calculator</span>

<span class="sd">        Args:</span>
<span class="sd">            featurizer_funcs : Mapping of feature name to the featurization function.</span>
<span class="sd">                For compatibility a list of callable/function is still accepted, and the corresponding</span>
<span class="sd">                featurizer name will be automatically generated. Each function is of signature</span>
<span class="sd">                ``func(dm.Atom) -&gt; list or 1D numpy array``.</span>
<span class="sd">            concat: Whether to concat all the data into a single value in the output dict</span>
<span class="sd">            name: Name of the key name of the concatenated features</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_kwargs</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">)</span>
        <span class="c1"># we also remove the featurizer funcs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;featurizer_funcs&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toy_mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="s2">&quot;CCO&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">featurizer_funcs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">featurizer_funcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_FEATURIZER</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">featurizer_funcs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">get_name</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="n">featurizer_funcs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">get_name</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">featurizer_funcs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span> <span class="o">=</span> <span class="n">featurizer_funcs</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feat_size</span><span class="p">(</span><span class="n">feat_name</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">concat</span> <span class="o">=</span> <span class="n">concat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">to_state_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the Atom calculator to a state dict</span>
<span class="sd">        Due to some constraints and cross-version compatibility,  the featurizer functions</span>
<span class="sd">        need to be pickled and not just return a list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;module&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_kwargs</span>
        <span class="n">featurizer_fn_pickled</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">ffunc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">featurizer_fn_pickled</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_to_hex</span><span class="p">(</span><span class="n">ffunc</span><span class="p">)</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="s2">&quot;featurizer_funcs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">featurizer_fn_pickled</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;_molfeat_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MOLFEAT_VERSION</span>

        <span class="n">signature</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">default</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">signature</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="c1"># if v.default is not inspect.Parameter.empty</span>
        <span class="p">}</span>
        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
            <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">state_dict</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_state_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">state_dict</span><span class="p">,</span> <span class="n">override_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an instance of an atom calculator from a state dict</span>

<span class="sd">        Args:</span>
<span class="sd">            state_dict: state dictionary to use to create the atom calculator</span>
<span class="sd">            override_args: optional dictionary of arguments to override the ones in the state dict</span>
<span class="sd">                at construction of the new object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># EN: at this moment, version compatibility is not enforced</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="n">state_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">module_name</span> <span class="o">=</span> <span class="n">state_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;module&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
        <span class="n">klass</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># now we need to unpickle the featurizer functions</span>
        <span class="n">featurizer_fn_pickled</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;featurizer_funcs&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">featurizer_fn_pickled</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">featurizer_fn_loaded</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">featurizer_fn_pickled</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">featurizer_fn_loaded</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">hex_to_fn</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;featurizer_funcs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">featurizer_fn_loaded</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="p">(</span><span class="n">override_args</span> <span class="ow">or</span> <span class="p">{}))</span>
        <span class="k">return</span> <span class="n">klass</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_concat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Concatenate the data into a single value</span>

<span class="sd">        Args:</span>
<span class="sd">            data_dict: mapping of feature names to tensor/arrays</span>
<span class="sd">        Returns:</span>
<span class="sd">            concatenated_dict: a dict with a single key where all array have been concatenated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">concat_dict</span><span class="p">(</span><span class="n">data_dict</span><span class="p">,</span> <span class="n">new_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">feat_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feat_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the feature size for ``feat_name``.</span>

<span class="sd">        When there is only one feature, users do not need to provide ``feat_name``.</span>

<span class="sd">        Args:</span>
<span class="sd">            feat_name: Feature for query.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: Feature size for the feature with name ``feat_name``. Default to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">feat_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="p">),</span> <span class="s2">&quot;feat_name should be provided if there are more than one features&quot;</span>
            <span class="n">feat_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">feat_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Expect feat_name to be in </span><span class="si">{}</span><span class="s2">, got </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">feat_name</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">feat_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">:</span>
            <span class="n">atom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toy_mol</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="p">[</span><span class="n">feat_name</span><span class="p">](</span><span class="n">atom</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get length of the property estimator&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get rdkit basic descriptors for a molecule</span>

<span class="sd">        Args:</span>
<span class="sd">            mol: the molecule of interest</span>
<span class="sd">            dtype: requested data type</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict:  For each function in self.featurizer_funcs with the key ``k``, store the computed feature under the key ``k``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="n">num_atoms</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">()</span>
        <span class="n">atom_features</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="c1"># Compute features for each atom</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_atoms</span><span class="p">):</span>
            <span class="n">atom</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">feat_name</span><span class="p">,</span> <span class="n">feat_func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">atom_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feat_func</span><span class="p">(</span><span class="n">atom</span><span class="p">))</span>

        <span class="c1"># Stack the features and convert them to float arrays</span>
        <span class="n">processed_features</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">feat_name</span><span class="p">,</span> <span class="n">feat_list</span> <span class="ow">in</span> <span class="n">atom_features</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">feat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">feat_list</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
            <span class="n">processed_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">feat</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat</span><span class="p">:</span>
            <span class="n">processed_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_concat</span><span class="p">(</span><span class="n">processed_features</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">feat_name</span><span class="p">,</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">processed_features</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">feat</span> <span class="o">=</span> <span class="n">datatype</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
                <span class="n">processed_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">feat</span>

        <span class="k">return</span> <span class="n">processed_features</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.atom.AtomCalculator.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#molfeat.calc.atom.AtomCalculator.__call__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get rdkit basic descriptors for a molecule</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mol</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="datamol.Mol">Mol</span>, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the molecule of interest</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>requested data type</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For each function in self.featurizer_funcs with the key <code>k</code>, store the computed feature under the key <code>k</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/atom.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get rdkit basic descriptors for a molecule</span>

<span class="sd">    Args:</span>
<span class="sd">        mol: the molecule of interest</span>
<span class="sd">        dtype: requested data type</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict:  For each function in self.featurizer_funcs with the key ``k``, store the computed feature under the key ``k``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">num_atoms</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">()</span>
    <span class="n">atom_features</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># Compute features for each atom</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_atoms</span><span class="p">):</span>
        <span class="n">atom</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">feat_name</span><span class="p">,</span> <span class="n">feat_func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">atom_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feat_func</span><span class="p">(</span><span class="n">atom</span><span class="p">))</span>

    <span class="c1"># Stack the features and convert them to float arrays</span>
    <span class="n">processed_features</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">feat_name</span><span class="p">,</span> <span class="n">feat_list</span> <span class="ow">in</span> <span class="n">atom_features</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">feat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">feat_list</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">processed_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">feat</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat</span><span class="p">:</span>
        <span class="n">processed_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_concat</span><span class="p">(</span><span class="n">processed_features</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">feat_name</span><span class="p">,</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">processed_features</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">feat</span> <span class="o">=</span> <span class="n">datatype</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">processed_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">feat</span>

    <span class="k">return</span> <span class="n">processed_features</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.atom.AtomCalculator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">featurizer_funcs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">concat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;hv&#39;</span><span class="p">)</span></code>

<a href="#molfeat.calc.atom.AtomCalculator.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Init function of the atom property calculator</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>featurizer_funcs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mapping of feature name to the featurization function.
For compatibility a list of callable/function is still accepted, and the corresponding
featurizer name will be automatically generated. Each function is of signature
<code>func(dm.Atom) -&gt; list or 1D numpy array</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>concat</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to concat all the data into a single value in the output dict</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the key name of the concatenated features</p>
              </div>
            </td>
            <td>
                  <code>&#39;hv&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/atom.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">featurizer_funcs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">concat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hv&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Init function of the atom property calculator</span>

<span class="sd">    Args:</span>
<span class="sd">        featurizer_funcs : Mapping of feature name to the featurization function.</span>
<span class="sd">            For compatibility a list of callable/function is still accepted, and the corresponding</span>
<span class="sd">            featurizer name will be automatically generated. Each function is of signature</span>
<span class="sd">            ``func(dm.Atom) -&gt; list or 1D numpy array``.</span>
<span class="sd">        concat: Whether to concat all the data into a single value in the output dict</span>
<span class="sd">        name: Name of the key name of the concatenated features</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_input_kwargs</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_input_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">)</span>
    <span class="c1"># we also remove the featurizer funcs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_input_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;featurizer_funcs&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_toy_mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="s2">&quot;CCO&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">featurizer_funcs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">featurizer_funcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_FEATURIZER</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">featurizer_funcs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">get_name</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">featurizer_funcs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">get_name</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">featurizer_funcs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span> <span class="o">=</span> <span class="n">featurizer_funcs</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feat_size</span><span class="p">(</span><span class="n">feat_name</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">concat</span> <span class="o">=</span> <span class="n">concat</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.atom.AtomCalculator.__len__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__len__</span><span class="p">()</span></code>

<a href="#molfeat.calc.atom.AtomCalculator.__len__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get length of the property estimator</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/atom.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get length of the property estimator&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.atom.AtomCalculator.feat_size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">feat_size</span><span class="p">(</span><span class="n">feat_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#molfeat.calc.atom.AtomCalculator.feat_size" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the feature size for <code>feat_name</code>.</p>
<p>When there is only one feature, users do not need to provide <code>feat_name</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>feat_name</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Feature for query.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Feature size for the feature with name <code>feat_name</code>. Default to None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/atom.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">feat_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feat_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the feature size for ``feat_name``.</span>

<span class="sd">    When there is only one feature, users do not need to provide ``feat_name``.</span>

<span class="sd">    Args:</span>
<span class="sd">        feat_name: Feature for query.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Feature size for the feature with name ``feat_name``. Default to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">feat_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="p">),</span> <span class="s2">&quot;feat_name should be provided if there are more than one features&quot;</span>
        <span class="n">feat_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">feat_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Expect feat_name to be in </span><span class="si">{}</span><span class="s2">, got </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">feat_name</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">feat_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">:</span>
        <span class="n">atom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toy_mol</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="p">[</span><span class="n">feat_name</span><span class="p">](</span><span class="n">atom</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.atom.AtomCalculator.from_state_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_state_dict</span><span class="p">(</span><span class="n">state_dict</span><span class="p">,</span> <span class="n">override_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#molfeat.calc.atom.AtomCalculator.from_state_dict" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create an instance of an atom calculator from a state dict</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state_dict</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>state dictionary to use to create the atom calculator</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>override_args</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>optional dictionary of arguments to override the ones in the state dict
at construction of the new object</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/atom.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_state_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">state_dict</span><span class="p">,</span> <span class="n">override_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create an instance of an atom calculator from a state dict</span>

<span class="sd">    Args:</span>
<span class="sd">        state_dict: state dictionary to use to create the atom calculator</span>
<span class="sd">        override_args: optional dictionary of arguments to override the ones in the state dict</span>
<span class="sd">            at construction of the new object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># EN: at this moment, version compatibility is not enforced</span>
    <span class="n">cls_name</span> <span class="o">=</span> <span class="n">state_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">module_name</span> <span class="o">=</span> <span class="n">state_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;module&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
    <span class="n">klass</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># now we need to unpickle the featurizer functions</span>
    <span class="n">featurizer_fn_pickled</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;featurizer_funcs&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">featurizer_fn_pickled</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">featurizer_fn_loaded</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">featurizer_fn_pickled</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">featurizer_fn_loaded</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">hex_to_fn</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;featurizer_funcs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">featurizer_fn_loaded</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="p">(</span><span class="n">override_args</span> <span class="ow">or</span> <span class="p">{}))</span>
    <span class="k">return</span> <span class="n">klass</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.atom.AtomCalculator.to_state_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_state_dict</span><span class="p">()</span></code>

<a href="#molfeat.calc.atom.AtomCalculator.to_state_dict" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Convert the Atom calculator to a state dict
Due to some constraints and cross-version compatibility,  the featurizer functions
need to be pickled and not just return a list</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/atom.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_state_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert the Atom calculator to a state dict</span>
<span class="sd">    Due to some constraints and cross-version compatibility,  the featurizer functions</span>
<span class="sd">    need to be pickled and not just return a list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">state_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;module&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span>
    <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_kwargs</span>
    <span class="n">featurizer_fn_pickled</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">ffunc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">featurizer_fn_pickled</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_to_hex</span><span class="p">(</span><span class="n">ffunc</span><span class="p">)</span>
    <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="s2">&quot;featurizer_funcs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">featurizer_fn_pickled</span>
    <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;_molfeat_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MOLFEAT_VERSION</span>

    <span class="n">signature</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
    <span class="n">val</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">default</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">signature</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="c1"># if v.default is not inspect.Parameter.empty</span>
    <span class="p">}</span>
    <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">state_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="molfeat.calc.atom.AtomMaterialCalculator" class="doc doc-heading">
            <code>AtomMaterialCalculator</code>


<a href="#molfeat.calc.atom.AtomMaterialCalculator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="molfeat.calc.atom.AtomCalculator" href="#molfeat.calc.atom.AtomCalculator">AtomCalculator</a></code></p>


        <p>Atom calculator with the extend atomic property list
which have been collected from various material science packages</p>






              <details class="quote">
                <summary>Source code in <code>molfeat/calc/atom.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AtomMaterialCalculator</span><span class="p">(</span><span class="n">AtomCalculator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Atom calculator with the extend atomic property list</span>
<span class="sd">    which have been collected from various material science packages</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DEFAULT_FEATURIZER</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;atom_one_hot&quot;</span><span class="p">:</span> <span class="n">atom_one_hot</span><span class="p">,</span>
        <span class="s2">&quot;atom_extended_properties&quot;</span><span class="p">:</span> <span class="n">atom_extended_properties</span><span class="p">,</span>
        <span class="s2">&quot;atom_degree_one_hot&quot;</span><span class="p">:</span> <span class="n">atom_degree_one_hot</span><span class="p">,</span>
        <span class="s2">&quot;atom_implicit_valence_one_hot&quot;</span><span class="p">:</span> <span class="n">atom_implicit_valence_one_hot</span><span class="p">,</span>
        <span class="s2">&quot;atom_hybridization_one_hot&quot;</span><span class="p">:</span> <span class="n">atom_hybridization_one_hot</span><span class="p">,</span>
        <span class="s2">&quot;atom_is_aromatic&quot;</span><span class="p">:</span> <span class="n">atom_is_aromatic</span><span class="p">,</span>
        <span class="s2">&quot;atom_formal_charge&quot;</span><span class="p">:</span> <span class="n">atom_formal_charge</span><span class="p">,</span>
        <span class="s2">&quot;atom_num_radical_electrons&quot;</span><span class="p">:</span> <span class="n">atom_num_radical_electrons</span><span class="p">,</span>
        <span class="s2">&quot;atom_is_in_ring&quot;</span><span class="p">:</span> <span class="n">atom_is_in_ring</span><span class="p">,</span>
        <span class="s2">&quot;atom_chiral_tag_one_hot&quot;</span><span class="p">:</span> <span class="n">atom_chiral_tag_one_hot</span><span class="p">,</span>
        <span class="s2">&quot;atom_is_chiral_center&quot;</span><span class="p">:</span> <span class="n">atom_is_chiral_center</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="molfeat.calc.atom.DGLCanonicalAtomCalculator" class="doc doc-heading">
            <code>DGLCanonicalAtomCalculator</code>


<a href="#molfeat.calc.atom.DGLCanonicalAtomCalculator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="molfeat.calc.atom.AtomCalculator" href="#molfeat.calc.atom.AtomCalculator">AtomCalculator</a></code></p>


        <p>Default canonical featurizer for atoms used by dgllife</p>






              <details class="quote">
                <summary>Source code in <code>molfeat/calc/atom.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DGLCanonicalAtomCalculator</span><span class="p">(</span><span class="n">AtomCalculator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Default canonical featurizer for atoms used by dgllife&quot;&quot;&quot;</span>

    <span class="n">DEFAULT_FEATURIZER</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;atom_one_hot&quot;</span><span class="p">:</span> <span class="n">atom_one_hot</span><span class="p">,</span>
        <span class="s2">&quot;atom_degree_one_hot&quot;</span><span class="p">:</span> <span class="n">atom_degree_one_hot</span><span class="p">,</span>
        <span class="s2">&quot;atom_implicit_valence_one_hot&quot;</span><span class="p">:</span> <span class="n">atom_implicit_valence_one_hot</span><span class="p">,</span>
        <span class="s2">&quot;atom_formal_charge&quot;</span><span class="p">:</span> <span class="n">atom_formal_charge</span><span class="p">,</span>
        <span class="s2">&quot;atom_num_radical_electrons&quot;</span><span class="p">:</span> <span class="n">atom_num_radical_electrons</span><span class="p">,</span>
        <span class="s2">&quot;atom_hybridization_one_hot&quot;</span><span class="p">:</span> <span class="n">partial</span><span class="p">(</span>
            <span class="n">atom_hybridization_one_hot</span><span class="p">,</span> <span class="n">allowable_set</span><span class="o">=</span><span class="n">DGLLIFE_HYBRIDIZATION_LIST</span>
        <span class="p">),</span>
        <span class="s2">&quot;atom_is_aromatic&quot;</span><span class="p">:</span> <span class="n">atom_is_aromatic</span><span class="p">,</span>
        <span class="s2">&quot;atom_total_num_H_one_hot&quot;</span><span class="p">:</span> <span class="n">atom_total_num_H_one_hot</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_concat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Concatenate the data into a single value</span>

<span class="sd">        Args:</span>
<span class="sd">            data_dict: mapping of feature names to tensor/arrays</span>
<span class="sd">        Returns:</span>
<span class="sd">            concatenated_dict: a dict with a single key where all array have been concatenated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">concat_dict</span><span class="p">(</span><span class="n">data_dict</span><span class="p">,</span> <span class="n">new_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="molfeat.calc.atom.DGLWeaveAtomCalculator" class="doc doc-heading">
            <code>DGLWeaveAtomCalculator</code>


<a href="#molfeat.calc.atom.DGLWeaveAtomCalculator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="molfeat.calc.atom.DGLCanonicalAtomCalculator" href="#molfeat.calc.atom.DGLCanonicalAtomCalculator">DGLCanonicalAtomCalculator</a></code></p>


        <p>Default atom featurizer used by WeaveNet in DGLLife</p>






              <details class="quote">
                <summary>Source code in <code>molfeat/calc/atom.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DGLWeaveAtomCalculator</span><span class="p">(</span><span class="n">DGLCanonicalAtomCalculator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Default atom featurizer used by WeaveNet in DGLLife&quot;&quot;&quot;</span>

    <span class="n">DEFAULT_FEATURIZER</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;atom_one_hot&quot;</span><span class="p">:</span> <span class="n">partial</span><span class="p">(</span>
            <span class="n">atom_one_hot</span><span class="p">,</span> <span class="n">allowable_set</span><span class="o">=</span><span class="n">DGLLIFE_WEAVE_ATOMS</span><span class="p">,</span> <span class="n">encode_unknown</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">),</span>
        <span class="s2">&quot;atom_chiral_tag_one_hot&quot;</span><span class="p">:</span> <span class="n">partial</span><span class="p">(</span>
            <span class="n">atom_chiral_tag_one_hot</span><span class="p">,</span> <span class="n">allowable_set</span><span class="o">=</span><span class="n">DGLLIFE_WEAVE_CHIRAL_TYPES</span>
        <span class="p">),</span>
        <span class="s2">&quot;atom_formal_charge&quot;</span><span class="p">:</span> <span class="n">atom_formal_charge</span><span class="p">,</span>
        <span class="s2">&quot;atom_partial_charge&quot;</span><span class="p">:</span> <span class="n">atom_partial_charge</span><span class="p">,</span>
        <span class="s2">&quot;atom_is_aromatic&quot;</span><span class="p">:</span> <span class="n">atom_is_aromatic</span><span class="p">,</span>
        <span class="s2">&quot;atom_hybridization_one_hot&quot;</span><span class="p">:</span> <span class="n">partial</span><span class="p">(</span>
            <span class="n">atom_hybridization_one_hot</span><span class="p">,</span> <span class="n">allowable_set</span><span class="o">=</span><span class="n">DGLLIFE_HYBRIDIZATION_LIST</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="p">),</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">concat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hv&quot;</span><span class="p">):</span>
        <span class="n">featurizer_funcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_FEATURIZER</span>
        <span class="n">featurizer_funcs</span><span class="p">[</span><span class="s2">&quot;atom_weavenet_props&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_weave_props</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">concat</span><span class="o">=</span><span class="n">concat</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">featurizer_funcs</span><span class="o">=</span><span class="n">featurizer_funcs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_atom_state_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feats</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get atom Donor/Acceptor state information from chemical pharmacophore features</span>

<span class="sd">        Args:</span>
<span class="sd">            feats: computed chemical features</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_donor</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">is_acceptor</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="c1"># Get hydrogen bond donor/acceptor information</span>
        <span class="k">for</span> <span class="n">feats</span> <span class="ow">in</span> <span class="n">feats</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">feats</span><span class="o">.</span><span class="n">GetFamily</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Donor&quot;</span><span class="p">:</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="n">feats</span><span class="o">.</span><span class="n">GetAtomIds</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                    <span class="n">is_donor</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">feats</span><span class="o">.</span><span class="n">GetFamily</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Acceptor&quot;</span><span class="p">:</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="n">feats</span><span class="o">.</span><span class="n">GetAtomIds</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                    <span class="n">is_acceptor</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">is_donor</span><span class="p">,</span> <span class="n">is_acceptor</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_feat_factory_cache</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build and cache chemical features caching for speed&quot;&quot;&quot;</span>
        <span class="n">fdef_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">RDConfig</span><span class="o">.</span><span class="n">RDDataDir</span><span class="p">,</span> <span class="s2">&quot;BaseFeatures.fdef&quot;</span><span class="p">)</span>
        <span class="n">chem_feats</span> <span class="o">=</span> <span class="n">ChemicalFeatures</span><span class="o">.</span><span class="n">BuildFeatureFactory</span><span class="p">(</span><span class="n">fdef_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">chem_feats</span>

    <span class="nd">@lru_cache</span>
    <span class="k">def</span> <span class="nf">_compute_weave_net_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
        <span class="c1"># Get information for donor and acceptor</span>
        <span class="n">chem_feats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feat_factory_cache</span><span class="p">()</span>
        <span class="n">mol_feats</span> <span class="o">=</span> <span class="n">chem_feats</span><span class="o">.</span><span class="n">GetFeaturesForMol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="n">is_donor</span><span class="p">,</span> <span class="n">is_acceptor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_atom_state_info</span><span class="p">(</span><span class="n">mol_feats</span><span class="p">)</span>
        <span class="n">sssr</span> <span class="o">=</span> <span class="n">GetSymmSSSR</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="n">num_atoms</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">()</span>
        <span class="n">atom_features</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_atoms</span><span class="p">):</span>
            <span class="n">cur_atom_props</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">is_donor</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">is_acceptor</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span>
            <span class="c1"># Count the number of rings the atom belongs to for ring size between 3 and 8</span>
            <span class="n">count</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">sssr</span><span class="p">:</span>
                <span class="n">ring_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ring</span> <span class="ow">and</span> <span class="mi">3</span> <span class="o">&lt;=</span> <span class="n">ring_size</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="n">count</span><span class="p">[</span><span class="n">ring_size</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">cur_atom_props</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
            <span class="n">atom_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_atom_props</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">atom_features</span>

    <span class="k">def</span> <span class="nf">atom_weave_props</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Atom</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the WeaveNet properties for an atom&quot;&quot;&quot;</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">GetOwningMol</span><span class="p">()</span>
        <span class="n">feats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_weave_net_properties</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">feats</span><span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">GetIdx</span><span class="p">()]</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get rdkit basic descriptors for a molecule</span>

<span class="sd">        Args:</span>
<span class="sd">            mol: the molecule of interest</span>
<span class="sd">            dtype: requested data type</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict:  For each function in self.featurizer_funcs with the key ``k``, store the computed feature under the key ``k``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">AllChem</span><span class="o">.</span><span class="n">ComputeGasteigerCharges</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span>
            <span class="n">mol</span><span class="p">,</span>
            <span class="n">dtype</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.atom.DGLWeaveAtomCalculator.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#molfeat.calc.atom.DGLWeaveAtomCalculator.__call__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get rdkit basic descriptors for a molecule</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mol</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="datamol.Mol">Mol</span>, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the molecule of interest</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>requested data type</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For each function in self.featurizer_funcs with the key <code>k</code>, store the computed feature under the key <code>k</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/atom.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get rdkit basic descriptors for a molecule</span>

<span class="sd">    Args:</span>
<span class="sd">        mol: the molecule of interest</span>
<span class="sd">        dtype: requested data type</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict:  For each function in self.featurizer_funcs with the key ``k``, store the computed feature under the key ``k``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">AllChem</span><span class="o">.</span><span class="n">ComputeGasteigerCharges</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span>
        <span class="n">mol</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.atom.DGLWeaveAtomCalculator.atom_weave_props" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">atom_weave_props</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span></code>

<a href="#molfeat.calc.atom.DGLWeaveAtomCalculator.atom_weave_props" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the WeaveNet properties for an atom</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/atom.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">atom_weave_props</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom</span><span class="p">:</span> <span class="n">dm</span><span class="o">.</span><span class="n">Atom</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the WeaveNet properties for an atom&quot;&quot;&quot;</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">GetOwningMol</span><span class="p">()</span>
    <span class="n">feats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_weave_net_properties</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">feats</span><span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">GetIdx</span><span class="p">()]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><hr />
<h3 id="bonds-featurizer"><code>Bonds Featurizer</code><a class="headerlink" href="#bonds-featurizer" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="molfeat.calc.bond"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="molfeat.calc.bond.BondCalculator" class="doc doc-heading">
            <code>BondCalculator</code>


<a href="#molfeat.calc.bond.BondCalculator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="molfeat.calc.base.SerializableCalculator" href="#molfeat.calc.base.SerializableCalculator">SerializableCalculator</a></code></p>


        <p>A class for bond featurizer which loops over all bonds in a molecule and
featurizes them with the <code>featurizer_funcs</code>. The constructed graph is assumed to be
a bi-directed graph by default.</p>






              <details class="quote">
                <summary>Source code in <code>molfeat/calc/bond.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BondCalculator</span><span class="p">(</span><span class="n">SerializableCalculator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class for bond featurizer which loops over all bonds in a molecule and</span>
<span class="sd">    featurizes them with the ``featurizer_funcs``. The constructed graph is assumed to be</span>
<span class="sd">    a bi-directed graph by default.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DEFAULT_FEATURIZER</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;bond_type_one_hot&quot;</span><span class="p">:</span> <span class="n">bond_type_one_hot</span><span class="p">,</span>
        <span class="s2">&quot;bond_stereo_one_hot&quot;</span><span class="p">:</span> <span class="n">bond_stereo_one_hot</span><span class="p">,</span>
        <span class="s2">&quot;bond_is_in_ring&quot;</span><span class="p">:</span> <span class="n">bond_is_in_ring</span><span class="p">,</span>
        <span class="s2">&quot;bond_is_conjugated&quot;</span><span class="p">:</span> <span class="n">bond_is_conjugated</span><span class="p">,</span>
        <span class="s2">&quot;bond_direction_one_hot&quot;</span><span class="p">:</span> <span class="n">bond_direction_one_hot</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">featurizer_funcs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">self_loop</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">concat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;he&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Init function of the bond property calculator</span>

<span class="sd">        Args:</span>
<span class="sd">            featurizer_funcs: Mapping feature name to the featurization function.</span>
<span class="sd">            self_loop: Whether self loops will be added. Default to False. If True, an additional</span>
<span class="sd">                column of binary values to indicate the identity of self loops will be added.</span>
<span class="sd">                The other features of the self loops will be zero.</span>
<span class="sd">            concat: Whether to concat all the data into a single value in the output dict</span>
<span class="sd">            name: Name of the key name of the concatenated features</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_kwargs</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">)</span>
        <span class="c1"># remove featurizer_funcs too</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;featurizer_funcs&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toy_mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="s2">&quot;CO&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">featurizer_funcs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">featurizer_funcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_FEATURIZER</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">featurizer_funcs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">get_name</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="n">featurizer_funcs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">get_name</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">featurizer_funcs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span> <span class="o">=</span> <span class="n">featurizer_funcs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_self_loop</span> <span class="o">=</span> <span class="n">self_loop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">concat</span> <span class="o">=</span> <span class="n">concat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feat_size</span><span class="p">(</span><span class="n">feat_name</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_self_loop</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">[</span><span class="s2">&quot;self_loop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">to_state_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the Atom calculator to a state dict</span>
<span class="sd">        Due to some constraints and cross-version compatibility,  the featurizer functions</span>
<span class="sd">        need to be pickled and not just list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;module&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_kwargs</span>

        <span class="n">featurizer_fn_pickled</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">ffunc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">featurizer_fn_pickled</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_to_hex</span><span class="p">(</span><span class="n">ffunc</span><span class="p">)</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="s2">&quot;featurizer_funcs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">featurizer_fn_pickled</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;_molfeat_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MOLFEAT_VERSION</span>
        <span class="n">signature</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">default</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">signature</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="c1">#    if v.default is not inspect.Parameter.empty</span>
        <span class="p">}</span>
        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
            <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state_dict</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_state_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">state_dict</span><span class="p">,</span> <span class="n">override_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an instance of an atom calculator from a state dict</span>

<span class="sd">        Args:</span>
<span class="sd">            state_dict: state dictionary to use to create the atom calculator</span>
<span class="sd">            override_args: optional dictionary of arguments to override the ones in the state dict</span>
<span class="sd">                at construction of the new object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># EN: at this moment, version compatibility is not enforced</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="n">state_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">module_name</span> <span class="o">=</span> <span class="n">state_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;module&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
        <span class="n">klass</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># now we need to unpickle the featurizer functions</span>
        <span class="n">featurizer_fn_pickled</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;featurizer_funcs&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">featurizer_fn_pickled</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">featurizer_fn_loaded</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">featurizer_fn_pickled</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">featurizer_fn_loaded</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">hex_to_fn</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;featurizer_funcs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">featurizer_fn_loaded</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="p">(</span><span class="n">override_args</span> <span class="ow">or</span> <span class="p">{}))</span>
        <span class="k">return</span> <span class="n">klass</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_concat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Concatenate the data into a single value</span>

<span class="sd">        Args:</span>
<span class="sd">            data_dict: mapping of feature names to tensor/arrays</span>
<span class="sd">        Returns:</span>
<span class="sd">            concatenated_dict: a dict with a single key where all array have been concatenated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">concat_dict</span><span class="p">(</span><span class="n">data_dict</span><span class="p">,</span> <span class="n">new_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">feat_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feat_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the feature size for ``feat_name``.</span>

<span class="sd">        When there is only one feature, ``feat_name`` can be None.</span>

<span class="sd">        Args:</span>
<span class="sd">            feat_name: Feature for query.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: Feature size for the feature with name ``feat_name``. Default to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">feat_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="p">),</span> <span class="s2">&quot;feat_name should be provided if there are more than one features&quot;</span>
            <span class="n">feat_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">feat_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Expect feat_name to be in </span><span class="si">{}</span><span class="s2">, got </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">feat_name</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">feat_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">:</span>
            <span class="n">bond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toy_mol</span><span class="o">.</span><span class="n">GetBondWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="p">[</span><span class="n">feat_name</span><span class="p">](</span><span class="n">bond</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get length of the property estimator&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Featurize all bonds in a molecule.</span>

<span class="sd">        Args:</span>
<span class="sd">            mol: the molecule of interest</span>
<span class="sd">            dtype: requested data type</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: For each function in self.featurizer_funcs with the key ``k``,</span>
<span class="sd">                store the computed feature under the key ``k``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="n">num_bonds</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumBonds</span><span class="p">()</span>
        <span class="n">bond_features</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="c1"># Compute features for each bond</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bonds</span><span class="p">):</span>
            <span class="n">bond</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetBondWithIdx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">feat_name</span><span class="p">,</span> <span class="n">feat_func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">feat</span> <span class="o">=</span> <span class="n">feat_func</span><span class="p">(</span><span class="n">bond</span><span class="p">)</span>
                <span class="n">bond_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">feat</span><span class="p">,</span> <span class="n">feat</span><span class="o">.</span><span class="n">copy</span><span class="p">()])</span>

        <span class="c1"># Stack the features and convert them to float arrays</span>
        <span class="n">processed_features</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">feat_name</span><span class="p">,</span> <span class="n">feat_list</span> <span class="ow">in</span> <span class="n">bond_features</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">feat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">feat_list</span><span class="p">)</span>
            <span class="n">processed_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">feat</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_self_loop</span> <span class="ow">and</span> <span class="n">num_bonds</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">num_atoms</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">feat_name</span> <span class="ow">in</span> <span class="n">processed_features</span><span class="p">:</span>
                <span class="n">feats</span> <span class="o">=</span> <span class="n">processed_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span>
                <span class="c1"># add a new label that says the feat are not self loop</span>
                <span class="c1"># feats = np.concatenate([feats, np.zeros((feats.shape[0], 1))], axis=1)</span>
                <span class="c1"># add a label at the last position that says it&#39;s a selfloop</span>
                <span class="n">add_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_atoms</span><span class="p">,</span> <span class="n">feats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="c1"># self_loop_feats[:, -1] = 1</span>
                <span class="n">feats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">feats</span><span class="p">,</span> <span class="n">add_edges</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">processed_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">feats</span>
            <span class="n">self_loop_feats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_bonds</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_atoms</span><span class="p">,</span> <span class="mi">1</span><span class="p">))]</span>
            <span class="p">)</span>

            <span class="n">processed_features</span><span class="p">[</span><span class="s2">&quot;self_loop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">self_loop_feats</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_self_loop</span> <span class="ow">and</span> <span class="n">num_bonds</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">num_atoms</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">()</span>
            <span class="n">old_concat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">concat</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">processed_features</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_toy_mol</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">concat</span> <span class="o">=</span> <span class="n">old_concat</span>
            <span class="k">for</span> <span class="n">feat_name</span> <span class="ow">in</span> <span class="n">processed_features</span><span class="p">:</span>
                <span class="n">feats</span> <span class="o">=</span> <span class="n">processed_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span>
                <span class="n">feats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_atoms</span><span class="p">,</span> <span class="n">feats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">processed_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">feats</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat</span> <span class="ow">and</span> <span class="p">(</span><span class="n">num_bonds</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_self_loop</span><span class="p">):</span>
            <span class="n">processed_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_concat</span><span class="p">(</span><span class="n">processed_features</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">feat_name</span><span class="p">,</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">processed_features</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">feat</span> <span class="o">=</span> <span class="n">datatype</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
                <span class="n">processed_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">feat</span>

        <span class="k">return</span> <span class="n">processed_features</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.bond.BondCalculator.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#molfeat.calc.bond.BondCalculator.__call__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Featurize all bonds in a molecule.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mol</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="datamol.Mol">Mol</span>, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the molecule of interest</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>requested data type</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For each function in self.featurizer_funcs with the key <code>k</code>,
store the computed feature under the key <code>k</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/bond.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Featurize all bonds in a molecule.</span>

<span class="sd">    Args:</span>
<span class="sd">        mol: the molecule of interest</span>
<span class="sd">        dtype: requested data type</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: For each function in self.featurizer_funcs with the key ``k``,</span>
<span class="sd">            store the computed feature under the key ``k``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">num_bonds</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumBonds</span><span class="p">()</span>
    <span class="n">bond_features</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># Compute features for each bond</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bonds</span><span class="p">):</span>
        <span class="n">bond</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetBondWithIdx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">feat_name</span><span class="p">,</span> <span class="n">feat_func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">feat</span> <span class="o">=</span> <span class="n">feat_func</span><span class="p">(</span><span class="n">bond</span><span class="p">)</span>
            <span class="n">bond_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">feat</span><span class="p">,</span> <span class="n">feat</span><span class="o">.</span><span class="n">copy</span><span class="p">()])</span>

    <span class="c1"># Stack the features and convert them to float arrays</span>
    <span class="n">processed_features</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">feat_name</span><span class="p">,</span> <span class="n">feat_list</span> <span class="ow">in</span> <span class="n">bond_features</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">feat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">feat_list</span><span class="p">)</span>
        <span class="n">processed_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">feat</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_self_loop</span> <span class="ow">and</span> <span class="n">num_bonds</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">num_atoms</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">feat_name</span> <span class="ow">in</span> <span class="n">processed_features</span><span class="p">:</span>
            <span class="n">feats</span> <span class="o">=</span> <span class="n">processed_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span>
            <span class="c1"># add a new label that says the feat are not self loop</span>
            <span class="c1"># feats = np.concatenate([feats, np.zeros((feats.shape[0], 1))], axis=1)</span>
            <span class="c1"># add a label at the last position that says it&#39;s a selfloop</span>
            <span class="n">add_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_atoms</span><span class="p">,</span> <span class="n">feats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="c1"># self_loop_feats[:, -1] = 1</span>
            <span class="n">feats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">feats</span><span class="p">,</span> <span class="n">add_edges</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">processed_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">feats</span>
        <span class="n">self_loop_feats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_bonds</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_atoms</span><span class="p">,</span> <span class="mi">1</span><span class="p">))]</span>
        <span class="p">)</span>

        <span class="n">processed_features</span><span class="p">[</span><span class="s2">&quot;self_loop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">self_loop_feats</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_self_loop</span> <span class="ow">and</span> <span class="n">num_bonds</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">num_atoms</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">()</span>
        <span class="n">old_concat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">concat</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">processed_features</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_toy_mol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">concat</span> <span class="o">=</span> <span class="n">old_concat</span>
        <span class="k">for</span> <span class="n">feat_name</span> <span class="ow">in</span> <span class="n">processed_features</span><span class="p">:</span>
            <span class="n">feats</span> <span class="o">=</span> <span class="n">processed_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span>
            <span class="n">feats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_atoms</span><span class="p">,</span> <span class="n">feats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">processed_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">feats</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat</span> <span class="ow">and</span> <span class="p">(</span><span class="n">num_bonds</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_self_loop</span><span class="p">):</span>
        <span class="n">processed_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_concat</span><span class="p">(</span><span class="n">processed_features</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">feat_name</span><span class="p">,</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">processed_features</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">feat</span> <span class="o">=</span> <span class="n">datatype</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">processed_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">feat</span>

    <span class="k">return</span> <span class="n">processed_features</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.bond.BondCalculator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">featurizer_funcs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">self_loop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">concat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;he&#39;</span><span class="p">)</span></code>

<a href="#molfeat.calc.bond.BondCalculator.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Init function of the bond property calculator</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>featurizer_funcs</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[list, dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mapping feature name to the featurization function.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>self_loop</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether self loops will be added. Default to False. If True, an additional
column of binary values to indicate the identity of self loops will be added.
The other features of the self loops will be zero.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>concat</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to concat all the data into a single value in the output dict</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the key name of the concatenated features</p>
              </div>
            </td>
            <td>
                  <code>&#39;he&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/bond.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">featurizer_funcs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">self_loop</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">concat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;he&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Init function of the bond property calculator</span>

<span class="sd">    Args:</span>
<span class="sd">        featurizer_funcs: Mapping feature name to the featurization function.</span>
<span class="sd">        self_loop: Whether self loops will be added. Default to False. If True, an additional</span>
<span class="sd">            column of binary values to indicate the identity of self loops will be added.</span>
<span class="sd">            The other features of the self loops will be zero.</span>
<span class="sd">        concat: Whether to concat all the data into a single value in the output dict</span>
<span class="sd">        name: Name of the key name of the concatenated features</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_input_kwargs</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_input_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">)</span>
    <span class="c1"># remove featurizer_funcs too</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_input_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;featurizer_funcs&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_toy_mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="s2">&quot;CO&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">featurizer_funcs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">featurizer_funcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_FEATURIZER</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">featurizer_funcs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">get_name</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">featurizer_funcs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">get_name</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">featurizer_funcs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span> <span class="o">=</span> <span class="n">featurizer_funcs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_self_loop</span> <span class="o">=</span> <span class="n">self_loop</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">concat</span> <span class="o">=</span> <span class="n">concat</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feat_size</span><span class="p">(</span><span class="n">feat_name</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_self_loop</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">[</span><span class="s2">&quot;self_loop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.bond.BondCalculator.__len__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__len__</span><span class="p">()</span></code>

<a href="#molfeat.calc.bond.BondCalculator.__len__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get length of the property estimator</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/bond.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get length of the property estimator&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.bond.BondCalculator.feat_size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">feat_size</span><span class="p">(</span><span class="n">feat_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#molfeat.calc.bond.BondCalculator.feat_size" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the feature size for <code>feat_name</code>.</p>
<p>When there is only one feature, <code>feat_name</code> can be None.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>feat_name</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Feature for query.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Feature size for the feature with name <code>feat_name</code>. Default to None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/bond.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">feat_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feat_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the feature size for ``feat_name``.</span>

<span class="sd">    When there is only one feature, ``feat_name`` can be None.</span>

<span class="sd">    Args:</span>
<span class="sd">        feat_name: Feature for query.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Feature size for the feature with name ``feat_name``. Default to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">feat_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="p">),</span> <span class="s2">&quot;feat_name should be provided if there are more than one features&quot;</span>
        <span class="n">feat_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">feat_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Expect feat_name to be in </span><span class="si">{}</span><span class="s2">, got </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">feat_name</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">feat_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">:</span>
        <span class="n">bond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toy_mol</span><span class="o">.</span><span class="n">GetBondWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="p">[</span><span class="n">feat_name</span><span class="p">](</span><span class="n">bond</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.bond.BondCalculator.from_state_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_state_dict</span><span class="p">(</span><span class="n">state_dict</span><span class="p">,</span> <span class="n">override_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#molfeat.calc.bond.BondCalculator.from_state_dict" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create an instance of an atom calculator from a state dict</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state_dict</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>state dictionary to use to create the atom calculator</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>override_args</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>optional dictionary of arguments to override the ones in the state dict
at construction of the new object</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/bond.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_state_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">state_dict</span><span class="p">,</span> <span class="n">override_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create an instance of an atom calculator from a state dict</span>

<span class="sd">    Args:</span>
<span class="sd">        state_dict: state dictionary to use to create the atom calculator</span>
<span class="sd">        override_args: optional dictionary of arguments to override the ones in the state dict</span>
<span class="sd">            at construction of the new object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># EN: at this moment, version compatibility is not enforced</span>
    <span class="n">cls_name</span> <span class="o">=</span> <span class="n">state_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">module_name</span> <span class="o">=</span> <span class="n">state_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;module&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
    <span class="n">klass</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># now we need to unpickle the featurizer functions</span>
    <span class="n">featurizer_fn_pickled</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;featurizer_funcs&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">featurizer_fn_pickled</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">featurizer_fn_loaded</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">featurizer_fn_pickled</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">featurizer_fn_loaded</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">hex_to_fn</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;featurizer_funcs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">featurizer_fn_loaded</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="p">(</span><span class="n">override_args</span> <span class="ow">or</span> <span class="p">{}))</span>
    <span class="k">return</span> <span class="n">klass</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.bond.BondCalculator.to_state_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_state_dict</span><span class="p">()</span></code>

<a href="#molfeat.calc.bond.BondCalculator.to_state_dict" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Convert the Atom calculator to a state dict
Due to some constraints and cross-version compatibility,  the featurizer functions
need to be pickled and not just list</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/bond.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_state_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert the Atom calculator to a state dict</span>
<span class="sd">    Due to some constraints and cross-version compatibility,  the featurizer functions</span>
<span class="sd">    need to be pickled and not just list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">state_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;module&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span>
    <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_kwargs</span>

    <span class="n">featurizer_fn_pickled</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">ffunc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">featurizer_fn_pickled</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_to_hex</span><span class="p">(</span><span class="n">ffunc</span><span class="p">)</span>
    <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="s2">&quot;featurizer_funcs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">featurizer_fn_pickled</span>
    <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;_molfeat_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MOLFEAT_VERSION</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
    <span class="n">val</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">default</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">signature</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="c1">#    if v.default is not inspect.Parameter.empty</span>
    <span class="p">}</span>
    <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="molfeat.calc.bond.DGLCanonicalBondCalculator" class="doc doc-heading">
            <code>DGLCanonicalBondCalculator</code>


<a href="#molfeat.calc.bond.DGLCanonicalBondCalculator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="molfeat.calc.bond.BondCalculator" href="#molfeat.calc.bond.BondCalculator">BondCalculator</a></code></p>







              <details class="quote">
                <summary>Source code in <code>molfeat/calc/bond.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DGLCanonicalBondCalculator</span><span class="p">(</span><span class="n">BondCalculator</span><span class="p">):</span>
    <span class="n">DEFAULT_FEATURIZER</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;bond_type_one_hot&quot;</span><span class="p">:</span> <span class="n">bond_type_one_hot</span><span class="p">,</span>
        <span class="s2">&quot;bond_is_conjugated&quot;</span><span class="p">:</span> <span class="n">bond_is_conjugated</span><span class="p">,</span>
        <span class="s2">&quot;bond_is_in_ring&quot;</span><span class="p">:</span> <span class="n">bond_is_in_ring</span><span class="p">,</span>
        <span class="s2">&quot;bond_stereo_one_hot&quot;</span><span class="p">:</span> <span class="n">bond_stereo_one_hot</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_concat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Concatenate the data into a single value</span>

<span class="sd">        Args:</span>
<span class="sd">            data_dict: mapping of feature names to tensor/arrays</span>
<span class="sd">        Returns:</span>
<span class="sd">            concatenated_dict: a dict with a single key where all array have been concatenated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">concat_dict</span><span class="p">(</span><span class="n">data_dict</span><span class="p">,</span> <span class="n">new_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="molfeat.calc.bond.DGLWeaveEdgeCalculator" class="doc doc-heading">
            <code>DGLWeaveEdgeCalculator</code>


<a href="#molfeat.calc.bond.DGLWeaveEdgeCalculator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="molfeat.calc.bond.EdgeMatCalculator" href="#molfeat.calc.bond.EdgeMatCalculator">EdgeMatCalculator</a></code></p>


        <p>Edge featurizer used by WeaveNets</p>
<p>The edge featurization is introduced in <code>Molecular Graph Convolutions:
Moving Beyond Fingerprints &lt;https://arxiv.org/abs/1603.00856&gt;</code>__.</p>
<p>This featurization is performed for a complete graph of atoms with self loops added,
which considers the following default:</p>
<ul>
<li>Number of bonds between each pairs of atoms</li>
<li>One-hot encoding of bond type if a bond exists between a pair of atoms</li>
<li>Whether a pair of atoms belongs to a same ring</li>
</ul>






              <details class="quote">
                <summary>Source code in <code>molfeat/calc/bond.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DGLWeaveEdgeCalculator</span><span class="p">(</span><span class="n">EdgeMatCalculator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Edge featurizer used by WeaveNets</span>

<span class="sd">    The edge featurization is introduced in `Molecular Graph Convolutions:</span>
<span class="sd">    Moving Beyond Fingerprints &lt;https://arxiv.org/abs/1603.00856&gt;`__.</span>

<span class="sd">    This featurization is performed for a complete graph of atoms with self loops added,</span>
<span class="sd">    which considers the following default:</span>

<span class="sd">    * Number of bonds between each pairs of atoms</span>
<span class="sd">    * One-hot encoding of bond type if a bond exists between a pair of atoms</span>
<span class="sd">    * Whether a pair of atoms belongs to a same ring</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DEFAULT_FEATURIZER</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">DEFAULT_PAIRWISE_FEATURIZER</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;pairwise_dist_indicator&quot;</span><span class="p">:</span> <span class="n">pairwise_dist_indicator</span><span class="p">,</span>
        <span class="s2">&quot;pairwise_bond_indicator&quot;</span><span class="p">:</span> <span class="n">pairwise_bond_indicator</span><span class="p">,</span>
        <span class="s2">&quot;pairwise_ring_membership&quot;</span><span class="p">:</span> <span class="n">pairwise_ring_membership</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_concat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Concatenate the data into a single value</span>

<span class="sd">        Args:</span>
<span class="sd">            data_dict: mapping of feature names to tensor/arrays</span>
<span class="sd">        Returns:</span>
<span class="sd">            concatenated_dict: a dict with a single key where all array have been concatenated</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># To reproduce DGLDefault, we need to keep the order of dict insertion</span>
        <span class="k">return</span> <span class="n">concat_dict</span><span class="p">(</span>
            <span class="n">data_dict</span><span class="p">,</span> <span class="n">new_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pairwise_atom_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="molfeat.calc.bond.EdgeMatCalculator" class="doc doc-heading">
            <code>EdgeMatCalculator</code>


<a href="#molfeat.calc.bond.EdgeMatCalculator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="molfeat.calc.bond.BondCalculator" href="#molfeat.calc.bond.BondCalculator">BondCalculator</a></code></p>


        <p>Generate edge featurizer matrix</p>






              <details class="quote">
                <summary>Source code in <code>molfeat/calc/bond.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">EdgeMatCalculator</span><span class="p">(</span><span class="n">BondCalculator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate edge featurizer matrix&quot;&quot;&quot;</span>

    <span class="n">DEFAULT_PAIRWISE_FEATURIZER</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;pairwise_2D_dist&quot;</span><span class="p">:</span> <span class="n">pairwise_2D_dist</span><span class="p">,</span>
        <span class="c1"># &quot;pairwise_3D_dist&quot;: pairwise_3D_dist,</span>
        <span class="s2">&quot;pairwise_ring_membership&quot;</span><span class="p">:</span> <span class="n">pairwise_ring_membership</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">featurizer_funcs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pairwise_atom_funcs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;he&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Init function of the edge matrix property calculator</span>

<span class="sd">        Args:</span>
<span class="sd">            featurizer_funcs: Mapping feature name to the featurization function.</span>
<span class="sd">            pairwise_atom_funcs: Mapping feature name to pairwise featurization function.</span>
<span class="sd">                Use the keywords &quot;default&quot; for the default values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pairwise_atom_funcs</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="n">pairwise_atom_funcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_PAIRWISE_FEATURIZER</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pairwise_atom_funcs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">get_name</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="n">pairwise_atom_funcs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">get_name</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pairwise_atom_funcs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pairwise_atom_funcs</span> <span class="o">=</span> <span class="n">pairwise_atom_funcs</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">featurizer_funcs</span><span class="o">=</span><span class="n">featurizer_funcs</span><span class="p">,</span> <span class="n">concat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="c1"># add conf data to toy mol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toy_mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">conformers</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_toy_mol</span><span class="p">,</span> <span class="n">n_confs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">minimize_energy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairwise_atom_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feat_size</span><span class="p">(</span><span class="n">feat_name</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_state_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the Atom calculator to a state dict</span>
<span class="sd">        Due to some constraints and cross-version compatibility,  the featurizer functions</span>
<span class="sd">        need to be pickled and not just list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state_dict</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">to_state_dict</span><span class="p">()</span>
        <span class="c1"># repeat for the pairwise one</span>
        <span class="n">pairwise_atom_fn_pickled</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">ffunc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairwise_atom_funcs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">pairwise_atom_fn_pickled</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_to_hex</span><span class="p">(</span><span class="n">ffunc</span><span class="p">)</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="s2">&quot;pairwise_atom_funcs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pairwise_atom_fn_pickled</span>
        <span class="k">return</span> <span class="n">state_dict</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_state_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">state_dict</span><span class="p">,</span> <span class="n">override_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an instance of an atom calculator from a state dict</span>

<span class="sd">        Args:</span>
<span class="sd">            state_dict: state dictionary to use to create the atom calculator</span>
<span class="sd">            override_args: optional dictionary of arguments to override the ones in the state dict</span>
<span class="sd">                at construction of the new object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># EN: at this moment, version compatibility is not enforced</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="n">state_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">module_name</span> <span class="o">=</span> <span class="n">state_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;module&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
        <span class="n">klass</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># now we need to unpickle the featurizer functions</span>
        <span class="n">featurizer_fn_pickled</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;featurizer_funcs&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">featurizer_fn_pickled</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">featurizer_fn_loaded</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">featurizer_fn_pickled</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">featurizer_fn_loaded</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">hex_to_fn</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;featurizer_funcs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">featurizer_fn_loaded</span>

        <span class="n">pairwise_atom_fn_pickled</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;pairwise_atom_funcs&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pairwise_atom_fn_pickled</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pairwise_atom_fn_loaded</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pairwise_atom_fn_pickled</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">pairwise_atom_fn_loaded</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">hex_to_fn</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;pairwise_atom_funcs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pairwise_atom_fn_loaded</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="p">(</span><span class="n">override_args</span> <span class="ow">or</span> <span class="p">{}))</span>
        <span class="k">return</span> <span class="n">klass</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">feat_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feat_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the feature size for ``feat_name``.</span>

<span class="sd">        Args:</span>
<span class="sd">            feat_name: Feature for query.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: Feature size for the feature with name ``feat_name``. Default to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">feat_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span> <span class="ow">and</span> <span class="n">feat_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairwise_atom_funcs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Expect feat_name to be in </span><span class="si">{}</span><span class="s2">, got </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">feat_name</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">feat_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">feat_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="p">:</span>
                <span class="n">bond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toy_mol</span><span class="o">.</span><span class="n">GetBondWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="p">[</span><span class="n">feat_name</span><span class="p">](</span><span class="n">bond</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">feat_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairwise_atom_funcs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairwise_atom_funcs</span><span class="p">[</span><span class="n">feat_name</span><span class="p">](</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_toy_mol</span>
                <span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Feature name </span><span class="si">{</span><span class="n">feat_name</span><span class="si">}</span><span class="s2"> is not defined !&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">flat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Featurize all bonds in a molecule.</span>

<span class="sd">        Args:</span>
<span class="sd">            mol: the molecule of interest</span>
<span class="sd">            dtype: requested data type</span>
<span class="sd">            flat: whether to return a collapsed N^2, M or a N, N, M matrix</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: For each function in self.featurizer_funcs with the key ``k``,</span>
<span class="sd">                store the computed feature under the key ``k``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="n">num_bonds</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumBonds</span><span class="p">()</span>
        <span class="n">num_atoms</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">()</span>
        <span class="n">feat_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">edge_matrix</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairwise_atom_funcs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">feat_size</span> <span class="o">-=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairwise_atom_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">edge_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_atoms</span><span class="p">,</span> <span class="n">num_atoms</span><span class="p">,</span> <span class="n">feat_size</span><span class="p">))</span>
            <span class="c1"># Compute features for each bond</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bonds</span><span class="p">):</span>
                <span class="n">bond</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetBondWithIdx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">a_idx_1</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">GetBeginAtomIdx</span><span class="p">()</span>
                <span class="n">a_idx_2</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">GetEndAtomIdx</span><span class="p">()</span>
                <span class="n">bond_features</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">feat_name</span><span class="p">,</span> <span class="n">feat_func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">feat</span> <span class="o">=</span> <span class="n">feat_func</span><span class="p">(</span><span class="n">bond</span><span class="p">)</span>
                    <span class="n">bond_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">feat</span><span class="p">])</span>
                <span class="n">bond_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_concat</span><span class="p">(</span><span class="n">bond_features</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                <span class="n">edge_matrix</span><span class="p">[</span><span class="n">a_idx_1</span><span class="p">,</span> <span class="n">a_idx_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">bond_features</span>
                <span class="n">edge_matrix</span><span class="p">[</span><span class="n">a_idx_2</span><span class="p">,</span> <span class="n">a_idx_1</span><span class="p">]</span> <span class="o">=</span> <span class="n">bond_features</span>

            <span class="n">edge_matrix</span> <span class="o">=</span> <span class="n">edge_matrix</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">feat_size</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairwise_atom_funcs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pwise_features</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">pname</span><span class="p">,</span> <span class="n">pfunc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairwise_atom_funcs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">pwise_features</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span> <span class="o">=</span> <span class="n">pfunc</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
            <span class="n">pwise_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_concat</span><span class="p">(</span><span class="n">pwise_features</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">edge_matrix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">edge_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">edge_matrix</span><span class="p">,</span> <span class="n">pwise_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">edge_matrix</span> <span class="o">=</span> <span class="n">pwise_features</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">flat</span><span class="p">:</span>
            <span class="n">edge_matrix</span> <span class="o">=</span> <span class="n">edge_matrix</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">num_atoms</span><span class="p">,</span> <span class="n">num_atoms</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">edge_matrix</span> <span class="o">=</span> <span class="n">datatype</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">edge_matrix</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">edge_matrix</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.bond.EdgeMatCalculator.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#molfeat.calc.bond.EdgeMatCalculator.__call__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Featurize all bonds in a molecule.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mol</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="datamol.Mol">Mol</span>, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the molecule of interest</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>requested data type</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>flat</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to return a collapsed N^2, M or a N, N, M matrix</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For each function in self.featurizer_funcs with the key <code>k</code>,
store the computed feature under the key <code>k</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/bond.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">dm</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">flat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Featurize all bonds in a molecule.</span>

<span class="sd">    Args:</span>
<span class="sd">        mol: the molecule of interest</span>
<span class="sd">        dtype: requested data type</span>
<span class="sd">        flat: whether to return a collapsed N^2, M or a N, N, M matrix</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: For each function in self.featurizer_funcs with the key ``k``,</span>
<span class="sd">            store the computed feature under the key ``k``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">to_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">num_bonds</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumBonds</span><span class="p">()</span>
    <span class="n">num_atoms</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">()</span>
    <span class="n">feat_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">edge_matrix</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairwise_atom_funcs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">feat_size</span> <span class="o">-=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairwise_atom_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">edge_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_atoms</span><span class="p">,</span> <span class="n">num_atoms</span><span class="p">,</span> <span class="n">feat_size</span><span class="p">))</span>
        <span class="c1"># Compute features for each bond</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bonds</span><span class="p">):</span>
            <span class="n">bond</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetBondWithIdx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">a_idx_1</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">GetBeginAtomIdx</span><span class="p">()</span>
            <span class="n">a_idx_2</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">GetEndAtomIdx</span><span class="p">()</span>
            <span class="n">bond_features</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">feat_name</span><span class="p">,</span> <span class="n">feat_func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">feat</span> <span class="o">=</span> <span class="n">feat_func</span><span class="p">(</span><span class="n">bond</span><span class="p">)</span>
                <span class="n">bond_features</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">feat</span><span class="p">])</span>
            <span class="n">bond_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_concat</span><span class="p">(</span><span class="n">bond_features</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="n">edge_matrix</span><span class="p">[</span><span class="n">a_idx_1</span><span class="p">,</span> <span class="n">a_idx_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">bond_features</span>
            <span class="n">edge_matrix</span><span class="p">[</span><span class="n">a_idx_2</span><span class="p">,</span> <span class="n">a_idx_1</span><span class="p">]</span> <span class="o">=</span> <span class="n">bond_features</span>

        <span class="n">edge_matrix</span> <span class="o">=</span> <span class="n">edge_matrix</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">feat_size</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairwise_atom_funcs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pwise_features</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">pname</span><span class="p">,</span> <span class="n">pfunc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairwise_atom_funcs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">pwise_features</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span> <span class="o">=</span> <span class="n">pfunc</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="n">pwise_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_concat</span><span class="p">(</span><span class="n">pwise_features</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">edge_matrix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">edge_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">edge_matrix</span><span class="p">,</span> <span class="n">pwise_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">edge_matrix</span> <span class="o">=</span> <span class="n">pwise_features</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">flat</span><span class="p">:</span>
        <span class="n">edge_matrix</span> <span class="o">=</span> <span class="n">edge_matrix</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">num_atoms</span><span class="p">,</span> <span class="n">num_atoms</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">edge_matrix</span> <span class="o">=</span> <span class="n">datatype</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">edge_matrix</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">edge_matrix</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.bond.EdgeMatCalculator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">featurizer_funcs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pairwise_atom_funcs</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;he&#39;</span><span class="p">)</span></code>

<a href="#molfeat.calc.bond.EdgeMatCalculator.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Init function of the edge matrix property calculator</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>featurizer_funcs</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[list, dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mapping feature name to the featurization function.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pairwise_atom_funcs</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[list, dict, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mapping feature name to pairwise featurization function.
Use the keywords "default" for the default values</p>
              </div>
            </td>
            <td>
                  <code>&#39;default&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/bond.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">featurizer_funcs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">pairwise_atom_funcs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;he&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Init function of the edge matrix property calculator</span>

<span class="sd">    Args:</span>
<span class="sd">        featurizer_funcs: Mapping feature name to the featurization function.</span>
<span class="sd">        pairwise_atom_funcs: Mapping feature name to pairwise featurization function.</span>
<span class="sd">            Use the keywords &quot;default&quot; for the default values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pairwise_atom_funcs</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="n">pairwise_atom_funcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_PAIRWISE_FEATURIZER</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pairwise_atom_funcs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">get_name</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">pairwise_atom_funcs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">get_name</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pairwise_atom_funcs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pairwise_atom_funcs</span> <span class="o">=</span> <span class="n">pairwise_atom_funcs</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">featurizer_funcs</span><span class="o">=</span><span class="n">featurizer_funcs</span><span class="p">,</span> <span class="n">concat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="c1"># add conf data to toy mol</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_toy_mol</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">conformers</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_toy_mol</span><span class="p">,</span> <span class="n">n_confs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">minimize_energy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairwise_atom_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feat_size</span><span class="p">(</span><span class="n">feat_name</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.bond.EdgeMatCalculator.feat_size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">feat_size</span><span class="p">(</span><span class="n">feat_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#molfeat.calc.bond.EdgeMatCalculator.feat_size" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the feature size for <code>feat_name</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>feat_name</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Feature for query.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Feature size for the feature with name <code>feat_name</code>. Default to None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/bond.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">feat_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feat_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the feature size for ``feat_name``.</span>

<span class="sd">    Args:</span>
<span class="sd">        feat_name: Feature for query.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Feature size for the feature with name ``feat_name``. Default to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">feat_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span> <span class="ow">and</span> <span class="n">feat_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairwise_atom_funcs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Expect feat_name to be in </span><span class="si">{}</span><span class="s2">, got </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">feat_name</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">feat_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">feat_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="p">:</span>
            <span class="n">bond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toy_mol</span><span class="o">.</span><span class="n">GetBondWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurizer_funcs</span><span class="p">[</span><span class="n">feat_name</span><span class="p">](</span><span class="n">bond</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">feat_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairwise_atom_funcs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairwise_atom_funcs</span><span class="p">[</span><span class="n">feat_name</span><span class="p">](</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_toy_mol</span>
            <span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Feature name </span><span class="si">{</span><span class="n">feat_name</span><span class="si">}</span><span class="s2"> is not defined !&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feat_sizes</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.bond.EdgeMatCalculator.from_state_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_state_dict</span><span class="p">(</span><span class="n">state_dict</span><span class="p">,</span> <span class="n">override_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#molfeat.calc.bond.EdgeMatCalculator.from_state_dict" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create an instance of an atom calculator from a state dict</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state_dict</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>state dictionary to use to create the atom calculator</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>override_args</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>optional dictionary of arguments to override the ones in the state dict
at construction of the new object</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/bond.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_state_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">state_dict</span><span class="p">,</span> <span class="n">override_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create an instance of an atom calculator from a state dict</span>

<span class="sd">    Args:</span>
<span class="sd">        state_dict: state dictionary to use to create the atom calculator</span>
<span class="sd">        override_args: optional dictionary of arguments to override the ones in the state dict</span>
<span class="sd">            at construction of the new object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># EN: at this moment, version compatibility is not enforced</span>
    <span class="n">cls_name</span> <span class="o">=</span> <span class="n">state_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">module_name</span> <span class="o">=</span> <span class="n">state_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;module&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
    <span class="n">klass</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># now we need to unpickle the featurizer functions</span>
    <span class="n">featurizer_fn_pickled</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;featurizer_funcs&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">featurizer_fn_pickled</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">featurizer_fn_loaded</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">featurizer_fn_pickled</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">featurizer_fn_loaded</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">hex_to_fn</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;featurizer_funcs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">featurizer_fn_loaded</span>

    <span class="n">pairwise_atom_fn_pickled</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;pairwise_atom_funcs&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pairwise_atom_fn_pickled</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pairwise_atom_fn_loaded</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pairwise_atom_fn_pickled</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">pairwise_atom_fn_loaded</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">hex_to_fn</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;pairwise_atom_funcs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pairwise_atom_fn_loaded</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="p">(</span><span class="n">override_args</span> <span class="ow">or</span> <span class="p">{}))</span>
    <span class="k">return</span> <span class="n">klass</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="molfeat.calc.bond.EdgeMatCalculator.to_state_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_state_dict</span><span class="p">()</span></code>

<a href="#molfeat.calc.bond.EdgeMatCalculator.to_state_dict" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Convert the Atom calculator to a state dict
Due to some constraints and cross-version compatibility,  the featurizer functions
need to be pickled and not just list</p>

            <details class="quote">
              <summary>Source code in <code>molfeat/calc/bond.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_state_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert the Atom calculator to a state dict</span>
<span class="sd">    Due to some constraints and cross-version compatibility,  the featurizer functions</span>
<span class="sd">    need to be pickled and not just list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">state_dict</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">to_state_dict</span><span class="p">()</span>
    <span class="c1"># repeat for the pairwise one</span>
    <span class="n">pairwise_atom_fn_pickled</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">ffunc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairwise_atom_funcs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">pairwise_atom_fn_pickled</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn_to_hex</span><span class="p">(</span><span class="n">ffunc</span><span class="p">)</span>
    <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="s2">&quot;pairwise_atom_funcs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pairwise_atom_fn_pickled</span>
    <span class="k">return</span> <span class="n">state_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright 2020 - 2023 datamol.io
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.tracking", "navigation.top"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../assets/js/google-analytics.js"></script>
      
    
  </body>
</html>